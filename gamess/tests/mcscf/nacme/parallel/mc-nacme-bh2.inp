!   BH2+ test case for NACME solvers...inspired by Aaron West, 2012
!   this illustrates Aaron's new CP-MCHF solving techniques.
!   The input is inspired by 
!      M.Amano and K.Takatsuka, J.Chem.Phys. 122,084113(2005)
!   where five states of the system B+ + H2 are considered.
!   The option to compute coupling for only a desired range of
!   states is tested, namely only state 4&5.
!
!   The MCSCF ran for 5 iterations, the CP-MCHF for 16 iterations
!   extensive results are shown below, the most important is
!       NONADIABATIC COUPLING MATRIX ELEMENT (NACME), IN ONE/BOHR
!       <STATE  5, WEIGHT=   0.2 | D/DQ | STATE  4, WEIGHT=   0.2>
!         ATOM               D/DX           D/DY           D/DZ
!          1 B            -1.4096174     -0.6935816     -2.0292544
!          2 H             0.7686725      0.3782119      1.1065625
!          3 H             0.6370345      0.3134456      0.9170621
!
!   This run takes 24 seconds on 2.66 GHz Cloverton (27 Apr 2015),
!   when using GCRO and only finding the 4/5 coupling elements.
!   results have not changed significantly since 2012.
!
!   -----------------------------------------------------------------
!   All runs were made using active/active canonicalization.
!   19 AOs, 18 MOs, and 225 determinants in this calculation.
!
!      If allowed to solve for all NACME state pairs,
!   CG:     conjugate gradient (defaults):               272 iters
!   CG:     conjugate gradient (IPDIR tweak):            259 iters
!   GCRO:   gen.conj.grad. residual w/ inner orthog.:    155 iters
!   GCRODR: gen.conj.res., inner orthog, defl.restart:  >999 iters
!   GCRODR: with tweaks (this "uses the hammer")          18 iters
!   all finish quicker if CPTOL=1d-5 is entered, e.g. 21 iters if GCRO.
!
!      If solving only for state's 4 and 5's NACME:
!   CG:     conjugate gradient (defaults):              >300 iters
!   CG:     conjugate gradient (IPDIR tweak):            250 iters
!   GCRO:   gen.conj.grad. residual w/ inner orthog.:     22 iters <--this run
!   GCRODR: gen.conj.res., inner orthog, defl.restart:  >999 iters
!   GCRODR: with tweaks (this "uses the hammer")           5 iters
!
!   numerical results are from the GCRO run, solving only 4/5 NACME:
!   
!   the MCSCF converges in 5 iterations to these states,
!   STATE   1  ENERGY=  -25.4850654775  S=  0.00  SZ=  0.00  SPACE SYM=A
!   STATE   2  ENERGY=  -25.2753779556  S=  1.00  SZ=  0.00  SPACE SYM=A
!   STATE   3  ENERGY=  -25.2633593006  S=  1.00  SZ=  0.00  SPACE SYM=A
!   STATE   4  ENERGY=  -25.2550270107  S=  0.00  SZ=  0.00  SPACE SYM=A
!   STATE   5  ENERGY=  -25.2509444249  S=  0.00  SZ=  0.00  SPACE SYM=A
!   STATE   6  ENERGY=  -25.1711280480  S=  1.00  SZ=  0.00  SPACE SYM=A
!   STATE   7  ENERGY=  -25.1650313499  S=  1.00  SZ=  0.00  SPACE SYM=A
!   STATE   8  ENERGY=  -25.1024764066  S=  1.00  SZ=  0.00  SPACE SYM=A
!   STATE   9  ENERGY=  -25.0519202079  S=  0.00  SZ=  0.00  SPACE SYM=A
!   STATE  10  ENERGY=  -25.0382119910  S=  0.00  SZ=  0.00  SPACE SYM=A
!   STATE  11  ENERGY=  -25.0342031017  S=  2.00  SZ=  0.00  SPACE SYM=A
!   STATE  12  ENERGY=  -24.9952527996  S=  1.00  SZ=  0.00  SPACE SYM=A
!   STATE  13  ENERGY=  -24.9312122985  S=  1.00  SZ=  0.00  SPACE SYM=A
!   STATE  14  ENERGY=  -24.9307404259  S=  0.00  SZ=  0.00  SPACE SYM=A
!   STATE  15  ENERGY=  -24.9246593992  S=  0.00  SZ=  0.00  SPACE SYM=A
!   
!     --- DIPOLE MOMENTS (DEBYE) ---
!     1,  1 :  DIPOLE    0.112271   -0.053075   -0.059853    0.137855
!     1,  2 : TDIPOLE    0.135363    0.437086   -0.243428    0.518290
!     2,  2 :  DIPOLE    0.006221   -0.864567    0.291185    0.912306
!          ...
!     5,  5 :  DIPOLE   -0.229923    0.487535   -0.006918    0.539076
!   
!     --- OSCILLATOR STRENGTHS  ---
!                1           2           3           4           5
!       1    0.0000000
!       2    0.0063765   0.0000000
!       3    0.0037012   0.0000167   0.0000000
!       4    0.3531837   0.1306291   0.0000132   0.0000000
!       5    0.4013426   0.0000091   0.1464560   0.0000004   0.0000000
!
!    STATE-SPECIFIC GRADIENT OF STATE   3 WEIGHT=   0.20000
!    UNITS ARE HARTREE/BOHR    E'X               E'Y               E'Z
!       1 B               -0.028922504       0.047818051       0.003747184
!       2 H                0.028976367      -0.045188475      -0.004683379
!       3 H               -0.000053863      -0.002629576       0.000936194
!   
!    NONADIABATIC COUPLING MATRIX ELEMENT (NACME), IN ONE/BOHR
!    <STATE  5, WEIGHT=   0.20000 | D/DQ | STATE  4, WEIGHT=   0.20000>
!      ATOM               D/DX           D/DY           D/DZ
!       1 B              -1.4096146     -0.6935803     -2.0292504
!       2 H               0.7686710      0.3782112      1.1065604
!       3 H               0.6370332      0.3134450      0.9170602
!
!   other solvers should be very close: e.g. CG's H3 d/dy= 0.3134315
!
 $contrl scftyp=mcscf runtyp=nacme icharg=+1 mult=1 ISPHER=1 $end
 $system parall=.true. mwords=10 memddi=10 $end
 $basis  GBASIS=N31 NGAUSS=6 NDFUNC=1 $end
 $guess  guess=moread norb=18 $end
 $det    ncore=1 nact=6 nels=4 nstate=15 mxxpan=30 WSTATE(1)=1,1,1,1,1 $end
 $mcscf  cistep=aldet fullnr=.t. $end

!    CG, CG with convergence softening, GCRO, GCRODR, and "the hammer":
x$cpmchf $end
x$cpmchf ipdir=50 $end
 $cpmchf gcro=.t.   micit=5  kicit=10 $end
x$cpmchf gcrodr=.t. micit=10 kicit=5  maxit=1000 $end
x$cpmchf gcrodr=.t. micit=30 kicit=10 reclin=.false. $end
!
!    Next produces all state-specific gradients, but only one NACME.
!    It influences convergence due to changing the iterative subspaces.
 $cpmchf napick=.true. nacst(1)=4,5 $end

 $data
BH2 molecule as given by Aaron
C1
B       5.00000000    0.16365884    0.09069543   -0.01870596
H       1.00000000   -0.48699057    1.05976865    0.10204652
H       1.00000000    0.63919192   -1.22977619    0.10229255
 $END
!     provenance of the starting orbitals is unknown
 $VEC   
 1  1 9.95826296E-01 2.27356246E-02-2.44922802E-04 2.88079946E-04 6.94781368E-05
 1  2-7.09236009E-03-7.89840800E-05 3.53230513E-06 5.20447312E-05-1.54450908E-04
 1  3 6.66012887E-04-5.11561979E-04-7.45443263E-04-3.62718966E-05 4.86660495E-05
 1  4 1.04993010E-04 1.66121100E-03 1.08860580E-04 1.86620145E-03
 2  1-2.01742495E-01 4.23389335E-01 3.35477547E-02 6.46688765E-02 5.97111495E-03
 2  2 3.00248859E-01 5.49655543E-02 6.90979642E-03-8.01722430E-03-8.42083036E-03
 2  3 3.38415294E-02-2.54206990E-02-3.38958873E-02-2.65727272E-03 2.07688749E-05
 2  4 2.25768828E-01 1.22641170E-01 1.78961401E-01 1.01347873E-01
 3  1 8.66103620E-03-1.23544102E-02-2.06155839E-01 4.29348545E-01 2.35201591E-03
 3  2-4.43129005E-02-4.88648853E-02 1.12235912E-01-6.55272443E-04 7.39508549E-03
 3  3-8.70621229E-03 1.31112681E-03-4.14393874E-03-3.30835914E-03 6.67644457E-03
 3  4 2.45568412E-01 1.42028711E-01-2.66306879E-01-1.92669923E-01
 4  1-1.45079620E-01 3.99670535E-01 1.74172328E-02-3.33230768E-02-5.44571284E-03
 4  2 7.21820678E-01-5.06577290E-02 7.36969927E-02 6.71814637E-03 3.43592998E-02
 4  3-1.33797112E-01 9.94378124E-02 1.39648050E-01 6.25238368E-03-3.86724394E-03
 4  4-5.08006390E-01-3.75080858E-01-4.64670075E-01-3.33381786E-01
 5  1 4.07304217E-03-4.99576076E-02-3.84771681E-01 8.20972005E-01-7.74949453E-03
 5  2 1.40640474E-01-1.96736476E-01 3.83863414E-01 8.53908559E-03-3.38386464E-02
 5  3 5.17868572E-04 3.33207779E-02 8.68822512E-02 2.44271674E-02-4.54692078E-02
 5  4-7.35032052E-01-2.98405336E-01 6.18481723E-01 3.26348570E-01
 6  1 2.46328997E-02-6.76770692E-02 6.23631037E-01 2.75938340E-01-2.43798655E-03
 6  2-4.03469988E-02 3.81636768E-01 1.70587121E-01 5.07208176E-03 1.69312087E-05
 6  3 1.54395418E-02-1.54564730E-02-1.21526538E-02-4.74354458E-03 1.36172275E-05
 6  4 5.16752882E-02-3.72087472E-03 2.15196743E-02-1.46875354E-02
 7  1-4.75243664E-03 2.29395239E-02-8.67268864E-03 2.84326672E-03 6.81567484E-01
 7  2 1.25508823E-02-2.82425503E-03 8.88277607E-03 4.22531222E-01 5.98992021E-03
 7  3-1.22238154E-02 6.23389515E-03 1.66519367E-02 4.88635957E-03 3.59655032E-03
 7  4-5.56046844E-02-7.83042584E-03-3.51639003E-02 3.55117464E-04
 8  1-3.66073477E-02 1.19124485E+00-3.46762205E-01 3.95714031E-01 1.02441984E-01
 8  2-9.09080550E-01 5.09203902E-01-7.45882957E-01-9.57886635E-02-4.81051487E-03
 8  3 6.15160651E-02-5.67055502E-02-9.29063822E-02-1.06527088E-02 1.68040673E-02
 8  4 3.70881152E-01-2.56083932E-01 7.10185832E-02-4.44344386E-01
 9  1 1.28356170E-02-2.55503214E-01-7.41782845E-01-4.21377002E-01 6.39534681E-01
 9  2 1.47033342E-01 8.01917139E-01 5.50237337E-01-7.22780608E-01 2.34827879E-03
 9  3-1.08232826E-02 8.47500384E-03 1.10124094E-02 2.26057627E-03 5.32225979E-04
 9  4-3.86659046E-02 4.39170963E-02-1.29643037E-02 1.49406163E-01
10  1-1.34698412E-07 2.44921688E-06-5.84315837E-01-2.87538684E-01-8.67188987E-01
10  2-1.62071899E-06 6.50155818E-01 3.19938002E-01 9.64902817E-01 4.41453791E-04
10  3-2.11411554E-03 1.67266175E-03-2.35484312E-03 1.02877649E-03-3.36050627E-03
10  4 8.35290233E-07-1.24446233E-06-1.16707818E-06 1.99367711E-07
11  1-1.47744482E-02 9.99877459E-01 2.90588588E-01-6.72790431E-01 2.72807468E-02
11  2-7.87024571E-01-1.16033513E+00 2.40488176E+00-1.55670822E-02-5.15166074E-02
11  3 9.04704033E-02-3.89537959E-02-2.17163373E-02 1.67574948E-02-3.50286359E-02
11  4-5.79036147E-02-1.48378800E+00 3.09911104E-01 1.23065075E+00
12  1-3.93029861E-03 5.51043916E-01-1.21075607E-01 1.81121158E-01 2.15241030E-02
12  2-1.51528284E+00 1.47726243E+00-2.70615508E+00-9.80831183E-02-3.12590001E-02
12  3-3.87858695E-03 3.51375871E-02 8.72667627E-02 2.39058068E-02-4.32752606E-02
12  4-6.33191144E-01 3.54994853E+00 5.60499249E-01-2.30449934E+00
13  1-1.87565992E-02-1.02315707E+00 2.74230550E-02-4.17382985E-02-4.64125837E-03
13  2 2.69075812E+00-1.04324229E-01-2.02599608E-01 1.37474994E-01-7.43891575E-02
13  3 2.18622525E-01-1.44233368E-01-1.81038897E-01 2.92710273E-03-1.83016410E-02
13  4 2.90081507E-01-1.26833729E+00 7.18107741E-01-1.91255276E+00
14  1 1.46823660E-07-1.77535040E-06-3.25731649E-03-1.61090685E-03-4.83954000E-03
14  2 4.67219173E-06 2.26915535E-03 1.13147046E-03 3.37714674E-03-4.40380098E-01
14  3 4.04712783E-01 3.56673149E-02 3.49705278E-01-3.63459637E-01 7.11511006E-01
14  4 8.07817063E-06-1.56074565E-05-5.72857604E-06 1.00663493E-05
15  1-3.73423421E-04-5.37500477E-03 4.45642713E-03 3.66562972E-03-4.21849517E-03
15  2-1.35662886E-03 2.36706392E-02-4.64627863E-02-5.43412178E-04-2.39426511E-01
15  3 1.26863591E-02 2.26740152E-01-9.38691362E-02 8.78347060E-01 3.83638958E-01
15  4 1.38010882E-02 3.14568522E-02-2.17125967E-02-2.08316376E-02
16  1 4.08010334E-08-3.81353490E-07 4.02156067E-03 1.97856504E-03 5.96770209E-03
16  2 6.25086261E-07 2.86373018E-04 1.41904062E-04 4.25581837E-04-6.51254306E-01
16  3-1.79646303E-01 8.30900608E-01-3.95798732E-01-2.34769651E-01-1.53726312E-01
16  4 6.98888595E-07-1.21186873E-06 1.05970799E-07 3.48899068E-07
17  1-5.37488926E-04-5.57503836E-02-1.84546621E-03 7.44063737E-03-1.22368004E-03
17  2-5.63964870E-02 2.87280772E-01-5.64599400E-01-6.36204942E-03-5.52027901E-01
17  3 6.05707415E-01-5.36795145E-02 4.49112900E-01 2.03068622E-01-5.72679309E-01
17  4 1.83832446E-01 3.91869927E-01-2.56083573E-01-2.48742764E-01
18  1 5.19399745E-02-4.54701512E-02 1.07954170E-01-1.50660392E-01-2.27848543E-02
18  2-1.06135051E-01-9.16471926E-03 6.63551841E-02-1.58271775E-02 1.73019878E-01
18  3-7.43198606E-01 5.70178728E-01 8.22070560E-01 4.81932996E-02-4.52666630E-02
18  4 9.38880563E-01-3.82365609E-01 5.95360580E-01-1.88084879E-01
 $END   

! TRAVIS-CI SMALL

