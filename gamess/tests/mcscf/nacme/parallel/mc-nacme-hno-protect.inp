! test of NACME for three states...HNO, 6-31G, 20 AOs, 7056 determinants
! equal weights given to all states, compare to similar MOLPRO runs.
!
! The MCSCF ran for 2 iterations, the CP-MCHF for 100 iterations
! many details below, but a few key results are
!       STATE-SPECIFIC GRADIENT OF STATE   2 (OVERALL STATE   3)
!       ENERGY=     -129.7681224779 SPIN=  0.00 WEIGHT= 0.333333
!       UNITS ARE HARTREE/BOHR    E'X               E'Y               E'Z
!          1 H                0.030737376      -0.019629887      -0.000000075
!          2 N                0.183930218      -0.000492054       0.000000052
!          3 O               -0.214667594       0.020121941       0.000000023
!
!       NONADIABATIC COUPLING MATRIX ELEMENT (NACME), IN ONE/BOHR
!       <STATE  3, WEIGHT=   0.33333 | D/DQ | STATE  1, WEIGHT=   0.33333>
!         ATOM               D/DX           D/DY           D/DZ
!          1 H              -0.0137740     -0.0374511      0.0000002
!          2 N               0.0096646      0.0538556     -0.0000013
!          3 O               0.0020429     -0.0267395      0.0000010
!
! The test takes 350 seconds on a 2.66 GHz Cloverton (27 Apr 2015)
! tiny precision changes only since 2012
!
! --------------------------------------------------------------------------
! energies from GAMESS (state 2 is a triplet):
!  STATE   1  ENERGY=      -129.8382761646  S=   .00  SZ=   .00  SPACE SYM=A
!  STATE   3  ENERGY=      -129.7681224779  S=   .00  SZ=   .00  SPACE SYM=A
!  STATE   4  ENERGY=      -129.6681147039  S=   .00  SZ=   .00  SPACE SYM=A
! these states are 1= 1-A' ground state, 3= 1-A'' n-> pi*, 4=1-A' pi->pi*
! energies from MOLPRO (run in C1 symmetry)
!         MULTI           MULTI           MULTI           RHF-SCF
!    -129.66811418   -129.76812259   -129.83827655   -129.71107842
!
! MOLPRO, for state specific gradients:
! state 1.1
!  Atom          dE/dx               dE/dy               dE/dz
!    1         0.019995159        -0.030430404         0.000000000
!    2         0.142590073         0.022451808        -0.000000000
!    3        -0.162585231         0.007978596         0.000000000
! state 2.1
!    1         0.030737504        -0.019630785         0.000000000
!    2         0.183929879        -0.000490957        -0.000000000
!    3        -0.214667384         0.020121742         0.000000000
! state 3.1
!    1         0.046731718         0.022996446        -0.000000000
!    2         0.220051428        -0.068886622         0.000000000
!    3        -0.266783146         0.045890176        -0.000000000
! GAMESS gets the following gradients,
!   STATE-SPECIFIC GRADIENT OF STATE   1 WEIGHT=    .33333
!   units are hartree/bohr    E'X               E'Y               E'Z
!    1 H                0.019994966      -0.030430817      -0.000000007
!    2 N                0.142590595       0.022452577       0.000000007
!    3 O               -0.162585561       0.007978240       0.000000000
!   STATE-SPECIFIC GRADIENT OF STATE   2 WEIGHT=    .33333
!    1 H                0.030737376      -0.019629887      -0.000000075
!    2 N                0.183930218      -0.000492054       0.000000052
!    3 O               -0.214667594       0.020121941       0.000000023
!   STATE-SPECIFIC GRADIENT OF STATE   3 WEIGHT=    .33333
!    1 H                0.046732008       0.022996161      -0.000000073
!    2 N                0.220050486      -0.068886484       0.000000076
!    3 O               -0.266782494       0.045890323      -0.000000002
! so there is no change in atom order inside MOLPRO in this particular run.
! By the way, numerical differentiation by GAMESS gives
!        ATOM                 E'X               E'Y               E'Z
!      1 H                0.046776444       0.022915684       0.000000000
!      2 N                0.220125826      -0.068819869       0.000000000
!      3 O               -0.266902271       0.045904185       0.000000000
! for the third root.
!
! for the NACME, first from MOLPRO:
!  SA-MC NACME FOR STATES 2.1 - 1.1
!  Atom          dE/dx               dE/dy               dE/dz
!    1        -0.000000000        -0.000000000         0.688090819
!    2        -0.000000000         0.000000000        -1.229499747
!    3         0.000000000         0.000000000         0.477523136
!  SA-MC NACME FOR STATES 3.1 - 1.1
!    1        -0.013773857        -0.037451984         0.000000000
!    2         0.009664183         0.053855596        -0.000000000
!    3         0.002043484        -0.026739020         0.000000000
!  SA-MC NACME FOR STATES 3.1 - 2.1
!    1         0.000000000         0.000000000         0.596473291
!    2        -0.000000000        -0.000000000        -1.168279454
!    3         0.000000000         0.000000000         0.496833049
! and then from GAMESS:
!   NONADIABATIC COUPLING MATRIX ELEMENT (NACME), in Hartree/Bohr
!   <STATE  2, WEIGHT=    .33333 | D/DQ | STATE  1, WEIGHT=    .33333>
!     ATOM               D/DX         D/DY         D/DZ
!    1 H              -0.0000003      0.0000004      0.7325056
!    2 N               0.0000021      0.0000000     -1.1387157
!    3 O              -0.0000018     -0.0000004      0.3423237
!   <STATE  3, WEIGHT=    .33333 | D/DQ | STATE  1, WEIGHT=    .33333>
!     ATOM               D/DX         D/DY         D/DZ
!    1 H              -0.0137740     -0.0374511      0.0000002
!    2 N               0.0096646      0.0538556     -0.0000013
!    3 O               0.0020429     -0.0267395      0.0000010
!   <STATE  3, WEIGHT=    .33333 | D/DQ | STATE  2, WEIGHT=    .33333>
!     ATOM               D/DX         D/DY         D/DZ
!    1 H               0.0000005      0.0000006      0.6220675
!    2 N              -0.0000015     -0.0000019     -1.0334103
!    3 O               0.0000010      0.0000013      0.3363702
!  The program which is incorrect is MOLPRO (202.6, 2006.1, 2008.1),
!  as a numerical differentiation with MOLPRO gives (for states 1-2):
!     8.81007354D-13  1.72422207D-10  7.32130406D-01
!     7.07392707D-10  1.07419029D-09 -1.13855656D+00
!    -6.49224746D-13  2.16917787D-09  3.42094638D-01
!  which is clearly a good match to GAMESS' analytic result.
!
!    this example is a little time consuming due to the larger
!    active space (there are 7056 determinants), and slow
!    convergence of the response equations (102 iterations)
!
 $contrl scftyp=mcscf mult=1 runtyp=nacme nzvar=3 $end
 $system parall=.true. mwords=5 memddi=2 $end
 $basis  gbasis=n31 ngauss=6 ndfunc=0 $end
 $zmat   izmat(1)= 1,1,2,  1,2,3,  2,1,2,3 $end

!  NSTATE is five so we find three singlet states, averaged equally.
!  Because of MULT=1 in $CONTRL, the IROOT and WSTATE keywords apply
!  to the lowest singlets (absolute roots #1,#3,#4).
 $det    group=c1 ncore=2 nact=9 nels=12 nstate=5
         iroot=2 wstate(1)=1,1,1 $end
 $guess  guess=moread norb=20 $end
 $mcscf  fullnr=.true. $end

 $data
HNO...RHF/6-311G(3df,2p) geometry
Cs

H           1.0  -0.3141033382   0.9751603894   0.0000000000
N           7.0   0.0240772304   0.0014768193   0.0000000000
O           8.0   1.1893489949   0.0007433808   0.0000000000
 $end

--- NATURAL ORBITALS OF MCSCF --- GENERATED AT Wed Dec 19 11:13:28 2007
E(MCSCF)=     -129.7581711051, E(NUC)=       31.3875917648
 $VEC
 1  1-7.11159753E-04-4.18046340E-04 2.37002167E-04-1.09417093E-03-5.83028286E-04
 1  2-6.28652489E-05 0.00000000E+00 9.51191990E-03 5.81333695E-03 1.85954280E-04
 1  3 0.00000000E+00 1.00157253E+00 8.72404964E-03-7.25220273E-03 4.76411108E-04
 1  4 0.00000000E+00-2.86821924E-02 2.47707108E-03 1.42464831E-04 0.00000000E+00
 2  1-1.83572345E-03 2.33905693E-03 9.97116265E-01 2.01142296E-02 3.51244386E-03
 2  2 5.99527614E-04-0.00000000E+00-1.14949042E-02-5.70039247E-04-2.37490680E-03
 2  3-0.00000000E+00 7.13294263E-04-1.82388139E-03-5.30887059E-04 6.18155505E-04
 2  4-0.00000000E+00 8.52508871E-04-9.27710665E-04 8.46864744E-04-0.00000000E+00
 3  1 1.94661810E-02 1.92108052E-02-3.29691066E-02 6.42389862E-02 3.97711092E-02
 3  2 6.26143587E-03 0.00000000E+00-6.44023309E-02-5.89455126E-02-1.22327647E-03
 3  3 0.00000000E+00-2.00074229E-01 5.16210075E-01 1.24426277E-01-1.44638682E-02
 3  4 0.00000000E+00 5.93016014E-01 6.22623202E-02-8.61838430E-03 0.00000000E+00
 4  1-1.82125034E-01-7.85102408E-03 1.86990412E-01-4.43056449E-01-5.83277783E-02
 4  2-1.33082881E-01 0.00000000E+00-4.07855544E-01-9.94118041E-04-7.14123656E-02
 4  3 0.00000000E+00-1.65677396E-02 4.29144147E-02 2.87759364E-01-4.41546709E-02
 4  4 0.00000000E+00 2.27187996E-01 8.87986164E-02-1.20451357E-02 0.00000000E+00
 5  1-2.24216577E-01-1.22583302E-01 7.61412359E-03 1.14344838E-02 4.37525061E-01
 5  2-1.91466560E-01 0.00000000E+00-2.18332794E-01 7.09241051E-02-7.52209149E-02
 5  3 0.00000000E+00-3.42104156E-02 8.76402551E-02-4.37901128E-01-3.27210935E-02
 5  4 0.00000000E+00 1.61676849E-02-2.37940866E-01 5.69360859E-04 0.00000000E+00
 6  1 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00
 6  2 0.00000000E+00 3.95840588E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00
 6  3 2.34772441E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00
 6  4 5.00063718E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00 2.99576960E-01
 7  1 6.32150468E-02 1.77891222E-02 7.02886312E-02-1.61291233E-01 1.80626426E-01
 7  2 3.64749180E-01 0.00000000E+00-2.72874027E-01 9.62052941E-02 2.07643481E-01
 7  3 0.00000000E+00-1.66345472E-02 4.60204167E-02-8.59381847E-02 4.26346759E-01
 7  4 0.00000000E+00 3.32504497E-02-5.57980107E-02 2.60044954E-01 0.00000000E+00
 8  1 2.18548564E-01 2.10102212E-01 5.99770281E-02-1.32114266E-01 1.75323951E-01
 8  2 3.39075687E-01 0.00000000E+00-3.11177597E-01 1.34018122E-01 2.49275364E-01
 8  3 0.00000000E+00-3.07337879E-03 2.14446154E-02-7.33005387E-02-5.41106845E-01
 8  4 0.00000000E+00-4.36671573E-02-2.77672500E-02-4.12885760E-01 0.00000000E+00
 9  1 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00
 9  2 0.00000000E+00 5.48780365E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00
 9  3 4.92943947E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00
 9  4-4.96388293E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00-4.22891957E-01
10  1-5.74312048E-02-4.88087559E-02-9.40443685E-02 4.61235348E-01 8.03312320E-01
10  2 2.43508043E-02 0.00000000E+00 3.91503423E-01 2.72329580E-01 1.21327673E-02
10  3 0.00000000E+00 8.28591769E-02-3.12012642E-01 7.80376115E-01-9.11104097E-03
10  4 0.00000000E+00-4.85232320E-01 2.41669109E-01 1.43492088E-02 0.00000000E+00
11  1-7.07560816E-01-4.58747019E-01-7.25487737E-02 3.89325686E-01-2.64191223E-01
11  2 7.19406115E-01 0.00000000E+00 1.95546860E-01-9.91754650E-02 1.25729888E-01
11  3 0.00000000E+00-6.17072925E-03 3.41819256E-02 1.63849152E-02-2.28652234E-01
11  4 0.00000000E+00 5.67151280E-02-2.66959192E-02 5.65920713E-02 0.00000000E+00
12  1 6.08622033E-01-1.73422118E+00-3.74474371E-02-2.75206418E-01-2.75739684E-01
12  2-3.11589120E-01-0.00000000E+00 2.16765394E+00 1.10243114E+00 8.50861939E-01
12  3-0.00000000E+00 2.01511545E-02 2.30116850E-02-7.90380152E-02 1.05145563E-01
12  4-0.00000000E+00-1.22964450E+00 6.99452075E-01-2.42027290E-01-0.00000000E+00
13  1-3.87620377E-01 1.20934011E+00-7.93410555E-03-1.95564099E-01-4.19724572E-01
13  2 2.12216683E-01-0.00000000E+00 1.04499168E+00 1.97802157E+00-6.85107916E-01
13  3-0.00000000E+00 5.72840076E-02-1.57886817E-01-1.23683215E-01-1.01098037E-01
13  4-0.00000000E+00-1.68789196E+00 8.85379386E-01 2.37715484E-01-0.00000000E+00
14  1 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00
14  2 0.00000000E+00-9.52348072E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00
14  3 1.13370097E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00
14  4-1.59323157E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00-1.00256724E-01
15  1-5.00312736E-01 1.44337886E-01-5.11445053E-02 6.17285147E-01-2.27607697E-01
15  2-6.68525700E-01-0.00000000E+00-6.11175935E-01 3.97539401E-02 1.04452882E+00
15  3-0.00000000E+00-8.22818877E-03 8.03160735E-02 4.98191957E-02-3.00086314E-01
15  4-0.00000000E+00 7.63209682E-02-1.28684777E-01 3.94167859E-02-0.00000000E+00
16  1-2.56521367E-01-3.79845553E-01 1.60920415E-03-5.29382109E-02 4.09513042E-01
16  2-1.01916792E-01-0.00000000E+00 1.48243262E+00-8.13740861E-03 5.08553630E-01
16  3-0.00000000E+00 7.27804112E-02-3.70559518E-01-6.49974695E-01-4.27887412E-02
16  4-0.00000000E+00-3.75541807E-01 1.53047376E+00-8.55378066E-02-0.00000000E+00
17  1 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00
17  2 0.00000000E+00 1.22017379E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00
17  3-5.77621446E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00 0.00000000E+00
17  4-9.18166600E-01 0.00000000E+00 0.00000000E+00 0.00000000E+00 1.27984447E+00
18  1 1.22108612E-01-8.48623311E-01 2.21454098E-02-9.44882737E-01 1.40426069E-01
18  2-1.01921419E-01-0.00000000E+00 1.33381096E+00-2.22950823E-01 9.95090039E-02
18  3-0.00000000E+00-9.90982683E-04-1.16512980E-01 1.24209129E-01-7.54014270E-01
18  4-0.00000000E+00 3.80290899E-02-2.03965080E-01 9.56429761E-01-0.00000000E+00
19  1-7.75727280E-01-7.69127044E-01-1.06970015E-02-1.14659074E+00 3.79645427E-02
19  2-2.02979822E-01 0.00000000E+00 1.85568619E+00-1.87374356E-01 1.44500671E+00
19  3 0.00000000E+00 1.01147883E-02-2.74907512E-01 2.20543773E-01 3.92414092E-01
19  4 0.00000000E+00 4.12502285E-02-3.10629566E-01-8.99523549E-01 0.00000000E+00
20  1 3.61694932E-01 7.63819248E-02 1.03509380E-02 3.83005071E-01-2.59355946E-01
20  2 8.49073818E-03 0.00000000E+00-3.57070656E+00-1.76422920E+00-2.98073349E-01
20  3 0.00000000E+00 2.63007620E-02-1.76502304E+00 1.38169975E-01-1.51679707E-02
20  4 0.00000000E+00 4.53623568E+00-1.99133527E+00 1.11666178E-01 0.00000000E+00
 $END

! TRAVIS-CI SMALL

! TRAVIS-CI SKIP
