C 22 Nov 13 - JMS - simplify machine generated formulae
C 25 MAR 10 - GDF - DIMENSION WITH STANDARD PARAMETER -MXGSH-
C 22 DEC 06 - ST,NK,MC - ADD LC EXCHANGE ARGUMENTS
C  5 FEB 05 - MWS - CHANGE COMMON NAME GAMMAF TO BE FMTTBL INSTEAD
C 10 NOV 04 - MWS - ADJUST CC TOLERANCE
C  7 SEP 04 - GDF - NEW MODULE FOR ERIC'S SPECIAL D ROUTINES
C
C  LPHI=  58
C  LWK1=   1
C  LWK2=  11
C  LENW=  11
C*MODULE INT2D   *DECK DSSS
C>
C>    @brief   ERIC dsss case
C>
C>    @details ERIC [ds|ss] integral quartet
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DSSS (IPRIM,JPRIM,KPRIM,LPRIM,IEQJ,KEQL,
     *                 XC,YC,ZC,XD,YD,ZD,PHI,WK2,LENW)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      LOGICAL    IEQJ,KEQL
      DIMENSION  PHI(*),WK2(LENW,*)
C
      PARAMETER (MXGSH=30, MXG2= MXGSH*MXGSH)
C
      PARAMETER (NTX=4, NPF=450, NGRD=7, NPX=1000, MXQT=16)
      COMMON /FMTTBL/ FGRID(0:NTX,0:NPF,0:NGRD),XGRID(0:NTX,0:NPX)
     *,               TMAX,RFINC(0:NGRD),RXINC
     *,               RMR(MXQT),TLGM(0:MXQT),NORD
      COMMON /ERIPRM/ EXI(MXGSH),EXJ(MXGSH),EXK(MXGSH),EXL(MXGSH),
     *                CCI(MXGSH),CCJ(MXGSH),CCK(MXGSH),CCL(MXGSH),
     *                XAB(MXG2),YAB(MXG2),ZAB(MXG2),
     *                XCD(MXG2),YCD(MXG2),ZCD(MXG2),
     *                CCBRA(MXG2),CCKET(MXG2),RXB(MXG2),
     *                SLBRA(MXG2),SLKET(MXG2),RXK(MXG2)
      LOGICAL         LCFLAG,LRINT
      COMMON /NLRC  / LCFLAG,EMU,EMU2,LRFILE
      COMMON /NLRCF / LRINT
      COMMON /SHLNOS/ QQ4,IDUMMY(20)
C
      DIMENSION  FT(0:16),SFAC( 9),CNF(11)
C
      PARAMETER (ZER=0.0D+00, ONE=1.0D+00, TWO=2.0D+00)
      PARAMETER (CCTOL=1.0D-13)
      DATA CNF/0.0D+00,0.0D+00,0.0D+00,1.0D+00,2.0D+00,3.0D+00,
     &         4.0D+00,5.0D+00,6.0D+00,7.0D+00,8.0D+00/
      SAVE CNF
C
      SFAC(1)= ONE
      PHI( 15)= ZER
      PHI( 17)= ZER
      PHI( 27)= ZER
      PHI( 28)= ZER
      PHI( 29)= ZER
      DO I= 51, 57
         PHI(I)= ZER
      END DO
      KL=0
      DO LL=1,LPRIM
         X04= EXL(LL)
         PHI( 14)= ZER
         PHI( 16)= ZER
         PHI( 24)= ZER
         PHI( 25)= ZER
         PHI( 26)= ZER
         DO I= 44, 50
            PHI(I)= ZER
         END DO
         KTOP= KPRIM
         IF(KEQL) KTOP= LL
         DO KK=1,KTOP
            KL= KL+1
            CFK= CCKET(KL)
            IF(ABS(CFK).GT.CCTOL) THEN
               CFK= CFK*QQ4
               X03= EXK(KK)
               X34= X03+X04
               XKL= XCD(KL)
               YKL= YCD(KL)
               ZKL= ZCD(KL)
               PHI( 13)= ZER
               PHI( 21)= ZER
               PHI( 22)= ZER
               PHI( 23)= ZER
               DO I= 37, 43
                  PHI(I)= ZER
               END DO
               IJ=0
               DO JJ=1,JPRIM
                  X02= EXJ(JJ)
                  PHI( 12)= ZER
                  PHI( 18)= ZER
                  PHI( 19)= ZER
                  PHI( 20)= ZER
                  DO I= 30, 36
                     PHI(I)= ZER
                  END DO
                  ITOP= IPRIM
                  IF(IEQJ) ITOP= JJ
                  DO II=1,ITOP
                     IJ= IJ+1
                     CFB= CCBRA(IJ)
                     IF(ABS(CFB).GT.CCTOL) THEN
                        X01= EXI(II)
                        X12= X01+X02
                        X41= ONE/(X12+X34)
                        FTZ= CFB*CFK
                        RX = XKL-XAB(IJ)
                        RY = YKL-YAB(IJ)
                        RZ = ZKL-ZAB(IJ)
                        RSQ= RX*RX+RY*RY+RZ*RZ
                        RHO= X12*X34*X41
                        IF(LRINT) THEN
                           EFR= EMU2/(EMU2+RHO)
                           RHO= RHO*EFR
                        ENDIF
                        TT = RSQ*RHO
                        N=2
                        IF(TT.LE.TMAX) THEN
C
C     FM(T) EVALUATION
C
                           TV= TT*RFINC(N)
                           IP= NINT(TV)
                           FX=    FGRID(4,IP,N) *TV
                           FX=(FX+FGRID(3,IP,N))*TV
                           FX=(FX+FGRID(2,IP,N))*TV
                           FX=(FX+FGRID(1,IP,N))*TV
                           FX= FX+FGRID(0,IP,N)
                           TV= TT*RXINC
                           IP= NINT(TV)
                           ET=    XGRID(4,IP) *TV
                           ET=(ET+XGRID(3,IP))*TV
                           ET=(ET+XGRID(2,IP))*TV
                           ET=(ET+XGRID(1,IP))*TV
                           ET= ET+XGRID(0,IP)
C
                           FT(N)= FX
                           T2= TT+TT
                              FT(2-1)=(T2*FT(2)+ET)*RMR(2)
                              FT(1-1)=(T2*FT(1)+ET)*RMR(1)
CC                         DO M=N,1,-1
CC                            FT(M-1)=(T2*FT(M)+ET)*RMR(M)
CC                         END DO
C
                           RHO= RHO+RHO
                           IF(LRINT) FTZ= FTZ*SQRT(EFR)
                           FTF= FTZ*SQRT(X41)
                              FT(0)= FT(0)*FTF
                           FTF= FTF*RHO
                              FT(1)= FT(1)*FTF
                           FTF= FTF*RHO
                              FT(2)= FT(2)*FTF
CC                         DO 210 M=0,N
CC                            FT(M)= FT(M)*FTF
CC210                      FTF= FTF*RHO
                        ELSE
                           XIN= ONE/RSQ
                           FTF= FTZ*SQRT(XIN)*SLBRA(IJ)*SLKET(KL)
                           FT(0)= FTF
                              FTF= FTF*XIN
                           FT(1)= TLGM(1)*FTF
                              FTF= FTF*XIN
                           FT(2)= TLGM(2)*FTF
CC                         DO 220 M=1,N
CC                            FTF= FTF*XIN
CC220                      FT(M)= TLGM(M)*FTF
                        END IF
C
                        CALL PHIFTS(3,RX,RY,RZ,PHI,FT)
C
C                       FAC= RXB(IJ)
                        PHI( 12)= PHI( 12)+PHI(  1)
C
                        PHI( 18)= PHI( 18)+PHI(  2)
                        PHI( 19)= PHI( 19)+PHI(  3)
                        PHI( 20)= PHI( 20)+PHI(  4)
                        J=  5
                        DO I= 30, 36
                           PHI(I)= PHI(I)+PHI(J)
                           J=J+1
                        END DO
                     END IF
                  END DO
C                 FAC= EXJ(JJ)*TWO
                  PHI( 13)= PHI( 13)+PHI( 12)
C
                  PHI( 21)= PHI( 21)+PHI( 18)
                  PHI( 22)= PHI( 22)+PHI( 19)
                  PHI( 23)= PHI( 23)+PHI( 20)
                  J= 30
                  DO I= 37, 43
                     PHI(I)= PHI(I)+PHI(J)
                     J=J+1
                  END DO
               END DO
               FAC= RXK(KL)
               SFAC(2)= FAC
               SFAC(3)= SFAC(2)*FAC
               PHI( 14)= PHI( 14)+PHI( 13)*SFAC(2)
               PHI( 16)= PHI( 16)+PHI( 13)*SFAC(3)
C
               PHI( 24)= PHI( 24)+PHI( 21)*SFAC(3)
               PHI( 25)= PHI( 25)+PHI( 22)*SFAC(3)
               PHI( 26)= PHI( 26)+PHI( 23)*SFAC(3)
               J= 37
               DO I= 44, 50
                  PHI(I)= PHI(I)+PHI(J)*SFAC(3)
                  J=J+1
               END DO
            END IF
         END DO
         FAC= EXL(LL)*TWO
         SFAC(2)= FAC
         SFAC(3)= SFAC(2)*FAC
         PHI( 15)= PHI( 15)+PHI( 14)
         PHI( 17)= PHI( 17)+PHI( 16)*SFAC(3)
C
         PHI( 27)= PHI( 27)+PHI( 24)*SFAC(2)
         PHI( 28)= PHI( 28)+PHI( 25)*SFAC(2)
         PHI( 29)= PHI( 29)+PHI( 26)*SFAC(2)
         J= 44
         DO I= 51, 57
            PHI(I)= PHI(I)+PHI(J)
            J=J+1
         END DO
      END DO
C  POST-CONTRACTION PHASE
      PHI( 52)= PHI( 52)-PHI( 51)
      PHI( 54)= PHI( 54)-PHI( 51)
      PHI( 57)= PHI( 57)-PHI( 51)
      WK2(  1,1)= PHI( 17)
      WK2(  2,1)= PHI( 15)
      WK2(  3,1)=-PHI( 27)
      WK2(  4,1)=-PHI( 28)
      WK2(  5,1)=-PHI( 29)
      WK2(  6,1)= PHI( 52)
      WK2(  7,1)= PHI( 53)
      WK2(  8,1)= PHI( 54)
      WK2(  9,1)= PHI( 55)
      WK2( 10,1)= PHI( 56)
      WK2( 11,1)= PHI( 57)
      CNF(1)= XD-XC
      CNF(2)= YD-YC
      CNF(3)= ZD-ZC
      DO I=1,1
         WK2(  6,I)= WK2(  6,I)+WK2(  3,I)*CNF( 1)+WK2(  2,I)*CNF( 4)
         WK2(  7,I)= WK2(  7,I)+WK2(  4,I)*CNF( 1)
         WK2(  8,I)= WK2(  8,I)+WK2(  4,I)*CNF( 2)+WK2(  2,I)*CNF( 4)
         WK2(  9,I)= WK2(  9,I)+WK2(  5,I)*CNF( 1)
         WK2( 10,I)= WK2( 10,I)+WK2(  5,I)*CNF( 2)
         WK2( 11,I)= WK2( 11,I)+WK2(  5,I)*CNF( 3)+WK2(  2,I)*CNF( 4)
C
         WK2(  3,I)= WK2(  3,I)+WK2(  1,I)*CNF( 1)
         WK2(  4,I)= WK2(  4,I)+WK2(  1,I)*CNF( 2)
         WK2(  5,I)= WK2(  5,I)+WK2(  1,I)*CNF( 3)
         WK2(  6,I)= WK2(  6,I)+WK2(  3,I)*CNF( 1)
         WK2(  7,I)= WK2(  7,I)+WK2(  3,I)*CNF( 2)
         WK2(  8,I)= WK2(  8,I)+WK2(  4,I)*CNF( 2)
         WK2(  9,I)= WK2(  9,I)+WK2(  3,I)*CNF( 3)
         WK2( 10,I)= WK2( 10,I)+WK2(  4,I)*CNF( 3)
         WK2( 11,I)= WK2( 11,I)+WK2(  5,I)*CNF( 3)
      END DO
C
      RETURN
      END
C  LPHI= 159
C  LWK1=   4
C  LWK2=  33
C  LENW=  11
C*MODULE INT2D   *DECK DSPS
C>
C>    @brief   ERIC dsps case
C>
C>    @details ERIC [ds|ps] integral quartet
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DSPS (IPRIM,JPRIM,KPRIM,LPRIM,IEQJ,KEQL,
     *                 XA,YA,ZA,XB,YB,ZB,XC,YC,ZC,XD,YD,ZD,
     *                 PHI,WK1,WK2,LENW)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      LOGICAL    IEQJ,KEQL
      DIMENSION  PHI(*),WK1(*),WK2(LENW,*)
C
      PARAMETER (MXGSH=30, MXG2= MXGSH*MXGSH)
C
      PARAMETER (NTX=4, NPF=450, NGRD=7, NPX=1000, MXQT=16)
      COMMON /FMTTBL/ FGRID(0:NTX,0:NPF,0:NGRD),XGRID(0:NTX,0:NPX)
     *,               TMAX,RFINC(0:NGRD),RXINC
     *,               RMR(MXQT),TLGM(0:MXQT),NORD
      COMMON /ERIPRM/ EXI(MXGSH),EXJ(MXGSH),EXK(MXGSH),EXL(MXGSH),
     *                CCI(MXGSH),CCJ(MXGSH),CCK(MXGSH),CCL(MXGSH),
     *                XAB(MXG2),YAB(MXG2),ZAB(MXG2),
     *                XCD(MXG2),YCD(MXG2),ZCD(MXG2),
     *                CCBRA(MXG2),CCKET(MXG2),RXB(MXG2),
     *                SLBRA(MXG2),SLKET(MXG2),RXK(MXG2)
      LOGICAL         LCFLAG,LRINT
      COMMON /NLRC  / LCFLAG,EMU,EMU2,LRFILE
      COMMON /NLRCF / LRINT
      COMMON /SHLNOS/ QQ4,IDUMMY(20)
C
      DIMENSION  FT(0:16),SFAC( 9),CNF(11)
C
      PARAMETER (NL=  3, NK=  3, NJ=  3, NI=  2)
      DIMENSION  LSF(NL),KSF(NK),JSF(NJ),ISF(NI)
      DIMENSION  LJI(NL),KJI(NK),JJI(NJ),IJI(NI)
      DIMENSION  L0I(NL),K0I(NK),J0I(NJ),I0I(NI)
      DIMENSION  L0F(NL),K0F(NK),J0F(NJ),I0F(NI)
C
      PARAMETER (ZER=0.0D+00, ONE=1.0D+00, TWO=2.0D+00)
      PARAMETER (CCTOL=1.0D-13)
      DATA CNF/0.0D+00,0.0D+00,0.0D+00,1.0D+00,2.0D+00,3.0D+00,
     &         4.0D+00,5.0D+00,6.0D+00,7.0D+00,8.0D+00/
      SAVE CNF
C
      DATA LSF/  2,  1,  1/
      DATA LJI/ 72, 93,133/
      DATA L0I/ 79,100,146/
      DATA L0F/ 85,106,158/
C
      DATA KSF/  3,  3,  3/
      DATA KJI/ 65, 86,120/
      DATA K0I/ 72, 93,133/
      DATA K0F/ 78, 99,145/
C
      DATA JSF/  1,  2,  1/
      DATA JJI/ 58, 58,107/
      DATA J0I/ 65, 86,120/
      DATA J0F/ 71, 92,132/
C
      DATA ISF/  2,  2/
      DATA IJI/  5, 12/
      DATA I0I/ 58,107/
      DATA I0F/ 64,119/
C
      SFAC(1)= ONE
      PHI( 28)= ZER
      PHI( 30)= ZER
      PHI( 40)= ZER
      PHI( 41)= ZER
      PHI( 42)= ZER
      PHI( 46)= ZER
      PHI( 47)= ZER
      PHI( 48)= ZER
      PHI( 55)= ZER
      PHI( 56)= ZER
      PHI( 57)= ZER
      DO N= 1,NL
         DO I=L0I(N),L0F(N)
            PHI(I)= ZER
         END DO
      END DO
      KL=0
      DO LL=1,LPRIM
         X04= EXL(LL)
         PHI( 27)= ZER
         PHI( 29)= ZER
         PHI( 37)= ZER
         PHI( 38)= ZER
         PHI( 39)= ZER
         PHI( 43)= ZER
         PHI( 44)= ZER
         PHI( 45)= ZER
         PHI( 52)= ZER
         PHI( 53)= ZER
         PHI( 54)= ZER
         DO N= 1,NK
            DO I=K0I(N),K0F(N)
               PHI(I)= ZER
            END DO
         END DO
         KTOP= KPRIM
         IF(KEQL) KTOP= LL
         DO KK=1,KTOP
            KL= KL+1
            CFK= CCKET(KL)
            IF(ABS(CFK).GT.CCTOL) THEN
               CFK= CFK*QQ4
               X03= EXK(KK)
               X34= X03+X04
               XKL= XCD(KL)
               YKL= YCD(KL)
               ZKL= ZCD(KL)
               PHI( 26)= ZER
               PHI( 34)= ZER
               PHI( 35)= ZER
               PHI( 36)= ZER
               PHI( 49)= ZER
               PHI( 50)= ZER
               PHI( 51)= ZER
               DO N= 1,NJ
                  DO I=J0I(N),J0F(N)
                     PHI(I)= ZER
                  END DO
               END DO
               IJ=0
               DO JJ=1,JPRIM
                  X02= EXJ(JJ)
                  PHI( 25)= ZER
                  PHI( 31)= ZER
                  PHI( 32)= ZER
                  PHI( 33)= ZER
                  DO N= 1,NI
                     DO I=I0I(N),I0F(N)
                        PHI(I)= ZER
                     END DO
                  END DO
                  ITOP= IPRIM
                  IF(IEQJ) ITOP= JJ
                  DO II=1,ITOP
                     IJ= IJ+1
                     CFB= CCBRA(IJ)
                     IF(ABS(CFB).GT.CCTOL) THEN
                        X01= EXI(II)
                        X12= X01+X02
                        X41= ONE/(X12+X34)
                        FTZ= CFB*CFK
                        RX = XKL-XAB(IJ)
                        RY = YKL-YAB(IJ)
                        RZ = ZKL-ZAB(IJ)
                        RSQ= RX*RX+RY*RY+RZ*RZ
                        RHO= X12*X34*X41
                        IF(LRINT) THEN
                           EFR= EMU2/(EMU2+RHO)
                           RHO= RHO*EFR
                        ENDIF
                        TT = RSQ*RHO
                        N=3
                        IF(TT.LE.TMAX) THEN
C
C     FM(T) EVALUATION
C
                           TV= TT*RFINC(N)
                           IP= NINT(TV)
                           FX=    FGRID(4,IP,N) *TV
                           FX=(FX+FGRID(3,IP,N))*TV
                           FX=(FX+FGRID(2,IP,N))*TV
                           FX=(FX+FGRID(1,IP,N))*TV
                           FX= FX+FGRID(0,IP,N)
                           TV= TT*RXINC
                           IP= NINT(TV)
                           ET=    XGRID(4,IP) *TV
                           ET=(ET+XGRID(3,IP))*TV
                           ET=(ET+XGRID(2,IP))*TV
                           ET=(ET+XGRID(1,IP))*TV
                           ET= ET+XGRID(0,IP)
C
                           FT(N)= FX
                           T2= TT+TT
                              FT(3-1)=(T2*FT(3)+ET)*RMR(3)
                              FT(2-1)=(T2*FT(2)+ET)*RMR(2)
                              FT(1-1)=(T2*FT(1)+ET)*RMR(1)
CC                         DO M=N,1,-1
CC                            FT(M-1)=(T2*FT(M)+ET)*RMR(M)
CC                         END DO
C
                           RHO= RHO+RHO
                           IF(LRINT) FTZ= FTZ*SQRT(EFR)
                           FTF= FTZ*SQRT(X41)
                              FT(0)= FT(0)*FTF
                           FTF= FTF*RHO
                              FT(1)= FT(1)*FTF
                           FTF= FTF*RHO
                              FT(2)= FT(2)*FTF
                           FTF= FTF*RHO
                              FT(3)= FT(3)*FTF
CC                         DO 210 M=0,N
CC                            FT(M)= FT(M)*FTF
CC210                      FTF= FTF*RHO
                        ELSE
                           XIN= ONE/RSQ
                           FTF= FTZ*SQRT(XIN)*SLBRA(IJ)*SLKET(KL)
                           FT(0)= FTF
                              FTF= FTF*XIN
                           FT(1)= TLGM(1)*FTF
                              FTF= FTF*XIN
                           FT(2)= TLGM(2)*FTF
                              FTF= FTF*XIN
                           FT(3)= TLGM(3)*FTF
CC                         DO 220 M=1,N
CC                            FTF= FTF*XIN
CC220                      FT(M)= TLGM(M)*FTF
                        END IF
C
                        CALL PHIFTS(4,RX,RY,RZ,PHI,FT)
C
                        FAC= RXB(IJ)
                        SFAC(2)= FAC
                        PHI( 25)= PHI( 25)+PHI(  1)*SFAC(2)
C
                        PHI( 31)= PHI( 31)+PHI(  2)*SFAC(2)
                        PHI( 32)= PHI( 32)+PHI(  3)*SFAC(2)
                        PHI( 33)= PHI( 33)+PHI(  4)*SFAC(2)
                        DO N= 1,NI
                           FAC= SFAC(ISF(N))
                           J=IJI(N)
                           DO I=I0I(N),I0F(N)
                              PHI(I)= PHI(I)+PHI(J)*FAC
                              J=J+1
                           END DO
                        END DO
                     END IF
                  END DO
                  FAC= EXJ(JJ)*TWO
                  SFAC(2)= FAC
                  PHI( 26)= PHI( 26)+PHI( 25)*SFAC(2)
C
                  PHI( 34)= PHI( 34)+PHI( 31)
                  PHI( 35)= PHI( 35)+PHI( 32)
                  PHI( 36)= PHI( 36)+PHI( 33)
                  PHI( 49)= PHI( 49)+PHI( 31)*SFAC(2)
                  PHI( 50)= PHI( 50)+PHI( 32)*SFAC(2)
                  PHI( 51)= PHI( 51)+PHI( 33)*SFAC(2)
                  DO N= 1,NJ
                     FAC= SFAC(JSF(N))
                     J=JJI(N)
                     IF(FAC.EQ.ONE) THEN
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)
                           J=J+1
                        END DO
                     ELSE
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)*FAC
                           J=J+1
                        END DO
                     END IF
                  END DO
               END DO
               FAC= RXK(KL)
               SFAC(2)= FAC
               SFAC(3)= SFAC(2)*FAC
               PHI( 27)= PHI( 27)+PHI( 26)*SFAC(2)
               PHI( 29)= PHI( 29)+PHI( 26)*SFAC(3)
C
               PHI( 37)= PHI( 37)+PHI( 34)*SFAC(2)
               PHI( 38)= PHI( 38)+PHI( 35)*SFAC(2)
               PHI( 39)= PHI( 39)+PHI( 36)*SFAC(2)
               PHI( 43)= PHI( 43)+PHI( 34)*SFAC(3)
               PHI( 44)= PHI( 44)+PHI( 35)*SFAC(3)
               PHI( 45)= PHI( 45)+PHI( 36)*SFAC(3)
               PHI( 52)= PHI( 52)+PHI( 49)*SFAC(3)
               PHI( 53)= PHI( 53)+PHI( 50)*SFAC(3)
               PHI( 54)= PHI( 54)+PHI( 51)*SFAC(3)
               DO N= 1,NK
                  FAC= SFAC(KSF(N))
                  J=KJI(N)
                  DO I=K0I(N),K0F(N)
                     PHI(I)= PHI(I)+PHI(J)*FAC
                     J=J+1
                  END DO
               END DO
            END IF
         END DO
         FAC= EXL(LL)*TWO
         SFAC(2)= FAC
         SFAC(3)= SFAC(2)*FAC
         PHI( 28)= PHI( 28)+PHI( 27)
         PHI( 30)= PHI( 30)+PHI( 29)*SFAC(3)
C
         PHI( 40)= PHI( 40)+PHI( 37)
         PHI( 41)= PHI( 41)+PHI( 38)
         PHI( 42)= PHI( 42)+PHI( 39)
         PHI( 46)= PHI( 46)+PHI( 43)*SFAC(3)
         PHI( 47)= PHI( 47)+PHI( 44)*SFAC(3)
         PHI( 48)= PHI( 48)+PHI( 45)*SFAC(3)
         PHI( 55)= PHI( 55)+PHI( 52)*SFAC(2)
         PHI( 56)= PHI( 56)+PHI( 53)*SFAC(2)
         PHI( 57)= PHI( 57)+PHI( 54)*SFAC(2)
         DO N= 1,NL
            FAC= SFAC(LSF(N))
            J=LJI(N)
            IF(FAC.EQ.ONE) THEN
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)
                  J=J+1
               END DO
            ELSE
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)*FAC
                  J=J+1
               END DO
            END IF
         END DO
      END DO
C  POST-CONTRACTION PHASE
      PHI( 80)= PHI( 80)-PHI( 79)
      PHI( 82)= PHI( 82)-PHI( 79)
      PHI( 85)= PHI( 85)-PHI( 79)
      PHI(101)= PHI(101)-PHI(100)
      PHI(103)= PHI(103)-PHI(100)
      PHI(106)= PHI(106)-PHI(100)
      III=106+ 30
      III=III+ 13
      CALL PHIIJ3(III,PHI)
C
      CNF(1)= XB-XA
      CNF(2)= YB-YA
      CNF(3)= ZB-ZA
      WK1(  2)= PHI( 46)+PHI( 30)*CNF( 1)
      WK1(  3)= PHI( 47)+PHI( 30)*CNF( 2)
      WK1(  4)= PHI( 48)+PHI( 30)*CNF( 3)
      CALL DSPS_BCTE(WK1,WK2,LENW, 1)
      WK1(  2)= PHI( 40)+PHI( 28)*CNF( 1)
      WK1(  3)= PHI( 41)+PHI( 28)*CNF( 2)
      WK1(  4)= PHI( 42)+PHI( 28)*CNF( 3)
      CALL DSPS_BCTE(WK1,WK2,LENW, 2)
      I= 80
      J= 55
      L=3
      DO K=  3,  5
         IF(K.EQ. 5) I=I+1
         IF(K.EQ. 5) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DSPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=149
      J=101
      L=4
      DO K=  6, 11
         IF(K.EQ. 9 .OR. K.EQ.11) I=I+1
         IF(K.EQ. 9 .OR. K.EQ.11) L=L-1
         WK1(  2)= PHI(I  )+PHI(J)*CNF( 1)
         WK1(  3)= PHI(I+1)+PHI(J)*CNF( 2)
         WK1(  4)= PHI(I+L)+PHI(J)*CNF( 3)
         CALL DSPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      CNF(1)= XD-XC
      CNF(2)= YD-YC
      CNF(3)= ZD-ZC
      DO I=1,3
         WK2(  6,I)= WK2(  6,I)+WK2(  3,I)*CNF( 1)+WK2(  2,I)*CNF( 4)
         WK2(  7,I)= WK2(  7,I)+WK2(  4,I)*CNF( 1)
         WK2(  8,I)= WK2(  8,I)+WK2(  4,I)*CNF( 2)+WK2(  2,I)*CNF( 4)
         WK2(  9,I)= WK2(  9,I)+WK2(  5,I)*CNF( 1)
         WK2( 10,I)= WK2( 10,I)+WK2(  5,I)*CNF( 2)
         WK2( 11,I)= WK2( 11,I)+WK2(  5,I)*CNF( 3)+WK2(  2,I)*CNF( 4)
C
         WK2(  3,I)= WK2(  3,I)+WK2(  1,I)*CNF( 1)
         WK2(  4,I)= WK2(  4,I)+WK2(  1,I)*CNF( 2)
         WK2(  5,I)= WK2(  5,I)+WK2(  1,I)*CNF( 3)
         WK2(  6,I)= WK2(  6,I)+WK2(  3,I)*CNF( 1)
         WK2(  7,I)= WK2(  7,I)+WK2(  3,I)*CNF( 2)
         WK2(  8,I)= WK2(  8,I)+WK2(  4,I)*CNF( 2)
         WK2(  9,I)= WK2(  9,I)+WK2(  3,I)*CNF( 3)
         WK2( 10,I)= WK2( 10,I)+WK2(  4,I)*CNF( 3)
         WK2( 11,I)= WK2( 11,I)+WK2(  5,I)*CNF( 3)
      END DO
C
      RETURN
      END
C*MODULE INT2D   *DECK DSPS_BCTE
C>
C>    @brief   ERIC dsps backtransfer
C>
C>    @details ERIC [ds|ps] backtransfer step
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DSPS_BCTE(WK1,WK2,LENW,JR)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    LENW,I,J,JR
      DIMENSION  WK1(*),WK2(LENW,*)
C
      J=  1
      DO I=1,3
         J=J+1
         WK2(JR,I)= WK1(J)
      END DO
C
      RETURN
      END
C  LPHI= 453
C  LWK1=  11
C  LWK2= 144
C  LENW=  24
C*MODULE INT2D   *DECK DSPP
C>
C>    @brief   ERIC dspp case
C>
C>    @details ERIC [ds|pp] integral quartet
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DSPP (IPRIM,JPRIM,KPRIM,LPRIM,IEQJ,KEQL,
     *                 XA,YA,ZA,XB,YB,ZB,XC,YC,ZC,XD,YD,ZD,
     *                 PHI,WK1,WK2,LENW)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      LOGICAL    IEQJ,KEQL
      DIMENSION  PHI(*),WK1(*),WK2(LENW,*)
C
      PARAMETER (MXGSH=30, MXG2= MXGSH*MXGSH)
C
      PARAMETER (NTX=4, NPF=450, NGRD=7, NPX=1000, MXQT=16)
      COMMON /FMTTBL/ FGRID(0:NTX,0:NPF,0:NGRD),XGRID(0:NTX,0:NPX)
     *,               TMAX,RFINC(0:NGRD),RXINC
     *,               RMR(MXQT),TLGM(0:MXQT),NORD
      COMMON /ERIPRM/ EXI(MXGSH),EXJ(MXGSH),EXK(MXGSH),EXL(MXGSH),
     *                CCI(MXGSH),CCJ(MXGSH),CCK(MXGSH),CCL(MXGSH),
     *                XAB(MXG2),YAB(MXG2),ZAB(MXG2),
     *                XCD(MXG2),YCD(MXG2),ZCD(MXG2),
     *                CCBRA(MXG2),CCKET(MXG2),RXB(MXG2),
     *                SLBRA(MXG2),SLKET(MXG2),RXK(MXG2)
      LOGICAL         LCFLAG,LRINT
      COMMON /NLRC  / LCFLAG,EMU,EMU2,LRFILE
      COMMON /NLRCF / LRINT
      COMMON /SHLNOS/ QQ4,IDUMMY(20)
C
      DIMENSION  FT(0:16),SFAC( 9),CNF(11)
C
      PARAMETER (NL= 11, NK= 10, NJ=  7, NI=  4)
      DIMENSION  LSF(NL),KSF(NK),JSF(NJ),ISF(NI)
      DIMENSION  LJI(NL),KJI(NK),JJI(NJ),IJI(NI)
      DIMENSION  L0I(NL),K0I(NK),J0I(NJ),I0I(NI)
      DIMENSION  L0F(NL),K0F(NK),J0F(NJ),I0F(NI)
C
      PARAMETER (ZER=0.0D+00, ONE=1.0D+00, TWO=2.0D+00)
      PARAMETER (CCTOL=1.0D-13)
      DATA CNF/0.0D+00,0.0D+00,0.0D+00,1.0D+00,2.0D+00,3.0D+00,
     &         4.0D+00,5.0D+00,6.0D+00,7.0D+00,8.0D+00/
      SAVE CNF
C
      DATA LSF/  1,  1,  2,  3,  1,  2,  1,  1,  2,  1,  1/
      DATA LJI/129,157,157,178,199,213,234,274,300,339,409/
      DATA L0I/136,164,171,185,206,220,241,287,313,352,431/
      DATA L0F/142,170,177,191,212,226,247,299,325,364,452/
C
      DATA KSF/  3,  2,  3,  2,  3,  3,  2,  3,  3,  3/
      DATA KJI/122,150,150,192,192,227,261,261,326,387/
      DATA K0I/129,157,178,199,213,234,274,300,339,409/
      DATA K0F/135,163,184,205,219,240,286,312,351,430/
C
      DATA JSF/  1,  1,  2,  3,  1,  2,  1/
      DATA JJI/115,143,143,143,248,248,365/
      DATA J0I/122,150,192,227,261,326,387/
      DATA J0F/128,156,198,233,273,338,408/
C
      DATA ISF/  2,  3,  3,  3/
      DATA IJI/  5,  5, 12, 25/
      DATA I0I/115,143,248,365/
      DATA I0F/121,149,260,386/
C
      SFAC(1)= ONE
      PHI( 50)= ZER
      PHI( 51)= ZER
      PHI( 53)= ZER
      PHI( 57)= ZER
      PHI( 58)= ZER
      PHI( 60)= ZER
      PHI( 70)= ZER
      PHI( 71)= ZER
      PHI( 72)= ZER
      PHI( 76)= ZER
      PHI( 77)= ZER
      PHI( 78)= ZER
      PHI( 88)= ZER
      PHI( 89)= ZER
      PHI( 90)= ZER
      PHI( 91)= ZER
      PHI( 92)= ZER
      PHI( 93)= ZER
      PHI( 97)= ZER
      PHI( 98)= ZER
      PHI( 99)= ZER
      PHI(106)= ZER
      PHI(107)= ZER
      PHI(108)= ZER
      PHI(112)= ZER
      PHI(113)= ZER
      PHI(114)= ZER
      DO N= 1,NL
         DO I=L0I(N),L0F(N)
            PHI(I)= ZER
         END DO
      END DO
      KL=0
      DO LL=1,LPRIM
         X04= EXL(LL)
         PHI( 49)= ZER
         PHI( 52)= ZER
         PHI( 56)= ZER
         PHI( 59)= ZER
         PHI( 67)= ZER
         PHI( 68)= ZER
         PHI( 69)= ZER
         PHI( 73)= ZER
         PHI( 74)= ZER
         PHI( 75)= ZER
         PHI( 85)= ZER
         PHI( 86)= ZER
         PHI( 87)= ZER
         PHI( 94)= ZER
         PHI( 95)= ZER
         PHI( 96)= ZER
         PHI(103)= ZER
         PHI(104)= ZER
         PHI(105)= ZER
         PHI(109)= ZER
         PHI(110)= ZER
         PHI(111)= ZER
         DO N= 1,NK
            DO I=K0I(N),K0F(N)
               PHI(I)= ZER
            END DO
         END DO
         KTOP= KPRIM
         IF(KEQL) KTOP= LL
         DO KK=1,KTOP
            KL= KL+1
            CFK= CCKET(KL)
            IF(ABS(CFK).GT.CCTOL) THEN
               CFK= CFK*QQ4
               X03= EXK(KK)
               X34= X03+X04
               XKL= XCD(KL)
               YKL= YCD(KL)
               ZKL= ZCD(KL)
               PHI( 48)= ZER
               PHI( 55)= ZER
               PHI( 64)= ZER
               PHI( 65)= ZER
               PHI( 66)= ZER
               PHI( 82)= ZER
               PHI( 83)= ZER
               PHI( 84)= ZER
               PHI(100)= ZER
               PHI(101)= ZER
               PHI(102)= ZER
               DO N= 1,NJ
                  DO I=J0I(N),J0F(N)
                     PHI(I)= ZER
                  END DO
               END DO
               IJ=0
               DO JJ=1,JPRIM
                  X02= EXJ(JJ)
                  PHI( 47)= ZER
                  PHI( 54)= ZER
                  PHI( 61)= ZER
                  PHI( 62)= ZER
                  PHI( 63)= ZER
                  PHI( 79)= ZER
                  PHI( 80)= ZER
                  PHI( 81)= ZER
                  DO N= 1,NI
                     DO I=I0I(N),I0F(N)
                        PHI(I)= ZER
                     END DO
                  END DO
                  ITOP= IPRIM
                  IF(IEQJ) ITOP= JJ
                  DO II=1,ITOP
                     IJ= IJ+1
                     CFB= CCBRA(IJ)
                     IF(ABS(CFB).GT.CCTOL) THEN
                        X01= EXI(II)
                        X12= X01+X02
                        X41= ONE/(X12+X34)
                        FTZ= CFB*CFK
                        RX = XKL-XAB(IJ)
                        RY = YKL-YAB(IJ)
                        RZ = ZKL-ZAB(IJ)
                        RSQ= RX*RX+RY*RY+RZ*RZ
                        RHO= X12*X34*X41
                        IF(LRINT) THEN
                           EFR= EMU2/(EMU2+RHO)
                           RHO= RHO*EFR
                        ENDIF
                        TT = RSQ*RHO
                        N=4
                        IF(TT.LE.TMAX) THEN
C
C     FM(T) EVALUATION
C
                           TV= TT*RFINC(N)
                           IP= NINT(TV)
                           FX=    FGRID(4,IP,N) *TV
                           FX=(FX+FGRID(3,IP,N))*TV
                           FX=(FX+FGRID(2,IP,N))*TV
                           FX=(FX+FGRID(1,IP,N))*TV
                           FX= FX+FGRID(0,IP,N)
                           TV= TT*RXINC
                           IP= NINT(TV)
                           ET=    XGRID(4,IP) *TV
                           ET=(ET+XGRID(3,IP))*TV
                           ET=(ET+XGRID(2,IP))*TV
                           ET=(ET+XGRID(1,IP))*TV
                           ET= ET+XGRID(0,IP)
C
                           FT(N)= FX
                           T2= TT+TT
                           DO M=N,1,-1
                              FT(M-1)=(T2*FT(M)+ET)*RMR(M)
                           END DO
C
                           RHO= RHO+RHO
                           IF(LRINT) FTZ= FTZ*SQRT(EFR)
                           FTF= FTZ*SQRT(X41)
                           DO 210 M=0,N
                              FT(M)= FT(M)*FTF
  210                      FTF= FTF*RHO
                        ELSE
                           XIN= ONE/RSQ
                           FTF= FTZ*SQRT(XIN)*SLBRA(IJ)*SLKET(KL)
                           FT(0)= FTF
                           DO 220 M=1,N
                              FTF= FTF*XIN
  220                      FT(M)= TLGM(M)*FTF
                        END IF
C
                        CALL PHIFTS(5,RX,RY,RZ,PHI,FT)
C
                        FAC= RXB(IJ)
                        SFAC(2)= FAC
                        SFAC(3)= SFAC(2)*FAC
                        PHI( 47)= PHI( 47)+PHI(  1)*SFAC(2)
                        PHI( 54)= PHI( 54)+PHI(  1)*SFAC(3)
C
                        PHI( 61)= PHI( 61)+PHI(  2)*SFAC(2)
                        PHI( 62)= PHI( 62)+PHI(  3)*SFAC(2)
                        PHI( 63)= PHI( 63)+PHI(  4)*SFAC(2)
                        PHI( 79)= PHI( 79)+PHI(  2)*SFAC(3)
                        PHI( 80)= PHI( 80)+PHI(  3)*SFAC(3)
                        PHI( 81)= PHI( 81)+PHI(  4)*SFAC(3)
                        DO N= 1,NI
                           FAC= SFAC(ISF(N))
                           J=IJI(N)
                           DO I=I0I(N),I0F(N)
                              PHI(I)= PHI(I)+PHI(J)*FAC
                              J=J+1
                           END DO
                        END DO
                     END IF
                  END DO
                  FAC= EXJ(JJ)*TWO
                  SFAC(2)= FAC
                  SFAC(3)= SFAC(2)*FAC
                  PHI( 48)= PHI( 48)+PHI( 47)
                  PHI( 55)= PHI( 55)+PHI( 54)*SFAC(3)
C
                  PHI( 64)= PHI( 64)+PHI( 61)
                  PHI( 65)= PHI( 65)+PHI( 62)
                  PHI( 66)= PHI( 66)+PHI( 63)
                  PHI( 82)= PHI( 82)+PHI( 79)*SFAC(2)
                  PHI( 83)= PHI( 83)+PHI( 80)*SFAC(2)
                  PHI( 84)= PHI( 84)+PHI( 81)*SFAC(2)
                  PHI(100)= PHI(100)+PHI( 79)*SFAC(3)
                  PHI(101)= PHI(101)+PHI( 80)*SFAC(3)
                  PHI(102)= PHI(102)+PHI( 81)*SFAC(3)
                  DO N= 1,NJ
                     FAC= SFAC(JSF(N))
                     J=JJI(N)
                     IF(FAC.EQ.ONE) THEN
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)
                           J=J+1
                        END DO
                     ELSE
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)*FAC
                           J=J+1
                        END DO
                     END IF
                  END DO
               END DO
               FAC= RXK(KL)
               SFAC(2)= FAC
               SFAC(3)= SFAC(2)*FAC
               PHI( 49)= PHI( 49)+PHI( 48)*SFAC(2)
               PHI( 52)= PHI( 52)+PHI( 48)*SFAC(3)
               PHI( 56)= PHI( 56)+PHI( 55)*SFAC(2)
               PHI( 59)= PHI( 59)+PHI( 55)*SFAC(3)
C
               PHI( 67)= PHI( 67)+PHI( 64)*SFAC(2)
               PHI( 68)= PHI( 68)+PHI( 65)*SFAC(2)
               PHI( 69)= PHI( 69)+PHI( 66)*SFAC(2)
               PHI( 73)= PHI( 73)+PHI( 64)*SFAC(3)
               PHI( 74)= PHI( 74)+PHI( 65)*SFAC(3)
               PHI( 75)= PHI( 75)+PHI( 66)*SFAC(3)
               PHI( 85)= PHI( 85)+PHI( 82)*SFAC(2)
               PHI( 86)= PHI( 86)+PHI( 83)*SFAC(2)
               PHI( 87)= PHI( 87)+PHI( 84)*SFAC(2)
               PHI( 94)= PHI( 94)+PHI( 82)*SFAC(3)
               PHI( 95)= PHI( 95)+PHI( 83)*SFAC(3)
               PHI( 96)= PHI( 96)+PHI( 84)*SFAC(3)
               PHI(103)= PHI(103)+PHI(100)*SFAC(2)
               PHI(104)= PHI(104)+PHI(101)*SFAC(2)
               PHI(105)= PHI(105)+PHI(102)*SFAC(2)
               PHI(109)= PHI(109)+PHI(100)*SFAC(3)
               PHI(110)= PHI(110)+PHI(101)*SFAC(3)
               PHI(111)= PHI(111)+PHI(102)*SFAC(3)
               DO N= 1,NK
                  FAC= SFAC(KSF(N))
                  J=KJI(N)
                  DO I=K0I(N),K0F(N)
                     PHI(I)= PHI(I)+PHI(J)*FAC
                     J=J+1
                  END DO
               END DO
            END IF
         END DO
         FAC= EXL(LL)*TWO
         SFAC(2)= FAC
         SFAC(3)= SFAC(2)*FAC
         PHI( 50)= PHI( 50)+PHI( 49)
         PHI( 51)= PHI( 51)+PHI( 49)*SFAC(2)
         PHI( 53)= PHI( 53)+PHI( 52)*SFAC(3)
         PHI( 57)= PHI( 57)+PHI( 56)
         PHI( 58)= PHI( 58)+PHI( 56)*SFAC(2)
         PHI( 60)= PHI( 60)+PHI( 59)*SFAC(3)
C
         PHI( 70)= PHI( 70)+PHI( 67)
         PHI( 71)= PHI( 71)+PHI( 68)
         PHI( 72)= PHI( 72)+PHI( 69)
         PHI( 76)= PHI( 76)+PHI( 73)*SFAC(2)
         PHI( 77)= PHI( 77)+PHI( 74)*SFAC(2)
         PHI( 78)= PHI( 78)+PHI( 75)*SFAC(2)
         PHI( 88)= PHI( 88)+PHI( 85)
         PHI( 89)= PHI( 89)+PHI( 86)
         PHI( 90)= PHI( 90)+PHI( 87)
         PHI( 91)= PHI( 91)+PHI( 85)*SFAC(2)
         PHI( 92)= PHI( 92)+PHI( 86)*SFAC(2)
         PHI( 93)= PHI( 93)+PHI( 87)*SFAC(2)
         PHI( 97)= PHI( 97)+PHI( 94)*SFAC(3)
         PHI( 98)= PHI( 98)+PHI( 95)*SFAC(3)
         PHI( 99)= PHI( 99)+PHI( 96)*SFAC(3)
         PHI(106)= PHI(106)+PHI(103)
         PHI(107)= PHI(107)+PHI(104)
         PHI(108)= PHI(108)+PHI(105)
         PHI(112)= PHI(112)+PHI(109)*SFAC(2)
         PHI(113)= PHI(113)+PHI(110)*SFAC(2)
         PHI(114)= PHI(114)+PHI(111)*SFAC(2)
         DO N= 1,NL
            FAC= SFAC(LSF(N))
            J=LJI(N)
            IF(FAC.EQ.ONE) THEN
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)
                  J=J+1
               END DO
            ELSE
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)*FAC
                  J=J+1
               END DO
            END IF
         END DO
      END DO
C  POST-CONTRACTION PHASE
      PHI(137)= PHI(137)-PHI(136)
      PHI(139)= PHI(139)-PHI(136)
      PHI(142)= PHI(142)-PHI(136)
      PHI(165)= PHI(165)-PHI(164)
      PHI(167)= PHI(167)-PHI(164)
      PHI(170)= PHI(170)-PHI(164)
      PHI(172)= PHI(172)-PHI(171)
      PHI(174)= PHI(174)-PHI(171)
      PHI(177)= PHI(177)-PHI(171)
      PHI(186)= PHI(186)-PHI(185)
      PHI(188)= PHI(188)-PHI(185)
      PHI(191)= PHI(191)-PHI(185)
      PHI(207)= PHI(207)-PHI(206)
      PHI(209)= PHI(209)-PHI(206)
      PHI(212)= PHI(212)-PHI(206)
      PHI(221)= PHI(221)-PHI(220)
      PHI(223)= PHI(223)-PHI(220)
      PHI(226)= PHI(226)-PHI(220)
      PHI(242)= PHI(242)-PHI(241)
      PHI(244)= PHI(244)-PHI(241)
      PHI(247)= PHI(247)-PHI(241)
      III=247+ 30
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
      III=III+ 13*3
      CALL PHIIJ3(III,PHI)
C
      III=III+ 61
      III=III+ 22
      CALL PHIIJ4(III,PHI)
C
      CNF(1)= XB-XA
      CNF(2)= YB-YA
      CNF(3)= ZB-ZA
      WK1(  3)=          PHI( 91)        +PHI( 58)*CNF( 1)
      WK1(  4)=          PHI( 92)        +PHI( 58)*CNF( 2)
      WK1(  5)=          PHI( 93)        +PHI( 58)*CNF( 3)
      WK1(  6)= PHI(172)+PHI( 91)*CNF( 1)+PHI( 51)*CNF( 4)
      WK1(  7)= PHI(173)+PHI( 92)*CNF( 1)
      WK1(  8)= PHI(174)+PHI( 92)*CNF( 2)+PHI( 51)*CNF( 4)
      WK1(  9)= PHI(175)+PHI( 93)*CNF( 1)
      WK1( 10)= PHI(176)+PHI( 93)*CNF( 2)
      WK1( 11)= PHI(177)+PHI( 93)*CNF( 3)+PHI( 51)*CNF( 4)
      CALL DSPP_BCTE(WK1,WK2,LENW,CNF, 1)
      I=207
      J=106
      L=3
      DO K=  2,  4
         IF(K.EQ. 4) I=I+1
         IF(K.EQ. 4) L=L-1
         LLL=L+L+1
         M=I+ 83+3-L
         WK1(  3)=           -PHI(I   )        -PHI(J   )*CNF( 1)
         WK1(  4)=           -PHI(I+ 1)        -PHI(J   )*CNF( 2)
         WK1(  5)=           -PHI(I+ L)        -PHI(J   )*CNF( 3)
         WK1(  6)=-PHI(M    )-PHI(I   )*CNF( 1)-PHI(J-36)*CNF( 4)
         WK1(  7)=-PHI(M+  1)-PHI(I+ 1)*CNF( 1)
         WK1(  8)=-PHI(M+  2)-PHI(I+ 1)*CNF( 2)-PHI(J-36)*CNF( 4)
         WK1(  9)=-PHI(M+1+L)-PHI(I+ L)*CNF( 1)
         WK1( 10)=-PHI(M+2+L)-PHI(I+ L)*CNF( 2)
         WK1( 11)=-PHI(M+LLL)-PHI(I+ L)*CNF( 3)-PHI(J-36)*CNF( 4)
         CALL DSPP_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      WK1(  3)=          PHI( 97)        +PHI( 60)*CNF( 1)
      WK1(  4)=          PHI( 98)        +PHI( 60)*CNF( 2)
      WK1(  5)=          PHI( 99)        +PHI( 60)*CNF( 3)
      WK1(  6)= PHI(186)+PHI( 97)*CNF( 1)+PHI( 53)*CNF( 4)
      WK1(  7)= PHI(187)+PHI( 98)*CNF( 1)
      WK1(  8)= PHI(188)+PHI( 98)*CNF( 2)+PHI( 53)*CNF( 4)
      WK1(  9)= PHI(189)+PHI( 99)*CNF( 1)
      WK1( 10)= PHI(190)+PHI( 99)*CNF( 2)
      WK1( 11)= PHI(191)+PHI( 99)*CNF( 3)+PHI( 53)*CNF( 4)
      CALL DSPP_BCTE(WK1,WK2,LENW,CNF, 5)
      WK1(  3)=          PHI( 88)        +PHI( 57)*CNF( 1)
      WK1(  4)=          PHI( 89)        +PHI( 57)*CNF( 2)
      WK1(  5)=          PHI( 90)        +PHI( 57)*CNF( 3)
      WK1(  6)= PHI(165)+PHI( 88)*CNF( 1)+PHI( 50)*CNF( 4)
      WK1(  7)= PHI(166)+PHI( 89)*CNF( 1)
      WK1(  8)= PHI(167)+PHI( 89)*CNF( 2)+PHI( 50)*CNF( 4)
      WK1(  9)= PHI(168)+PHI( 90)*CNF( 1)
      WK1( 10)= PHI(169)+PHI( 90)*CNF( 2)
      WK1( 11)= PHI(170)+PHI( 90)*CNF( 3)+PHI( 50)*CNF( 4)
      CALL DSPP_BCTE(WK1,WK2,LENW,CNF, 6)
      I=221
      J=112
      L=3
      DO K=  7,  9
         IF(K.EQ. 9) I=I+1
         IF(K.EQ. 9) L=L-1
         LLL=L+L+1
         M=I+ 95+3-L
         WK1(  3)=           -PHI(I   )        -PHI(J   )*CNF( 1)
         WK1(  4)=           -PHI(I+ 1)        -PHI(J   )*CNF( 2)
         WK1(  5)=           -PHI(I+ L)        -PHI(J   )*CNF( 3)
         WK1(  6)=-PHI(M    )-PHI(I   )*CNF( 1)-PHI(J-36)*CNF( 4)
         WK1(  7)=-PHI(M+  1)-PHI(I+ 1)*CNF( 1)
         WK1(  8)=-PHI(M+  2)-PHI(I+ 1)*CNF( 2)-PHI(J-36)*CNF( 4)
         WK1(  9)=-PHI(M+1+L)-PHI(I+ L)*CNF( 1)
         WK1( 10)=-PHI(M+2+L)-PHI(I+ L)*CNF( 2)
         WK1( 11)=-PHI(M+LLL)-PHI(I+ L)*CNF( 3)-PHI(J-36)*CNF( 4)
         CALL DSPP_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      I=355
      J=242
      L=4
      DO K= 10, 15
         IF(K.EQ.13 .OR. K.EQ.15) I=I+1
         IF(K.EQ.13 .OR. K.EQ.15) L=L-1
         LLL=L+L+1
         M=I+ 83+4-L
         WK1(  3)=            PHI(I   )        +PHI(J    )*CNF( 1)
         WK1(  4)=            PHI(I+ 1)        +PHI(J    )*CNF( 2)
         WK1(  5)=            PHI(I+ L)        +PHI(J    )*CNF( 3)
         WK1(  6)= PHI(M    )+PHI(I   )*CNF( 1)+PHI(J-105)*CNF( 4)
         WK1(  7)= PHI(M+  1)+PHI(I+ 1)*CNF( 1)
         WK1(  8)= PHI(M+  2)+PHI(I+ 1)*CNF( 2)+PHI(J-105)*CNF( 4)
         WK1(  9)= PHI(M+1+L)+PHI(I+ L)*CNF( 1)
         WK1( 10)= PHI(M+2+L)+PHI(I+ L)*CNF( 2)
         WK1( 11)= PHI(M+LLL)+PHI(I+ L)*CNF( 3)+PHI(J-105)*CNF( 4)
         CALL DSPP_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      CNF(1)= XD-XC
      CNF(2)= YD-YC
      CNF(3)= ZD-ZC
      DO I=1,6
         WK2(  2,I)= WK2(  2,I)+WK2(  1,I)*CNF( 1)
         WK2(  3,I)= WK2(  3,I)+WK2(  1,I)*CNF( 2)
         WK2(  4,I)= WK2(  4,I)+WK2(  1,I)*CNF( 3)
C
         WK2( 10,I)= WK2( 10,I)+WK2(  7,I)*CNF( 1)+WK2(  6,I)*CNF( 4)
         WK2( 11,I)= WK2( 11,I)+WK2(  8,I)*CNF( 1)
         WK2( 12,I)= WK2( 12,I)+WK2(  8,I)*CNF( 2)+WK2(  6,I)*CNF( 4)
         WK2( 13,I)= WK2( 13,I)+WK2(  9,I)*CNF( 1)
         WK2( 14,I)= WK2( 14,I)+WK2(  9,I)*CNF( 2)
         WK2( 15,I)= WK2( 15,I)+WK2(  9,I)*CNF( 3)+WK2(  6,I)*CNF( 4)
C
         WK2(  7,I)= WK2(  7,I)+WK2(  5,I)*CNF( 1)
         WK2(  8,I)= WK2(  8,I)+WK2(  5,I)*CNF( 2)
         WK2(  9,I)= WK2(  9,I)+WK2(  5,I)*CNF( 3)
C
         WK2( 10,I)= WK2( 10,I)+WK2(  7,I)*CNF( 1)
         WK2( 11,I)= WK2( 11,I)+WK2(  7,I)*CNF( 2)
         WK2( 12,I)= WK2( 12,I)+WK2(  8,I)*CNF( 2)
         WK2( 13,I)= WK2( 13,I)+WK2(  7,I)*CNF( 3)
         WK2( 14,I)= WK2( 14,I)+WK2(  8,I)*CNF( 3)
         WK2( 15,I)= WK2( 15,I)+WK2(  9,I)*CNF( 3)
C
         WK2( 16,I)= WK2( 10,I)-WK2(  2,I)*CNF( 1)
         WK2( 17,I)= WK2( 11,I)-WK2(  3,I)*CNF( 1)
         WK2( 18,I)= WK2( 13,I)-WK2(  4,I)*CNF( 1)
         WK2( 19,I)= WK2( 11,I)-WK2(  2,I)*CNF( 2)
         WK2( 20,I)= WK2( 12,I)-WK2(  3,I)*CNF( 2)
         WK2( 21,I)= WK2( 14,I)-WK2(  4,I)*CNF( 2)
         WK2( 22,I)= WK2( 13,I)-WK2(  2,I)*CNF( 3)
         WK2( 23,I)= WK2( 14,I)-WK2(  3,I)*CNF( 3)
         WK2( 24,I)= WK2( 15,I)-WK2(  4,I)*CNF( 3)
      END DO
C
      RETURN
      END
C*MODULE INT2D   *DECK DSPP_BCTE
C>
C>    @brief   ERIC dspp backtransfer
C>
C>    @details ERIC [ds|pp] backtransfer step
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DSPP_BCTE(WK1,WK2,LENW,CNF,JR)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    LENW,I,J,JR
      DIMENSION  WK1(*),WK2(LENW,*),CNF(*)
C
      WK1( 6)= WK1( 6)+WK1( 3)*CNF( 1)
      WK1( 7)= WK1( 7)+WK1( 3)*CNF( 2)
      WK1( 8)= WK1( 8)+WK1( 4)*CNF( 2)
      WK1( 9)= WK1( 9)+WK1( 3)*CNF( 3)
      WK1(10)= WK1(10)+WK1( 4)*CNF( 3)
      WK1(11)= WK1(11)+WK1( 5)*CNF( 3)
      J=  5
      DO I=1,6
         J=J+1
         WK2(JR,I)= WK1(J)
      END DO
C
      RETURN
      END
C  LPHI= 389
C  LWK1=  11
C  LWK2=  66
C  LENW=  11
C*MODULE INT2D   *DECK DSDS
C>
C>    @brief   ERIC dsds case
C>
C>    @details ERIC [ds|ds] integral quartet
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DSDS (IPRIM,JPRIM,KPRIM,LPRIM,IEQJ,KEQL,
     *                 XA,YA,ZA,XB,YB,ZB,XC,YC,ZC,XD,YD,ZD,
     *                 PHI,WK1,WK2,LENW)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      LOGICAL    IEQJ,KEQL
      DIMENSION  PHI(*),WK1(*),WK2(LENW,*)
C
      PARAMETER (MXGSH=30, MXG2= MXGSH*MXGSH)
C
      PARAMETER (NTX=4, NPF=450, NGRD=7, NPX=1000, MXQT=16)
      COMMON /FMTTBL/ FGRID(0:NTX,0:NPF,0:NGRD),XGRID(0:NTX,0:NPX)
     *,               TMAX,RFINC(0:NGRD),RXINC
     *,               RMR(MXQT),TLGM(0:MXQT),NORD
      COMMON /ERIPRM/ EXI(MXGSH),EXJ(MXGSH),EXK(MXGSH),EXL(MXGSH),
     *                CCI(MXGSH),CCJ(MXGSH),CCK(MXGSH),CCL(MXGSH),
     *                XAB(MXG2),YAB(MXG2),ZAB(MXG2),
     *                XCD(MXG2),YCD(MXG2),ZCD(MXG2),
     *                CCBRA(MXG2),CCKET(MXG2),RXB(MXG2),
     *                SLBRA(MXG2),SLKET(MXG2),RXK(MXG2)
      LOGICAL         LCFLAG,LRINT
      COMMON /NLRC  / LCFLAG,EMU,EMU2,LRFILE
      COMMON /NLRCF / LRINT
      COMMON /SHLNOS/ QQ4,IDUMMY(20)
C
      DIMENSION  FT(0:16),SFAC( 9),CNF(11)
C
      PARAMETER (NL=  8, NK=  8, NJ=  7, NI=  4)
      DIMENSION  LSF(NL),KSF(NK),JSF(NJ),ISF(NI)
      DIMENSION  LJI(NL),KJI(NK),JJI(NJ),IJI(NI)
      DIMENSION  L0I(NL),K0I(NK),J0I(NJ),I0I(NI)
      DIMENSION  L0F(NL),K0F(NK),J0F(NJ),I0F(NI)
C
      PARAMETER (ZER=0.0D+00, ONE=1.0D+00, TWO=2.0D+00)
      PARAMETER (CCTOL=1.0D-13)
      DATA CNF/0.0D+00,0.0D+00,0.0D+00,1.0D+00,2.0D+00,3.0D+00,
     &         4.0D+00,5.0D+00,6.0D+00,7.0D+00,8.0D+00/
      SAVE CNF
C
      DATA LSF/  1,  1,  3,  2,  1,  2,  1,  1/
      DATA LJI/112,140,154,175,196,236,275,345/
      DATA L0I/119,147,161,182,203,249,288,367/
      DATA L0F/125,153,167,188,209,261,300,388/
C
      DATA KSF/  3,  2,  3,  3,  3,  3,  3,  3/
      DATA KJI/105,133,133,168,189,223,262,323/
      DATA K0I/112,140,154,175,196,236,275,345/
      DATA K0F/118,146,160,181,202,248,287,366/
C
      DATA JSF/  1,  1,  2,  3,  1,  2,  1/
      DATA JJI/ 98,126,126,126,210,210,301/
      DATA J0I/105,133,168,189,223,262,323/
      DATA J0F/111,139,174,195,235,274,344/
C
      DATA ISF/  2,  3,  3,  3/
      DATA IJI/  5,  5, 12, 25/
      DATA I0I/ 98,126,210,301/
      DATA I0F/104,132,222,322/
C
      SFAC(1)= ONE
      PHI( 50)= ZER
      PHI( 52)= ZER
      PHI( 56)= ZER
      PHI( 58)= ZER
      PHI( 68)= ZER
      PHI( 69)= ZER
      PHI( 70)= ZER
      PHI( 80)= ZER
      PHI( 81)= ZER
      PHI( 82)= ZER
      PHI( 86)= ZER
      PHI( 87)= ZER
      PHI( 88)= ZER
      PHI( 95)= ZER
      PHI( 96)= ZER
      PHI( 97)= ZER
      DO N= 1,NL
         DO I=L0I(N),L0F(N)
            PHI(I)= ZER
         END DO
      END DO
      KL=0
      DO LL=1,LPRIM
         X04= EXL(LL)
         PHI( 49)= ZER
         PHI( 51)= ZER
         PHI( 55)= ZER
         PHI( 57)= ZER
         PHI( 65)= ZER
         PHI( 66)= ZER
         PHI( 67)= ZER
         PHI( 77)= ZER
         PHI( 78)= ZER
         PHI( 79)= ZER
         PHI( 83)= ZER
         PHI( 84)= ZER
         PHI( 85)= ZER
         PHI( 92)= ZER
         PHI( 93)= ZER
         PHI( 94)= ZER
         DO N= 1,NK
            DO I=K0I(N),K0F(N)
               PHI(I)= ZER
            END DO
         END DO
         KTOP= KPRIM
         IF(KEQL) KTOP= LL
         DO KK=1,KTOP
            KL= KL+1
            CFK= CCKET(KL)
            IF(ABS(CFK).GT.CCTOL) THEN
               CFK= CFK*QQ4
               X03= EXK(KK)
               X34= X03+X04
               XKL= XCD(KL)
               YKL= YCD(KL)
               ZKL= ZCD(KL)
               PHI( 48)= ZER
               PHI( 54)= ZER
               PHI( 62)= ZER
               PHI( 63)= ZER
               PHI( 64)= ZER
               PHI( 74)= ZER
               PHI( 75)= ZER
               PHI( 76)= ZER
               PHI( 89)= ZER
               PHI( 90)= ZER
               PHI( 91)= ZER
               DO N= 1,NJ
                  DO I=J0I(N),J0F(N)
                     PHI(I)= ZER
                  END DO
               END DO
               IJ=0
               DO JJ=1,JPRIM
                  X02= EXJ(JJ)
                  PHI( 47)= ZER
                  PHI( 53)= ZER
                  PHI( 59)= ZER
                  PHI( 60)= ZER
                  PHI( 61)= ZER
                  PHI( 71)= ZER
                  PHI( 72)= ZER
                  PHI( 73)= ZER
                  DO N= 1,NI
                     DO I=I0I(N),I0F(N)
                        PHI(I)= ZER
                     END DO
                  END DO
                  ITOP= IPRIM
                  IF(IEQJ) ITOP= JJ
                  DO II=1,ITOP
                     IJ= IJ+1
                     CFB= CCBRA(IJ)
                     IF(ABS(CFB).GT.CCTOL) THEN
                        X01= EXI(II)
                        X12= X01+X02
                        X41= ONE/(X12+X34)
                        FTZ= CFB*CFK
                        RX = XKL-XAB(IJ)
                        RY = YKL-YAB(IJ)
                        RZ = ZKL-ZAB(IJ)
                        RSQ= RX*RX+RY*RY+RZ*RZ
                        RHO= X12*X34*X41
                        IF(LRINT) THEN
                           EFR= EMU2/(EMU2+RHO)
                           RHO= RHO*EFR
                        ENDIF
                        TT = RSQ*RHO
                        N=4
                        IF(TT.LE.TMAX) THEN
C
C     FM(T) EVALUATION
C
                           TV= TT*RFINC(N)
                           IP= NINT(TV)
                           FX=    FGRID(4,IP,N) *TV
                           FX=(FX+FGRID(3,IP,N))*TV
                           FX=(FX+FGRID(2,IP,N))*TV
                           FX=(FX+FGRID(1,IP,N))*TV
                           FX= FX+FGRID(0,IP,N)
                           TV= TT*RXINC
                           IP= NINT(TV)
                           ET=    XGRID(4,IP) *TV
                           ET=(ET+XGRID(3,IP))*TV
                           ET=(ET+XGRID(2,IP))*TV
                           ET=(ET+XGRID(1,IP))*TV
                           ET= ET+XGRID(0,IP)
C
                           FT(N)= FX
                           T2= TT+TT
                           DO M=N,1,-1
                              FT(M-1)=(T2*FT(M)+ET)*RMR(M)
                           END DO
C
                           RHO= RHO+RHO
                           IF(LRINT) FTZ= FTZ*SQRT(EFR)
                           FTF= FTZ*SQRT(X41)
                           DO 210 M=0,N
                              FT(M)= FT(M)*FTF
  210                      FTF= FTF*RHO
                        ELSE
                           XIN= ONE/RSQ
                           FTF= FTZ*SQRT(XIN)*SLBRA(IJ)*SLKET(KL)
                           FT(0)= FTF
                           DO 220 M=1,N
                              FTF= FTF*XIN
  220                      FT(M)= TLGM(M)*FTF
                        END IF
C
                        CALL PHIFTS(5,RX,RY,RZ,PHI,FT)
C
                        FAC= RXB(IJ)
                        SFAC(2)= FAC
                        SFAC(3)= SFAC(2)*FAC
                        PHI( 47)= PHI( 47)+PHI(  1)*SFAC(2)
                        PHI( 53)= PHI( 53)+PHI(  1)*SFAC(3)
C
                        PHI( 59)= PHI( 59)+PHI(  2)*SFAC(2)
                        PHI( 60)= PHI( 60)+PHI(  3)*SFAC(2)
                        PHI( 61)= PHI( 61)+PHI(  4)*SFAC(2)
                        PHI( 71)= PHI( 71)+PHI(  2)*SFAC(3)
                        PHI( 72)= PHI( 72)+PHI(  3)*SFAC(3)
                        PHI( 73)= PHI( 73)+PHI(  4)*SFAC(3)
                        DO N= 1,NI
                           FAC= SFAC(ISF(N))
                           J=IJI(N)
                           DO I=I0I(N),I0F(N)
                              PHI(I)= PHI(I)+PHI(J)*FAC
                              J=J+1
                           END DO
                        END DO
                     END IF
                  END DO
                  FAC= EXJ(JJ)*TWO
                  SFAC(2)= FAC
                  SFAC(3)= SFAC(2)*FAC
                  PHI( 48)= PHI( 48)+PHI( 47)
                  PHI( 54)= PHI( 54)+PHI( 53)*SFAC(3)
C
                  PHI( 62)= PHI( 62)+PHI( 59)
                  PHI( 63)= PHI( 63)+PHI( 60)
                  PHI( 64)= PHI( 64)+PHI( 61)
                  PHI( 74)= PHI( 74)+PHI( 71)*SFAC(2)
                  PHI( 75)= PHI( 75)+PHI( 72)*SFAC(2)
                  PHI( 76)= PHI( 76)+PHI( 73)*SFAC(2)
                  PHI( 89)= PHI( 89)+PHI( 71)*SFAC(3)
                  PHI( 90)= PHI( 90)+PHI( 72)*SFAC(3)
                  PHI( 91)= PHI( 91)+PHI( 73)*SFAC(3)
                  DO N= 1,NJ
                     FAC= SFAC(JSF(N))
                     J=JJI(N)
                     IF(FAC.EQ.ONE) THEN
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)
                           J=J+1
                        END DO
                     ELSE
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)*FAC
                           J=J+1
                        END DO
                     END IF
                  END DO
               END DO
               FAC= RXK(KL)
               SFAC(2)= FAC
               SFAC(3)= SFAC(2)*FAC
               PHI( 49)= PHI( 49)+PHI( 48)*SFAC(2)
               PHI( 51)= PHI( 51)+PHI( 48)*SFAC(3)
               PHI( 55)= PHI( 55)+PHI( 54)*SFAC(2)
               PHI( 57)= PHI( 57)+PHI( 54)*SFAC(3)
C
               PHI( 65)= PHI( 65)+PHI( 62)*SFAC(3)
               PHI( 66)= PHI( 66)+PHI( 63)*SFAC(3)
               PHI( 67)= PHI( 67)+PHI( 64)*SFAC(3)
               PHI( 77)= PHI( 77)+PHI( 74)*SFAC(2)
               PHI( 78)= PHI( 78)+PHI( 75)*SFAC(2)
               PHI( 79)= PHI( 79)+PHI( 76)*SFAC(2)
               PHI( 83)= PHI( 83)+PHI( 74)*SFAC(3)
               PHI( 84)= PHI( 84)+PHI( 75)*SFAC(3)
               PHI( 85)= PHI( 85)+PHI( 76)*SFAC(3)
               PHI( 92)= PHI( 92)+PHI( 89)*SFAC(3)
               PHI( 93)= PHI( 93)+PHI( 90)*SFAC(3)
               PHI( 94)= PHI( 94)+PHI( 91)*SFAC(3)
               DO N= 1,NK
                  FAC= SFAC(KSF(N))
                  J=KJI(N)
                  DO I=K0I(N),K0F(N)
                     PHI(I)= PHI(I)+PHI(J)*FAC
                     J=J+1
                  END DO
               END DO
            END IF
         END DO
         FAC= EXL(LL)*TWO
         SFAC(2)= FAC
         SFAC(3)= SFAC(2)*FAC
         PHI( 50)= PHI( 50)+PHI( 49)
         PHI( 52)= PHI( 52)+PHI( 51)*SFAC(3)
         PHI( 56)= PHI( 56)+PHI( 55)
         PHI( 58)= PHI( 58)+PHI( 57)*SFAC(3)
C
         PHI( 68)= PHI( 68)+PHI( 65)*SFAC(2)
         PHI( 69)= PHI( 69)+PHI( 66)*SFAC(2)
         PHI( 70)= PHI( 70)+PHI( 67)*SFAC(2)
         PHI( 80)= PHI( 80)+PHI( 77)
         PHI( 81)= PHI( 81)+PHI( 78)
         PHI( 82)= PHI( 82)+PHI( 79)
         PHI( 86)= PHI( 86)+PHI( 83)*SFAC(3)
         PHI( 87)= PHI( 87)+PHI( 84)*SFAC(3)
         PHI( 88)= PHI( 88)+PHI( 85)*SFAC(3)
         PHI( 95)= PHI( 95)+PHI( 92)*SFAC(2)
         PHI( 96)= PHI( 96)+PHI( 93)*SFAC(2)
         PHI( 97)= PHI( 97)+PHI( 94)*SFAC(2)
         DO N= 1,NL
            FAC= SFAC(LSF(N))
            J=LJI(N)
            IF(FAC.EQ.ONE) THEN
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)
                  J=J+1
               END DO
            ELSE
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)*FAC
                  J=J+1
               END DO
            END IF
         END DO
      END DO
C  POST-CONTRACTION PHASE
      PHI(120)= PHI(120)-PHI(119)
      PHI(122)= PHI(122)-PHI(119)
      PHI(125)= PHI(125)-PHI(119)
      PHI(148)= PHI(148)-PHI(147)
      PHI(150)= PHI(150)-PHI(147)
      PHI(153)= PHI(153)-PHI(147)
      PHI(162)= PHI(162)-PHI(161)
      PHI(164)= PHI(164)-PHI(161)
      PHI(167)= PHI(167)-PHI(161)
      PHI(183)= PHI(183)-PHI(182)
      PHI(185)= PHI(185)-PHI(182)
      PHI(188)= PHI(188)-PHI(182)
      PHI(204)= PHI(204)-PHI(203)
      PHI(206)= PHI(206)-PHI(203)
      PHI(209)= PHI(209)-PHI(203)
      III=209+ 30
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*3
      CALL PHIIJ3(III,PHI)
C
      III=III+ 61
      III=III+ 22
      CALL PHIIJ4(III,PHI)
C
      CNF(1)= XB-XA
      CNF(2)= YB-YA
      CNF(3)= ZB-ZA
      WK1(  3)=          PHI( 86)        +PHI( 58)*CNF( 1)
      WK1(  4)=          PHI( 87)        +PHI( 58)*CNF( 2)
      WK1(  5)=          PHI( 88)        +PHI( 58)*CNF( 3)
      WK1(  6)= PHI(162)+PHI( 86)*CNF( 1)+PHI( 52)*CNF( 4)
      WK1(  7)= PHI(163)+PHI( 87)*CNF( 1)
      WK1(  8)= PHI(164)+PHI( 87)*CNF( 2)+PHI( 52)*CNF( 4)
      WK1(  9)= PHI(165)+PHI( 88)*CNF( 1)
      WK1( 10)= PHI(166)+PHI( 88)*CNF( 2)
      WK1( 11)= PHI(167)+PHI( 88)*CNF( 3)+PHI( 52)*CNF( 4)
      CALL DSDS_BCTE(WK1,WK2,LENW,CNF, 1)
      WK1(  3)=          PHI( 80)        +PHI( 56)*CNF( 1)
      WK1(  4)=          PHI( 81)        +PHI( 56)*CNF( 2)
      WK1(  5)=          PHI( 82)        +PHI( 56)*CNF( 3)
      WK1(  6)= PHI(148)+PHI( 80)*CNF( 1)+PHI( 50)*CNF( 4)
      WK1(  7)= PHI(149)+PHI( 81)*CNF( 1)
      WK1(  8)= PHI(150)+PHI( 81)*CNF( 2)+PHI( 50)*CNF( 4)
      WK1(  9)= PHI(151)+PHI( 82)*CNF( 1)
      WK1( 10)= PHI(152)+PHI( 82)*CNF( 2)
      WK1( 11)= PHI(153)+PHI( 82)*CNF( 3)+PHI( 50)*CNF( 4)
      CALL DSDS_BCTE(WK1,WK2,LENW,CNF, 2)
      I=183
      J= 95
      L=3
      DO K=  3,  5
         IF(K.EQ. 5) I=I+1
         IF(K.EQ. 5) L=L-1
         LLL=L+L+1
         M=I+ 69+3-L
         WK1(  3)=           -PHI(I   )        -PHI(J    )*CNF( 1)
         WK1(  4)=           -PHI(I+ 1)        -PHI(J    )*CNF( 2)
         WK1(  5)=           -PHI(I+ L)        -PHI(J    )*CNF( 3)
         WK1(  6)=-PHI(M    )-PHI(I   )*CNF( 1)-PHI(J- 27)*CNF( 4)
         WK1(  7)=-PHI(M+  1)-PHI(I+ 1)*CNF( 1)
         WK1(  8)=-PHI(M+  2)-PHI(I+ 1)*CNF( 2)-PHI(J- 27)*CNF( 4)
         WK1(  9)=-PHI(M+1+L)-PHI(I+ L)*CNF( 1)
         WK1( 10)=-PHI(M+2+L)-PHI(I+ L)*CNF( 2)
         WK1( 11)=-PHI(M+LLL)-PHI(I+ L)*CNF( 3)-PHI(J- 27)*CNF( 4)
         CALL DSDS_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      I=291
      J=204
      L=4
      DO K=  6, 11
         IF(K.EQ. 9 .OR. K.EQ.11) I=I+1
         IF(K.EQ. 9 .OR. K.EQ.11) L=L-1
         LLL=L+L+1
         M=I+ 83+4-L
         WK1(  3)=            PHI(I   )        +PHI(J   )*CNF( 1)
         WK1(  4)=            PHI(I+ 1)        +PHI(J   )*CNF( 2)
         WK1(  5)=            PHI(I+ L)        +PHI(J   )*CNF( 3)
         WK1(  6)= PHI(M    )+PHI(I   )*CNF( 1)+PHI(J-84)*CNF( 4)
         WK1(  7)= PHI(M+  1)+PHI(I+ 1)*CNF( 1)
         WK1(  8)= PHI(M+  2)+PHI(I+ 1)*CNF( 2)+PHI(J-84)*CNF( 4)
         WK1(  9)= PHI(M+1+L)+PHI(I+ L)*CNF( 1)
         WK1( 10)= PHI(M+2+L)+PHI(I+ L)*CNF( 2)
         WK1( 11)= PHI(M+LLL)+PHI(I+ L)*CNF( 3)+PHI(J-84)*CNF( 4)
         CALL DSDS_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      CNF(1)= XD-XC
      CNF(2)= YD-YC
      CNF(3)= ZD-ZC
      DO I=1,6
         WK2(  6,I)= WK2(  6,I)+WK2(  3,I)*CNF( 1)+WK2(  2,I)*CNF( 4)
         WK2(  7,I)= WK2(  7,I)+WK2(  4,I)*CNF( 1)
         WK2(  8,I)= WK2(  8,I)+WK2(  4,I)*CNF( 2)+WK2(  2,I)*CNF( 4)
         WK2(  9,I)= WK2(  9,I)+WK2(  5,I)*CNF( 1)
         WK2( 10,I)= WK2( 10,I)+WK2(  5,I)*CNF( 2)
         WK2( 11,I)= WK2( 11,I)+WK2(  5,I)*CNF( 3)+WK2(  2,I)*CNF( 4)
C
         WK2(  3,I)= WK2(  3,I)+WK2(  1,I)*CNF( 1)
         WK2(  4,I)= WK2(  4,I)+WK2(  1,I)*CNF( 2)
         WK2(  5,I)= WK2(  5,I)+WK2(  1,I)*CNF( 3)
         WK2(  6,I)= WK2(  6,I)+WK2(  3,I)*CNF( 1)
         WK2(  7,I)= WK2(  7,I)+WK2(  3,I)*CNF( 2)
         WK2(  8,I)= WK2(  8,I)+WK2(  4,I)*CNF( 2)
         WK2(  9,I)= WK2(  9,I)+WK2(  3,I)*CNF( 3)
         WK2( 10,I)= WK2( 10,I)+WK2(  4,I)*CNF( 3)
         WK2( 11,I)= WK2( 11,I)+WK2(  5,I)*CNF( 3)
      END DO
C
      RETURN
      END
C*MODULE INT2D   *DECK DSDS_BCTE
C>
C>    @brief   ERIC dsds backtransfer
C>
C>    @details ERIC [ds|ds] backtransfer step
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DSDS_BCTE(WK1,WK2,LENW,CNF,JR)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    LENW,I,J,JR
      DIMENSION  WK1(*),WK2(LENW,*),CNF(*)
C
      WK1( 6)= WK1( 6)+WK1( 3)*CNF( 1)
      WK1( 7)= WK1( 7)+WK1( 3)*CNF( 2)
      WK1( 8)= WK1( 8)+WK1( 4)*CNF( 2)
      WK1( 9)= WK1( 9)+WK1( 3)*CNF( 3)
      WK1(10)= WK1(10)+WK1( 4)*CNF( 3)
      WK1(11)= WK1(11)+WK1( 5)*CNF( 3)
      J=  5
      DO I=1,6
         J=J+1
         WK2(JR,I)= WK1(J)
      END DO
C
      RETURN
      END
C  LPHI= 149
C  LWK1=   1
C  LWK2=  53
C  LENW=  53
C*MODULE INT2D   *DECK DPSS
C>
C>    @brief   ERIC dpss case
C>
C>    @details ERIC [dp|ss] integral quartet
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DPSS (IPRIM,JPRIM,KPRIM,LPRIM,IEQJ,KEQL,
     *                 XC,YC,ZC,XD,YD,ZD,PHI,WK2,LENW)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      LOGICAL    IEQJ,KEQL
      DIMENSION  PHI(*),WK2(LENW,*)
C
      PARAMETER (MXGSH=30, MXG2= MXGSH*MXGSH)
C
      PARAMETER (NTX=4, NPF=450, NGRD=7, NPX=1000, MXQT=16)
      COMMON /FMTTBL/ FGRID(0:NTX,0:NPF,0:NGRD),XGRID(0:NTX,0:NPX)
     *,               TMAX,RFINC(0:NGRD),RXINC
     *,               RMR(MXQT),TLGM(0:MXQT),NORD
      COMMON /ERIPRM/ EXI(MXGSH),EXJ(MXGSH),EXK(MXGSH),EXL(MXGSH),
     *                CCI(MXGSH),CCJ(MXGSH),CCK(MXGSH),CCL(MXGSH),
     *                XAB(MXG2),YAB(MXG2),ZAB(MXG2),
     *                XCD(MXG2),YCD(MXG2),ZCD(MXG2),
     *                CCBRA(MXG2),CCKET(MXG2),RXB(MXG2),
     *                SLBRA(MXG2),SLKET(MXG2),RXK(MXG2)
      LOGICAL         LCFLAG,LRINT
      COMMON /NLRC  / LCFLAG,EMU,EMU2,LRFILE
      COMMON /NLRCF / LRINT
      COMMON /SHLNOS/ QQ4,IDUMMY(20)
C
      DIMENSION  FT(0:16),SFAC( 9),CNF(11)
C
      PARAMETER (NL=  3, NK=  3, NJ=  2, NI=  2)
      DIMENSION  LSF(NL),KSF(NK),JSF(NJ),ISF(NI)
      DIMENSION  LJI(NL),KJI(NK),JJI(NJ),IJI(NI)
      DIMENSION  L0I(NL),K0I(NK),J0I(NJ),I0I(NI)
      DIMENSION  L0F(NL),K0F(NK),J0F(NJ),I0F(NI)
C
      PARAMETER (ZER=0.0D+00, ONE=1.0D+00, TWO=2.0D+00)
      PARAMETER (CCTOL=1.0D-13)
      DATA CNF/0.0D+00,0.0D+00,0.0D+00,1.0D+00,2.0D+00,3.0D+00,
     &         4.0D+00,5.0D+00,6.0D+00,7.0D+00,8.0D+00/
      SAVE CNF
C
      DATA LSF/  1,  2,  1/
      DATA LJI/ 69, 83,123/
      DATA L0I/ 76, 90,136/
      DATA L0F/ 82, 96,148/
C
      DATA KSF/  3,  4,  4/
      DATA KJI/ 62, 62,110/
      DATA K0I/ 69, 83,123/
      DATA K0F/ 75, 89,135/
C
      DATA JSF/  1,  1/
      DATA JJI/ 55, 97/
      DATA J0I/ 62,110/
      DATA J0F/ 68,122/
C
      DATA ISF/  1,  1/
      DATA IJI/  5, 12/
      DATA I0I/ 55, 97/
      DATA I0F/ 61,109/
C
      SFAC(1)= ONE
      PHI( 28)= ZER
      PHI( 30)= ZER
      PHI( 31)= ZER
      PHI( 33)= ZER
      PHI( 43)= ZER
      PHI( 44)= ZER
      PHI( 45)= ZER
      PHI( 46)= ZER
      PHI( 47)= ZER
      PHI( 48)= ZER
      PHI( 52)= ZER
      PHI( 53)= ZER
      PHI( 54)= ZER
      DO N= 1,NL
         DO I=L0I(N),L0F(N)
            PHI(I)= ZER
         END DO
      END DO
      KL=0
      DO LL=1,LPRIM
         X04= EXL(LL)
         PHI( 27)= ZER
         PHI( 29)= ZER
         PHI( 32)= ZER
         PHI( 40)= ZER
         PHI( 41)= ZER
         PHI( 42)= ZER
         PHI( 49)= ZER
         PHI( 50)= ZER
         PHI( 51)= ZER
         DO N= 1,NK
            DO I=K0I(N),K0F(N)
               PHI(I)= ZER
            END DO
         END DO
         KTOP= KPRIM
         IF(KEQL) KTOP= LL
         DO KK=1,KTOP
            KL= KL+1
            CFK= CCKET(KL)
            IF(ABS(CFK).GT.CCTOL) THEN
               CFK= CFK*QQ4
               X03= EXK(KK)
               X34= X03+X04
               XKL= XCD(KL)
               YKL= YCD(KL)
               ZKL= ZCD(KL)
               PHI( 26)= ZER
               PHI( 37)= ZER
               PHI( 38)= ZER
               PHI( 39)= ZER
               DO N= 1,NJ
                  DO I=J0I(N),J0F(N)
                     PHI(I)= ZER
                  END DO
               END DO
               IJ=0
               DO JJ=1,JPRIM
                  X02= EXJ(JJ)
                  PHI( 25)= ZER
                  PHI( 34)= ZER
                  PHI( 35)= ZER
                  PHI( 36)= ZER
                  DO N= 1,NI
                     DO I=I0I(N),I0F(N)
                        PHI(I)= ZER
                     END DO
                  END DO
                  ITOP= IPRIM
                  IF(IEQJ) ITOP= JJ
                  DO II=1,ITOP
                     IJ= IJ+1
                     CFB= CCBRA(IJ)
                     IF(ABS(CFB).GT.CCTOL) THEN
                        X01= EXI(II)
                        X12= X01+X02
                        X41= ONE/(X12+X34)
                        FTZ= CFB*CFK
                        RX = XKL-XAB(IJ)
                        RY = YKL-YAB(IJ)
                        RZ = ZKL-ZAB(IJ)
                        RSQ= RX*RX+RY*RY+RZ*RZ
                        RHO= X12*X34*X41
                        IF(LRINT) THEN
                           EFR= EMU2/(EMU2+RHO)
                           RHO= RHO*EFR
                        ENDIF
                        TT = RSQ*RHO
                        N=3
                        IF(TT.LE.TMAX) THEN
C
C     FM(T) EVALUATION
C
                           TV= TT*RFINC(N)
                           IP= NINT(TV)
                           FX=    FGRID(4,IP,N) *TV
                           FX=(FX+FGRID(3,IP,N))*TV
                           FX=(FX+FGRID(2,IP,N))*TV
                           FX=(FX+FGRID(1,IP,N))*TV
                           FX= FX+FGRID(0,IP,N)
                           TV= TT*RXINC
                           IP= NINT(TV)
                           ET=    XGRID(4,IP) *TV
                           ET=(ET+XGRID(3,IP))*TV
                           ET=(ET+XGRID(2,IP))*TV
                           ET=(ET+XGRID(1,IP))*TV
                           ET= ET+XGRID(0,IP)
C
                           FT(N)= FX
                           T2= TT+TT
                              FT(3-1)=(T2*FT(3)+ET)*RMR(3)
                              FT(2-1)=(T2*FT(2)+ET)*RMR(2)
                              FT(1-1)=(T2*FT(1)+ET)*RMR(1)
CC                         DO M=N,1,-1
CC                            FT(M-1)=(T2*FT(M)+ET)*RMR(M)
CC                         END DO
C
                           RHO= RHO+RHO
                           IF(LRINT) FTZ= FTZ*SQRT(EFR)
                           FTF= FTZ*SQRT(X41)
                              FT(0)= FT(0)*FTF
                           FTF= FTF*RHO
                              FT(1)= FT(1)*FTF
                           FTF= FTF*RHO
                              FT(2)= FT(2)*FTF
                           FTF= FTF*RHO
                              FT(3)= FT(3)*FTF
CC                         DO 210 M=0,N
CC                            FT(M)= FT(M)*FTF
CC210                      FTF= FTF*RHO
                        ELSE
                           XIN= ONE/RSQ
                           FTF= FTZ*SQRT(XIN)*SLBRA(IJ)*SLKET(KL)
                           FT(0)= FTF
                              FTF= FTF*XIN
                           FT(1)= TLGM(1)*FTF
                              FTF= FTF*XIN
                           FT(2)= TLGM(2)*FTF
                              FTF= FTF*XIN
                           FT(3)= TLGM(3)*FTF
CC                         DO 220 M=1,N
CC                            FTF= FTF*XIN
CC220                      FT(M)= TLGM(M)*FTF
                        END IF
C
                        CALL PHIFTS(4,RX,RY,RZ,PHI,FT)
C
C                       FAC= RXB(IJ)
                        PHI( 25)= PHI( 25)+PHI(  1)
C
                        PHI( 34)= PHI( 34)+PHI(  2)
                        PHI( 35)= PHI( 35)+PHI(  3)
                        PHI( 36)= PHI( 36)+PHI(  4)
                        DO N= 1,NI
                           FAC= SFAC(ISF(N))
                           J=IJI(N)
                           IF(FAC.EQ.ONE) THEN
                              DO I=I0I(N),I0F(N)
                                 PHI(I)= PHI(I)+PHI(J)
                                 J=J+1
                              END DO
                           ELSE
                              DO I=I0I(N),I0F(N)
                                 PHI(I)= PHI(I)+PHI(J)*FAC
                                 J=J+1
                              END DO
                           END IF
                        END DO
                     END IF
                  END DO
C                 FAC= EXJ(JJ)*TWO
                  PHI( 26)= PHI( 26)+PHI( 25)
C
                  PHI( 37)= PHI( 37)+PHI( 34)
                  PHI( 38)= PHI( 38)+PHI( 35)
                  PHI( 39)= PHI( 39)+PHI( 36)
                  DO N= 1,NJ
                     FAC= SFAC(JSF(N))
                     J=JJI(N)
                     IF(FAC.EQ.ONE) THEN
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)
                           J=J+1
                        END DO
                     ELSE
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)*FAC
                           J=J+1
                        END DO
                     END IF
                  END DO
               END DO
               FAC= RXK(KL)
               SFAC(2)= FAC
               SFAC(3)= SFAC(2)*FAC
               SFAC(4)= SFAC(3)*FAC
               PHI( 27)= PHI( 27)+PHI( 26)*SFAC(2)
               PHI( 29)= PHI( 29)+PHI( 26)*SFAC(3)
               PHI( 32)= PHI( 32)+PHI( 26)*SFAC(4)
C
               PHI( 40)= PHI( 40)+PHI( 37)*SFAC(3)
               PHI( 41)= PHI( 41)+PHI( 38)*SFAC(3)
               PHI( 42)= PHI( 42)+PHI( 39)*SFAC(3)
               PHI( 49)= PHI( 49)+PHI( 37)*SFAC(4)
               PHI( 50)= PHI( 50)+PHI( 38)*SFAC(4)
               PHI( 51)= PHI( 51)+PHI( 39)*SFAC(4)
               DO N= 1,NK
                  FAC= SFAC(KSF(N))
                  J=KJI(N)
                  DO I=K0I(N),K0F(N)
                     PHI(I)= PHI(I)+PHI(J)*FAC
                     J=J+1
                  END DO
               END DO
            END IF
         END DO
         FAC= EXL(LL)*TWO
         SFAC(2)= FAC
         SFAC(3)= SFAC(2)*FAC
         SFAC(4)= SFAC(3)*FAC
         PHI( 28)= PHI( 28)+PHI( 27)
         PHI( 30)= PHI( 30)+PHI( 29)*SFAC(2)
         PHI( 31)= PHI( 31)+PHI( 29)*SFAC(3)
         PHI( 33)= PHI( 33)+PHI( 32)*SFAC(4)
C
         PHI( 43)= PHI( 43)+PHI( 40)
         PHI( 44)= PHI( 44)+PHI( 41)
         PHI( 45)= PHI( 45)+PHI( 42)
         PHI( 46)= PHI( 46)+PHI( 40)*SFAC(2)
         PHI( 47)= PHI( 47)+PHI( 41)*SFAC(2)
         PHI( 48)= PHI( 48)+PHI( 42)*SFAC(2)
         PHI( 52)= PHI( 52)+PHI( 49)*SFAC(3)
         PHI( 53)= PHI( 53)+PHI( 50)*SFAC(3)
         PHI( 54)= PHI( 54)+PHI( 51)*SFAC(3)
         DO N= 1,NL
            FAC= SFAC(LSF(N))
            J=LJI(N)
            IF(FAC.EQ.ONE) THEN
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)
                  J=J+1
               END DO
            ELSE
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)*FAC
                  J=J+1
               END DO
            END IF
         END DO
      END DO
C  POST-CONTRACTION PHASE
      PHI( 77)= PHI( 77)-PHI( 76)
      PHI( 79)= PHI( 79)-PHI( 76)
      PHI( 82)= PHI( 82)-PHI( 76)
      PHI( 91)= PHI( 91)-PHI( 90)
      PHI( 93)= PHI( 93)-PHI( 90)
      PHI( 96)= PHI( 96)-PHI( 90)
      III= 96+ 30
      III=III+ 13
      CALL PHIIJ3(III,PHI)
C
      WK2(  1,1)= PHI( 31)
      WK2(  2,1)= PHI( 28)
      WK2(  3,1)=-PHI( 46)
      WK2(  4,1)=-PHI( 47)
      WK2(  5,1)=-PHI( 48)
      WK2(  6,1)= PHI( 77)
      WK2(  7,1)= PHI( 78)
      WK2(  8,1)= PHI( 79)
      WK2(  9,1)= PHI( 80)
      WK2( 10,1)= PHI( 81)
      WK2( 11,1)= PHI( 82)
      WK2( 12,1)= PHI( 33)
      WK2( 13,1)= PHI( 30)
      WK2( 14,1)=-PHI( 52)
      WK2( 15,1)=-PHI( 53)
      WK2( 16,1)=-PHI( 54)
      WK2( 17,1)=-PHI( 43)
      WK2( 18,1)=-PHI( 44)
      WK2( 19,1)=-PHI( 45)
      WK2( 20,1)= PHI( 91)
      WK2( 21,1)= PHI( 92)
      WK2( 22,1)= PHI( 93)
      WK2( 23,1)= PHI( 94)
      WK2( 24,1)= PHI( 95)
      WK2( 25,1)= PHI( 96)
      WK2( 26,1)=-PHI(139)
      WK2( 27,1)=-PHI(140)
      WK2( 28,1)=-PHI(141)
      WK2( 29,1)=-PHI(142)
      WK2( 30,1)=-PHI(143)
      WK2( 31,1)=-PHI(144)
      WK2( 32,1)=-PHI(145)
      WK2( 33,1)=-PHI(146)
      WK2( 34,1)=-PHI(147)
      WK2( 35,1)=-PHI(148)
      CNF(1)= XD-XC
      CNF(2)= YD-YC
      CNF(3)= ZD-ZC
      DO I=1,1
         CALL DPWRKT(I,WK2,LENW,CNF)
         CALL DPWRKM(I,WK2,LENW,CNF)
         CALL DPWRKB(I,WK2,LENW,CNF)
      END DO
C
      RETURN
      END
C  LPHI= 390
C  LWK1=   4
C  LWK2= 159
C  LENW=  53
C*MODULE INT2D   *DECK DPPS
C>
C>    @brief   ERIC dpps case
C>
C>    @details ERIC [dp|ps] integral quartet
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DPPS (IPRIM,JPRIM,KPRIM,LPRIM,IEQJ,KEQL,
     *                 XA,YA,ZA,XB,YB,ZB,XC,YC,ZC,XD,YD,ZD,
     *                 PHI,WK1,WK2,LENW)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      LOGICAL    IEQJ,KEQL
      DIMENSION  PHI(*),WK1(*),WK2(LENW,*)
C
      PARAMETER (MXGSH=30, MXG2= MXGSH*MXGSH)
C
      PARAMETER (NTX=4, NPF=450, NGRD=7, NPX=1000, MXQT=16)
      COMMON /FMTTBL/ FGRID(0:NTX,0:NPF,0:NGRD),XGRID(0:NTX,0:NPX)
     *,               TMAX,RFINC(0:NGRD),RXINC
     *,               RMR(MXQT),TLGM(0:MXQT),NORD
      COMMON /ERIPRM/ EXI(MXGSH),EXJ(MXGSH),EXK(MXGSH),EXL(MXGSH),
     *                CCI(MXGSH),CCJ(MXGSH),CCK(MXGSH),CCL(MXGSH),
     *                XAB(MXG2),YAB(MXG2),ZAB(MXG2),
     *                XCD(MXG2),YCD(MXG2),ZCD(MXG2),
     *                CCBRA(MXG2),CCKET(MXG2),RXB(MXG2),
     *                SLBRA(MXG2),SLKET(MXG2),RXK(MXG2)
      LOGICAL         LCFLAG,LRINT
      COMMON /NLRC  / LCFLAG,EMU,EMU2,LRFILE
      COMMON /NLRCF / LRINT
      COMMON /SHLNOS/ QQ4,IDUMMY(20)
C
      DIMENSION  FT(0:16),SFAC( 9),CNF(11)
C
      PARAMETER (NL=  9, NK=  8, NJ=  5, NI=  3)
      DIMENSION  LSF(NL),KSF(NK),JSF(NJ),ISF(NI)
      DIMENSION  LJI(NL),KJI(NK),JJI(NJ),IJI(NI)
      DIMENSION  L0I(NL),K0I(NK),J0I(NJ),I0I(NI)
      DIMENSION  L0F(NL),K0F(NK),J0F(NJ),I0F(NI)
C
      PARAMETER (ZER=0.0D+00, ONE=1.0D+00, TWO=2.0D+00)
      PARAMETER (CCTOL=1.0D-13)
      DATA CNF/0.0D+00,0.0D+00,0.0D+00,1.0D+00,2.0D+00,3.0D+00,
     &         4.0D+00,5.0D+00,6.0D+00,7.0D+00,8.0D+00/
      SAVE CNF
C
      DATA LSF/  1,  2,  3,  1,  2,  1,  2,  1,  1/
      DATA LJI/115,115,136,157,171,211,237,276,346/
      DATA L0I/122,129,143,164,178,224,250,289,368/
      DATA L0F/128,135,149,170,184,236,262,301,389/
C
      DATA KSF/  3,  4,  3,  4,  3,  4,  4,  4/
      DATA KJI/108,108,150,150,198,198,263,324/
      DATA K0I/115,136,157,171,211,237,276,346/
      DATA K0F/121,142,163,177,223,249,288,367/
C
      DATA JSF/  1,  2,  1,  2,  1/
      DATA JJI/101,101,185,185,302/
      DATA J0I/108,150,198,263,324/
      DATA J0F/114,156,210,275,345/
C
      DATA ISF/  2,  2,  2/
      DATA IJI/  5, 12, 25/
      DATA I0I/101,185,302/
      DATA I0F/107,197,323/
C
      SFAC(1)= ONE
      PHI( 50)= ZER
      PHI( 52)= ZER
      PHI( 53)= ZER
      PHI( 55)= ZER
      PHI( 65)= ZER
      PHI( 66)= ZER
      PHI( 67)= ZER
      PHI( 71)= ZER
      PHI( 72)= ZER
      PHI( 73)= ZER
      PHI( 74)= ZER
      PHI( 75)= ZER
      PHI( 76)= ZER
      PHI( 80)= ZER
      PHI( 81)= ZER
      PHI( 82)= ZER
      PHI( 89)= ZER
      PHI( 90)= ZER
      PHI( 91)= ZER
      PHI( 92)= ZER
      PHI( 93)= ZER
      PHI( 94)= ZER
      PHI( 98)= ZER
      PHI( 99)= ZER
      PHI(100)= ZER
      DO N= 1,NL
         DO I=L0I(N),L0F(N)
            PHI(I)= ZER
         END DO
      END DO
      KL=0
      DO LL=1,LPRIM
         X04= EXL(LL)
         PHI( 49)= ZER
         PHI( 51)= ZER
         PHI( 54)= ZER
         PHI( 62)= ZER
         PHI( 63)= ZER
         PHI( 64)= ZER
         PHI( 68)= ZER
         PHI( 69)= ZER
         PHI( 70)= ZER
         PHI( 77)= ZER
         PHI( 78)= ZER
         PHI( 79)= ZER
         PHI( 86)= ZER
         PHI( 87)= ZER
         PHI( 88)= ZER
         PHI( 95)= ZER
         PHI( 96)= ZER
         PHI( 97)= ZER
         DO N= 1,NK
            DO I=K0I(N),K0F(N)
               PHI(I)= ZER
            END DO
         END DO
         KTOP= KPRIM
         IF(KEQL) KTOP= LL
         DO KK=1,KTOP
            KL= KL+1
            CFK= CCKET(KL)
            IF(ABS(CFK).GT.CCTOL) THEN
               CFK= CFK*QQ4
               X03= EXK(KK)
               X34= X03+X04
               XKL= XCD(KL)
               YKL= YCD(KL)
               ZKL= ZCD(KL)
               PHI( 48)= ZER
               PHI( 59)= ZER
               PHI( 60)= ZER
               PHI( 61)= ZER
               PHI( 83)= ZER
               PHI( 84)= ZER
               PHI( 85)= ZER
               DO N= 1,NJ
                  DO I=J0I(N),J0F(N)
                     PHI(I)= ZER
                  END DO
               END DO
               IJ=0
               DO JJ=1,JPRIM
                  X02= EXJ(JJ)
                  PHI( 47)= ZER
                  PHI( 56)= ZER
                  PHI( 57)= ZER
                  PHI( 58)= ZER
                  DO N= 1,NI
                     DO I=I0I(N),I0F(N)
                        PHI(I)= ZER
                     END DO
                  END DO
                  ITOP= IPRIM
                  IF(IEQJ) ITOP= JJ
                  DO II=1,ITOP
                     IJ= IJ+1
                     CFB= CCBRA(IJ)
                     IF(ABS(CFB).GT.CCTOL) THEN
                        X01= EXI(II)
                        X12= X01+X02
                        X41= ONE/(X12+X34)
                        FTZ= CFB*CFK
                        RX = XKL-XAB(IJ)
                        RY = YKL-YAB(IJ)
                        RZ = ZKL-ZAB(IJ)
                        RSQ= RX*RX+RY*RY+RZ*RZ
                        RHO= X12*X34*X41
                        IF(LRINT) THEN
                           EFR= EMU2/(EMU2+RHO)
                           RHO= RHO*EFR
                        ENDIF
                        TT = RSQ*RHO
                        N=4
                        IF(TT.LE.TMAX) THEN
C
C     FM(T) EVALUATION
C
                           TV= TT*RFINC(N)
                           IP= NINT(TV)
                           FX=    FGRID(4,IP,N) *TV
                           FX=(FX+FGRID(3,IP,N))*TV
                           FX=(FX+FGRID(2,IP,N))*TV
                           FX=(FX+FGRID(1,IP,N))*TV
                           FX= FX+FGRID(0,IP,N)
                           TV= TT*RXINC
                           IP= NINT(TV)
                           ET=    XGRID(4,IP) *TV
                           ET=(ET+XGRID(3,IP))*TV
                           ET=(ET+XGRID(2,IP))*TV
                           ET=(ET+XGRID(1,IP))*TV
                           ET= ET+XGRID(0,IP)
C
                           FT(N)= FX
                           T2= TT+TT
                           DO M=N,1,-1
                              FT(M-1)=(T2*FT(M)+ET)*RMR(M)
                           END DO
C
                           RHO= RHO+RHO
                           IF(LRINT) FTZ= FTZ*SQRT(EFR)
                           FTF= FTZ*SQRT(X41)
                           DO 210 M=0,N
                              FT(M)= FT(M)*FTF
  210                      FTF= FTF*RHO
                        ELSE
                           XIN= ONE/RSQ
                           FTF= FTZ*SQRT(XIN)*SLBRA(IJ)*SLKET(KL)
                           FT(0)= FTF
                           DO 220 M=1,N
                              FTF= FTF*XIN
  220                      FT(M)= TLGM(M)*FTF
                        END IF
C
                        CALL PHIFTS(5,RX,RY,RZ,PHI,FT)
C
                        FAC= RXB(IJ)
                        SFAC(2)= FAC
                        PHI( 47)= PHI( 47)+PHI(  1)*SFAC(2)
C
                        PHI( 56)= PHI( 56)+PHI(  2)*SFAC(2)
                        PHI( 57)= PHI( 57)+PHI(  3)*SFAC(2)
                        PHI( 58)= PHI( 58)+PHI(  4)*SFAC(2)
                        DO N= 1,NI
                           FAC= SFAC(ISF(N))
                           J=IJI(N)
                           DO I=I0I(N),I0F(N)
                              PHI(I)= PHI(I)+PHI(J)*FAC
                              J=J+1
                           END DO
                        END DO
                     END IF
                  END DO
                  FAC= EXJ(JJ)*TWO
                  SFAC(2)= FAC
                  PHI( 48)= PHI( 48)+PHI( 47)*SFAC(2)
C
                  PHI( 59)= PHI( 59)+PHI( 56)
                  PHI( 60)= PHI( 60)+PHI( 57)
                  PHI( 61)= PHI( 61)+PHI( 58)
                  PHI( 83)= PHI( 83)+PHI( 56)*SFAC(2)
                  PHI( 84)= PHI( 84)+PHI( 57)*SFAC(2)
                  PHI( 85)= PHI( 85)+PHI( 58)*SFAC(2)
                  DO N= 1,NJ
                     FAC= SFAC(JSF(N))
                     J=JJI(N)
                     IF(FAC.EQ.ONE) THEN
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)
                           J=J+1
                        END DO
                     ELSE
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)*FAC
                           J=J+1
                        END DO
                     END IF
                  END DO
               END DO
               FAC= RXK(KL)
               SFAC(2)= FAC
               SFAC(3)= SFAC(2)*FAC
               SFAC(4)= SFAC(3)*FAC
               PHI( 49)= PHI( 49)+PHI( 48)*SFAC(2)
               PHI( 51)= PHI( 51)+PHI( 48)*SFAC(3)
               PHI( 54)= PHI( 54)+PHI( 48)*SFAC(4)
C
               PHI( 62)= PHI( 62)+PHI( 59)*SFAC(2)
               PHI( 63)= PHI( 63)+PHI( 60)*SFAC(2)
               PHI( 64)= PHI( 64)+PHI( 61)*SFAC(2)
               PHI( 68)= PHI( 68)+PHI( 59)*SFAC(3)
               PHI( 69)= PHI( 69)+PHI( 60)*SFAC(3)
               PHI( 70)= PHI( 70)+PHI( 61)*SFAC(3)
               PHI( 77)= PHI( 77)+PHI( 59)*SFAC(4)
               PHI( 78)= PHI( 78)+PHI( 60)*SFAC(4)
               PHI( 79)= PHI( 79)+PHI( 61)*SFAC(4)
               PHI( 86)= PHI( 86)+PHI( 83)*SFAC(3)
               PHI( 87)= PHI( 87)+PHI( 84)*SFAC(3)
               PHI( 88)= PHI( 88)+PHI( 85)*SFAC(3)
               PHI( 95)= PHI( 95)+PHI( 83)*SFAC(4)
               PHI( 96)= PHI( 96)+PHI( 84)*SFAC(4)
               PHI( 97)= PHI( 97)+PHI( 85)*SFAC(4)
               DO N= 1,NK
                  FAC= SFAC(KSF(N))
                  J=KJI(N)
                  DO I=K0I(N),K0F(N)
                     PHI(I)= PHI(I)+PHI(J)*FAC
                     J=J+1
                  END DO
               END DO
            END IF
         END DO
         FAC= EXL(LL)*TWO
         SFAC(2)= FAC
         SFAC(3)= SFAC(2)*FAC
         SFAC(4)= SFAC(3)*FAC
         PHI( 50)= PHI( 50)+PHI( 49)
         PHI( 52)= PHI( 52)+PHI( 51)*SFAC(2)
         PHI( 53)= PHI( 53)+PHI( 51)*SFAC(3)
         PHI( 55)= PHI( 55)+PHI( 54)*SFAC(4)
C
         PHI( 65)= PHI( 65)+PHI( 62)
         PHI( 66)= PHI( 66)+PHI( 63)
         PHI( 67)= PHI( 67)+PHI( 64)
         PHI( 71)= PHI( 71)+PHI( 68)*SFAC(2)
         PHI( 72)= PHI( 72)+PHI( 69)*SFAC(2)
         PHI( 73)= PHI( 73)+PHI( 70)*SFAC(2)
         PHI( 74)= PHI( 74)+PHI( 68)*SFAC(3)
         PHI( 75)= PHI( 75)+PHI( 69)*SFAC(3)
         PHI( 76)= PHI( 76)+PHI( 70)*SFAC(3)
         PHI( 80)= PHI( 80)+PHI( 77)*SFAC(4)
         PHI( 81)= PHI( 81)+PHI( 78)*SFAC(4)
         PHI( 82)= PHI( 82)+PHI( 79)*SFAC(4)
         PHI( 89)= PHI( 89)+PHI( 86)
         PHI( 90)= PHI( 90)+PHI( 87)
         PHI( 91)= PHI( 91)+PHI( 88)
         PHI( 92)= PHI( 92)+PHI( 86)*SFAC(2)
         PHI( 93)= PHI( 93)+PHI( 87)*SFAC(2)
         PHI( 94)= PHI( 94)+PHI( 88)*SFAC(2)
         PHI( 98)= PHI( 98)+PHI( 95)*SFAC(3)
         PHI( 99)= PHI( 99)+PHI( 96)*SFAC(3)
         PHI(100)= PHI(100)+PHI( 97)*SFAC(3)
         DO N= 1,NL
            FAC= SFAC(LSF(N))
            J=LJI(N)
            IF(FAC.EQ.ONE) THEN
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)
                  J=J+1
               END DO
            ELSE
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)*FAC
                  J=J+1
               END DO
            END IF
         END DO
      END DO
C  POST-CONTRACTION PHASE
      PHI(123)= PHI(123)-PHI(122)
      PHI(125)= PHI(125)-PHI(122)
      PHI(128)= PHI(128)-PHI(122)
      PHI(130)= PHI(130)-PHI(129)
      PHI(132)= PHI(132)-PHI(129)
      PHI(135)= PHI(135)-PHI(129)
      PHI(144)= PHI(144)-PHI(143)
      PHI(146)= PHI(146)-PHI(143)
      PHI(149)= PHI(149)-PHI(143)
      PHI(165)= PHI(165)-PHI(164)
      PHI(167)= PHI(167)-PHI(164)
      PHI(170)= PHI(170)-PHI(164)
      PHI(179)= PHI(179)-PHI(178)
      PHI(181)= PHI(181)-PHI(178)
      PHI(184)= PHI(184)-PHI(178)
      III=184+ 30
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
      III=III+ 13*3
      CALL PHIIJ3(III,PHI)
C
      III=III+ 61
      III=III+ 22
      CALL PHIIJ4(III,PHI)
C
      CNF(1)= XB-XA
      CNF(2)= YB-YA
      CNF(3)= ZB-ZA
      WK1(  2)= PHI( 74)+PHI( 53)*CNF( 1)
      WK1(  3)= PHI( 75)+PHI( 53)*CNF( 2)
      WK1(  4)= PHI( 76)+PHI( 53)*CNF( 3)
      CALL DPPS_BCTE(WK1,WK2,LENW, 1)
      WK1(  2)= PHI( 65)+PHI( 50)*CNF( 1)
      WK1(  3)= PHI( 66)+PHI( 50)*CNF( 2)
      WK1(  4)= PHI( 67)+PHI( 50)*CNF( 3)
      CALL DPPS_BCTE(WK1,WK2,LENW, 2)
      I=130
      J= 92
      L=3
      DO K=  3,  5
         IF(K.EQ. 5) I=I+1
         IF(K.EQ. 5) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DPPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=227
      J=165
      L=4
      DO K=  6, 11
         IF(K.EQ. 9 .OR. K.EQ.11) I=I+1
         IF(K.EQ. 9 .OR. K.EQ.11) L=L-1
         WK1(  2)= PHI(I  )+PHI(J)*CNF( 1)
         WK1(  3)= PHI(I+1)+PHI(J)*CNF( 2)
         WK1(  4)= PHI(I+L)+PHI(J)*CNF( 3)
         CALL DPPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      WK1(  2)= PHI( 80)+PHI( 55)*CNF( 1)
      WK1(  3)= PHI( 81)+PHI( 55)*CNF( 2)
      WK1(  4)= PHI( 82)+PHI( 55)*CNF( 3)
      CALL DPPS_BCTE(WK1,WK2,LENW,12)
      WK1(  2)= PHI( 71)+PHI( 52)*CNF( 1)
      WK1(  3)= PHI( 72)+PHI( 52)*CNF( 2)
      WK1(  4)= PHI( 73)+PHI( 52)*CNF( 3)
      CALL DPPS_BCTE(WK1,WK2,LENW,13)
      I=144
      J= 98
      L=3
      DO K= 14, 16
         IF(K.EQ.16) I=I+1
         IF(K.EQ.16) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DPPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=123
      J= 89
      L=3
      DO K= 17, 19
         IF(K.EQ.19) I=I+1
         IF(K.EQ.19) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DPPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=253
      J=179
      L=4
      DO K= 20, 25
         IF(K.EQ.23 .OR. K.EQ.25) I=I+1
         IF(K.EQ.23 .OR. K.EQ.25) L=L-1
         WK1(  2)= PHI(I  )+PHI(J)*CNF( 1)
         WK1(  3)= PHI(I+1)+PHI(J)*CNF( 2)
         WK1(  4)= PHI(I+L)+PHI(J)*CNF( 3)
         CALL DPPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=375
      J=292
      L=5
      DO K= 26, 35
         IF(K.EQ.30 .OR. K.EQ.33 .OR. K.EQ.35) I=I+1
         IF(K.EQ.30 .OR. K.EQ.33 .OR. K.EQ.35) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DPPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      CNF(1)= XD-XC
      CNF(2)= YD-YC
      CNF(3)= ZD-ZC
      DO I=1,3
         CALL DPWRKT(I,WK2,LENW,CNF)
         CALL DPWRKM(I,WK2,LENW,CNF)
         CALL DPWRKB(I,WK2,LENW,CNF)
      END DO
C
      RETURN
      END
C*MODULE INT2D   *DECK DPPS_BCTE
C>
C>    @brief   ERIC dpps backtransfer
C>
C>    @details ERIC [dp|ps] backtransfer step
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DPPS_BCTE(WK1,WK2,LENW,JR)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    LENW,I,J,JR
      DIMENSION  WK1(*),WK2(LENW,*)
C
      J=  1
      DO I=1,3
         J=J+1
         WK2(JR,I)= WK1(J)
      END DO
C
      RETURN
      END
C  LPHI=1181
C  LWK1=  24
C  LWK2= 477
C  LENW=  53
C*MODULE INT2D   *DECK DPPP
C>
C>    @brief   ERIC dppp case
C>
C>    @details ERIC [dp|pp] integral quartet
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DPPP (IPRIM,JPRIM,KPRIM,LPRIM,IEQJ,KEQL,
     *                 XA,YA,ZA,XB,YB,ZB,XC,YC,ZC,XD,YD,ZD,
     *                 PHI,WK1,WK2,LENW)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      LOGICAL    IEQJ,KEQL
      DIMENSION  PHI(*),WK1(*),WK2(LENW,*)
C
      PARAMETER (MXGSH=30, MXG2= MXGSH*MXGSH)
C
      PARAMETER (NTX=4, NPF=450, NGRD=7, NPX=1000, MXQT=16)
      COMMON /FMTTBL/ FGRID(0:NTX,0:NPF,0:NGRD),XGRID(0:NTX,0:NPX)
     *,               TMAX,RFINC(0:NGRD),RXINC
     *,               RMR(MXQT),TLGM(0:MXQT),NORD
      COMMON /ERIPRM/ EXI(MXGSH),EXJ(MXGSH),EXK(MXGSH),EXL(MXGSH),
     *                CCI(MXGSH),CCJ(MXGSH),CCK(MXGSH),CCL(MXGSH),
     *                XAB(MXG2),YAB(MXG2),ZAB(MXG2),
     *                XCD(MXG2),YCD(MXG2),ZCD(MXG2),
     *                CCBRA(MXG2),CCKET(MXG2),RXB(MXG2),
     *                SLBRA(MXG2),SLKET(MXG2),RXK(MXG2)
      LOGICAL         LCFLAG,LRINT
      COMMON /NLRC  / LCFLAG,EMU,EMU2,LRFILE
      COMMON /NLRCF / LRINT
      COMMON /SHLNOS/ QQ4,IDUMMY(20)
C
      DIMENSION  FT(0:16),SFAC( 9),CNF(11)
C
      PARAMETER (NL= 30, NK= 24, NJ= 14, NI=  7)
      DIMENSION  LSF(NL),KSF(NK),JSF(NJ),ISF(NI)
      DIMENSION  LJI(NL),KJI(NK),JJI(NJ),IJI(NI)
      DIMENSION  L0I(NL),K0I(NK),J0I(NJ),I0I(NI)
      DIMENSION  L0F(NL),K0F(NK),J0F(NJ),I0F(NI)
C
      PARAMETER (ZER=0.0D+00, ONE=1.0D+00, TWO=2.0D+00)
      PARAMETER (CCTOL=1.0D-13)
      DATA CNF/0.0D+00,0.0D+00,0.0D+00,1.0D+00,2.0D+00,3.0D+00,
     &         4.0D+00,5.0D+00,6.0D+00,7.0D+00,8.0D+00/
      SAVE CNF
C
      DATA LSF/  1,  2,  2,  3,  1,  2,  1,  2,  3,  4,
     *           1,  2,  3,  1,  2,  1,  1,  2,  1,  1,
     *           2,  3,  1,  2,  1,  1,  1,  2,  1,  1/
      DATA LJI/217,217,238,238,266,280,308,322,322,343,
     *         364,364,385,406,420,460,486,486,538,590,
     *         590,629,668,694,733,803,891,935,1001,1113/
      DATA L0I/224,231,245,252,273,287,315,329,336,350,
     *         371,378,392,413,427,473,499,512,551,603,
     *         616,642,681,707,746,825,913,957,1023,1147/
      DATA L0F/230,237,251,258,279,293,321,335,342,356,
     *         377,384,398,419,433,485,511,524,563,615,
     *         628,654,693,719,758,846,934,978,1044,1180/
C
      DATA KSF/  3,  4,  3,  4,  2,  3,  4,  3,  4,  3,
     *           4,  3,  4,  4,  3,  4,  3,  4,  4,  4,
     *           3,  4,  4,  4/
      DATA KJI/210,210,259,259,301,301,301,357,357,399,
     *         399,447,447,525,577,577,655,655,720,781,
     *         869,869, 979,1079/
      DATA K0I/217,238,266,280,308,322,343,364,385,406,
     *         420,460,486,538,590,629,668,694,733,803,
     *         891,935,1001,1113/
      DATA K0F/223,244,272,286,314,328,349,370,391,412,
     *         426,472,498,550,602,641,680,706,745,824,
     *         912,956,1022,1146/
C
      DATA JSF/  1,  2,  1,  2,  3,  1,  2,  1,  2,  3,
     *           1,  1,  2,  1/
      DATA JJI/203,203,294,294,294,434,434,564,564,564,
     *         759,847,847,1045/
      DATA J0I/210,259,301,357,399,447,525,577,655,720,
     *         781,869,979,1079/
      DATA J0F/216,265,307,363,405,459,537,589,667,732,
     *         802,890,1000,1112/
C
      DATA ISF/  2,  3,  2,  3,  2,  3,   3/
      DATA IJI/  5,  5, 12, 12, 25, 25,  47/
      DATA I0I/203,294,434,564,759,847,1045/
      DATA I0F/209,300,446,576,780,868,1078/
C
      SFAC(1)= ONE
      PHI( 84)= ZER
      PHI( 86)= ZER
      PHI( 87)= ZER
      PHI( 89)= ZER
      PHI( 92)= ZER
      PHI( 94)= ZER
      PHI( 95)= ZER
      PHI( 97)= ZER
      PHI(101)= ZER
      PHI(103)= ZER
      PHI(104)= ZER
      PHI(106)= ZER
      PHI(116)= ZER
      PHI(117)= ZER
      PHI(118)= ZER
      PHI(122)= ZER
      PHI(123)= ZER
      PHI(124)= ZER
      PHI(125)= ZER
      PHI(126)= ZER
      PHI(127)= ZER
      PHI(128)= ZER
      PHI(129)= ZER
      PHI(130)= ZER
      PHI(134)= ZER
      PHI(135)= ZER
      PHI(136)= ZER
      PHI(137)= ZER
      PHI(138)= ZER
      PHI(139)= ZER
      PHI(146)= ZER
      PHI(147)= ZER
      PHI(148)= ZER
      PHI(149)= ZER
      PHI(150)= ZER
      PHI(151)= ZER
      PHI(155)= ZER
      PHI(156)= ZER
      PHI(157)= ZER
      PHI(167)= ZER
      PHI(168)= ZER
      PHI(169)= ZER
      PHI(173)= ZER
      PHI(174)= ZER
      PHI(175)= ZER
      PHI(176)= ZER
      PHI(177)= ZER
      PHI(178)= ZER
      PHI(182)= ZER
      PHI(183)= ZER
      PHI(184)= ZER
      PHI(191)= ZER
      PHI(192)= ZER
      PHI(193)= ZER
      PHI(194)= ZER
      PHI(195)= ZER
      PHI(196)= ZER
      PHI(200)= ZER
      PHI(201)= ZER
      PHI(202)= ZER
      DO N= 1,NL
         DO I=L0I(N),L0F(N)
            PHI(I)= ZER
         END DO
      END DO
      KL=0
      DO LL=1,LPRIM
         X04= EXL(LL)
         PHI( 83)= ZER
         PHI( 85)= ZER
         PHI( 88)= ZER
         PHI( 91)= ZER
         PHI( 93)= ZER
         PHI( 96)= ZER
         PHI(100)= ZER
         PHI(102)= ZER
         PHI(105)= ZER
         PHI(113)= ZER
         PHI(114)= ZER
         PHI(115)= ZER
         PHI(119)= ZER
         PHI(120)= ZER
         PHI(121)= ZER
         PHI(131)= ZER
         PHI(132)= ZER
         PHI(133)= ZER
         PHI(143)= ZER
         PHI(144)= ZER
         PHI(145)= ZER
         PHI(152)= ZER
         PHI(153)= ZER
         PHI(154)= ZER
         PHI(164)= ZER
         PHI(165)= ZER
         PHI(166)= ZER
         PHI(170)= ZER
         PHI(171)= ZER
         PHI(172)= ZER
         PHI(179)= ZER
         PHI(180)= ZER
         PHI(181)= ZER
         PHI(188)= ZER
         PHI(189)= ZER
         PHI(190)= ZER
         PHI(197)= ZER
         PHI(198)= ZER
         PHI(199)= ZER
         DO N= 1,NK
            DO I=K0I(N),K0F(N)
               PHI(I)= ZER
            END DO
         END DO
         KTOP= KPRIM
         IF(KEQL) KTOP= LL
         DO KK=1,KTOP
            KL= KL+1
            CFK= CCKET(KL)
            IF(ABS(CFK).GT.CCTOL) THEN
               CFK= CFK*QQ4
               X03= EXK(KK)
               X34= X03+X04
               XKL= XCD(KL)
               YKL= YCD(KL)
               ZKL= ZCD(KL)
               PHI( 82)= ZER
               PHI( 90)= ZER
               PHI( 99)= ZER
               PHI(110)= ZER
               PHI(111)= ZER
               PHI(112)= ZER
               PHI(140)= ZER
               PHI(141)= ZER
               PHI(142)= ZER
               PHI(161)= ZER
               PHI(162)= ZER
               PHI(163)= ZER
               PHI(185)= ZER
               PHI(186)= ZER
               PHI(187)= ZER
               DO N= 1,NJ
                  DO I=J0I(N),J0F(N)
                     PHI(I)= ZER
                  END DO
               END DO
               IJ=0
               DO JJ=1,JPRIM
                  X02= EXJ(JJ)
                  PHI( 81)= ZER
                  PHI( 98)= ZER
                  PHI(107)= ZER
                  PHI(108)= ZER
                  PHI(109)= ZER
                  PHI(158)= ZER
                  PHI(159)= ZER
                  PHI(160)= ZER
                  DO N= 1,NI
                     DO I=I0I(N),I0F(N)
                        PHI(I)= ZER
                     END DO
                  END DO
                  ITOP= IPRIM
                  IF(IEQJ) ITOP= JJ
                  DO II=1,ITOP
                     IJ= IJ+1
                     CFB= CCBRA(IJ)
                     IF(ABS(CFB).GT.CCTOL) THEN
                        X01= EXI(II)
                        X12= X01+X02
                        X41= ONE/(X12+X34)
                        FTZ= CFB*CFK
                        RX = XKL-XAB(IJ)
                        RY = YKL-YAB(IJ)
                        RZ = ZKL-ZAB(IJ)
                        RSQ= RX*RX+RY*RY+RZ*RZ
                        RHO= X12*X34*X41
                        IF(LRINT) THEN
                           EFR= EMU2/(EMU2+RHO)
                           RHO= RHO*EFR
                        ENDIF
                        TT = RSQ*RHO
                        N=5
                        IF(TT.LE.TMAX) THEN
C
C     FM(T) EVALUATION
C
                           TV= TT*RFINC(N)
                           IP= NINT(TV)
                           FX=    FGRID(4,IP,N) *TV
                           FX=(FX+FGRID(3,IP,N))*TV
                           FX=(FX+FGRID(2,IP,N))*TV
                           FX=(FX+FGRID(1,IP,N))*TV
                           FX= FX+FGRID(0,IP,N)
                           TV= TT*RXINC
                           IP= NINT(TV)
                           ET=    XGRID(4,IP) *TV
                           ET=(ET+XGRID(3,IP))*TV
                           ET=(ET+XGRID(2,IP))*TV
                           ET=(ET+XGRID(1,IP))*TV
                           ET= ET+XGRID(0,IP)
C
                           FT(8)= FX
                           T2= TT+TT
                           DO M=8,1,-1
                              FT(M-1)=(T2*FT(M)+ET)*RMR(M)
                           END DO
C
                           RHO= RHO+RHO
                           IF(LRINT) FTZ= FTZ*SQRT(EFR)
                           FTF= FTZ*SQRT(X41)
                           DO 210 M=0,N
                              FT(M)= FT(M)*FTF
  210                      FTF= FTF*RHO
                        ELSE
                           XIN= ONE/RSQ
                           FTF= FTZ*SQRT(XIN)*SLBRA(IJ)*SLKET(KL)
                           FT(0)= FTF
                           DO 220 M=1,N
                              FTF= FTF*XIN
  220                      FT(M)= TLGM(M)*FTF
                        END IF
C
                        CALL PHIFTS(6,RX,RY,RZ,PHI,FT)
C
                        FAC= RXB(IJ)
                        SFAC(2)= FAC
                        SFAC(3)= SFAC(2)*FAC
                        PHI( 81)= PHI( 81)+PHI(  1)*SFAC(2)
                        PHI( 98)= PHI( 98)+PHI(  1)*SFAC(3)
C
                        PHI(107)= PHI(107)+PHI(  2)*SFAC(2)
                        PHI(108)= PHI(108)+PHI(  3)*SFAC(2)
                        PHI(109)= PHI(109)+PHI(  4)*SFAC(2)
                        PHI(158)= PHI(158)+PHI(  2)*SFAC(3)
                        PHI(159)= PHI(159)+PHI(  3)*SFAC(3)
                        PHI(160)= PHI(160)+PHI(  4)*SFAC(3)
                        DO N= 1,NI
                           FAC= SFAC(ISF(N))
                           J=IJI(N)
                           DO I=I0I(N),I0F(N)
                              PHI(I)= PHI(I)+PHI(J)*FAC
                              J=J+1
                           END DO
                        END DO
                     END IF
                  END DO
                  FAC= EXJ(JJ)*TWO
                  SFAC(2)= FAC
                  SFAC(3)= SFAC(2)*FAC
                  PHI( 82)= PHI( 82)+PHI( 81)
                  PHI( 90)= PHI( 90)+PHI( 81)*SFAC(2)
                  PHI( 99)= PHI( 99)+PHI( 98)*SFAC(3)
C
                  PHI(110)= PHI(110)+PHI(107)
                  PHI(111)= PHI(111)+PHI(108)
                  PHI(112)= PHI(112)+PHI(109)
                  PHI(140)= PHI(140)+PHI(107)*SFAC(2)
                  PHI(141)= PHI(141)+PHI(108)*SFAC(2)
                  PHI(142)= PHI(142)+PHI(109)*SFAC(2)
                  PHI(161)= PHI(161)+PHI(158)*SFAC(2)
                  PHI(162)= PHI(162)+PHI(159)*SFAC(2)
                  PHI(163)= PHI(163)+PHI(160)*SFAC(2)
                  PHI(185)= PHI(185)+PHI(158)*SFAC(3)
                  PHI(186)= PHI(186)+PHI(159)*SFAC(3)
                  PHI(187)= PHI(187)+PHI(160)*SFAC(3)
                  DO N= 1,NJ
                     FAC= SFAC(JSF(N))
                     J=JJI(N)
                     IF(FAC.EQ.ONE) THEN
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)
                           J=J+1
                        END DO
                     ELSE
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)*FAC
                           J=J+1
                        END DO
                     END IF
                  END DO
               END DO
               FAC= RXK(KL)
               SFAC(2)= FAC
               SFAC(3)= SFAC(2)*FAC
               SFAC(4)= SFAC(3)*FAC
               PHI( 83)= PHI( 83)+PHI( 82)*SFAC(2)
               PHI( 85)= PHI( 85)+PHI( 82)*SFAC(3)
               PHI( 88)= PHI( 88)+PHI( 82)*SFAC(4)
               PHI( 91)= PHI( 91)+PHI( 90)*SFAC(2)
               PHI( 93)= PHI( 93)+PHI( 90)*SFAC(3)
               PHI( 96)= PHI( 96)+PHI( 90)*SFAC(4)
               PHI(100)= PHI(100)+PHI( 99)*SFAC(2)
               PHI(102)= PHI(102)+PHI( 99)*SFAC(3)
               PHI(105)= PHI(105)+PHI( 99)*SFAC(4)
C
               PHI(113)= PHI(113)+PHI(110)*SFAC(2)
               PHI(114)= PHI(114)+PHI(111)*SFAC(2)
               PHI(115)= PHI(115)+PHI(112)*SFAC(2)
               PHI(119)= PHI(119)+PHI(110)*SFAC(3)
               PHI(120)= PHI(120)+PHI(111)*SFAC(3)
               PHI(121)= PHI(121)+PHI(112)*SFAC(3)
               PHI(131)= PHI(131)+PHI(110)*SFAC(4)
               PHI(132)= PHI(132)+PHI(111)*SFAC(4)
               PHI(133)= PHI(133)+PHI(112)*SFAC(4)
               PHI(143)= PHI(143)+PHI(140)*SFAC(3)
               PHI(144)= PHI(144)+PHI(141)*SFAC(3)
               PHI(145)= PHI(145)+PHI(142)*SFAC(3)
               PHI(152)= PHI(152)+PHI(140)*SFAC(4)
               PHI(153)= PHI(153)+PHI(141)*SFAC(4)
               PHI(154)= PHI(154)+PHI(142)*SFAC(4)
               PHI(164)= PHI(164)+PHI(161)*SFAC(2)
               PHI(165)= PHI(165)+PHI(162)*SFAC(2)
               PHI(166)= PHI(166)+PHI(163)*SFAC(2)
               PHI(170)= PHI(170)+PHI(161)*SFAC(3)
               PHI(171)= PHI(171)+PHI(162)*SFAC(3)
               PHI(172)= PHI(172)+PHI(163)*SFAC(3)
               PHI(179)= PHI(179)+PHI(161)*SFAC(4)
               PHI(180)= PHI(180)+PHI(162)*SFAC(4)
               PHI(181)= PHI(181)+PHI(163)*SFAC(4)
               PHI(188)= PHI(188)+PHI(185)*SFAC(3)
               PHI(189)= PHI(189)+PHI(186)*SFAC(3)
               PHI(190)= PHI(190)+PHI(187)*SFAC(3)
               PHI(197)= PHI(197)+PHI(185)*SFAC(4)
               PHI(198)= PHI(198)+PHI(186)*SFAC(4)
               PHI(199)= PHI(199)+PHI(187)*SFAC(4)
               DO N= 1,NK
                  FAC= SFAC(KSF(N))
                  J=KJI(N)
                  DO I=K0I(N),K0F(N)
                     PHI(I)= PHI(I)+PHI(J)*FAC
                     J=J+1
                  END DO
               END DO
            END IF
         END DO
         FAC= EXL(LL)*TWO
         SFAC(2)= FAC
         SFAC(3)= SFAC(2)*FAC
         SFAC(4)= SFAC(3)*FAC
         PHI( 84)= PHI( 84)+PHI( 83)
         PHI( 86)= PHI( 86)+PHI( 85)*SFAC(2)
         PHI( 87)= PHI( 87)+PHI( 85)*SFAC(3)
         PHI( 89)= PHI( 89)+PHI( 88)*SFAC(4)
         PHI( 92)= PHI( 92)+PHI( 91)
         PHI( 94)= PHI( 94)+PHI( 93)*SFAC(2)
         PHI( 95)= PHI( 95)+PHI( 93)*SFAC(3)
         PHI( 97)= PHI( 97)+PHI( 96)*SFAC(4)
         PHI(101)= PHI(101)+PHI(100)
         PHI(103)= PHI(103)+PHI(102)*SFAC(2)
         PHI(104)= PHI(104)+PHI(102)*SFAC(3)
         PHI(106)= PHI(106)+PHI(105)*SFAC(4)
C
         PHI(116)= PHI(116)+PHI(113)
         PHI(117)= PHI(117)+PHI(114)
         PHI(118)= PHI(118)+PHI(115)
         PHI(122)= PHI(122)+PHI(119)
         PHI(123)= PHI(123)+PHI(120)
         PHI(124)= PHI(124)+PHI(121)
         PHI(125)= PHI(125)+PHI(119)*SFAC(2)
         PHI(126)= PHI(126)+PHI(120)*SFAC(2)
         PHI(127)= PHI(127)+PHI(121)*SFAC(2)
         PHI(128)= PHI(128)+PHI(119)*SFAC(3)
         PHI(129)= PHI(129)+PHI(120)*SFAC(3)
         PHI(130)= PHI(130)+PHI(121)*SFAC(3)
         PHI(134)= PHI(134)+PHI(131)*SFAC(3)
         PHI(135)= PHI(135)+PHI(132)*SFAC(3)
         PHI(136)= PHI(136)+PHI(133)*SFAC(3)
         PHI(137)= PHI(137)+PHI(131)*SFAC(4)
         PHI(138)= PHI(138)+PHI(132)*SFAC(4)
         PHI(139)= PHI(139)+PHI(133)*SFAC(4)
         PHI(146)= PHI(146)+PHI(143)
         PHI(147)= PHI(147)+PHI(144)
         PHI(148)= PHI(148)+PHI(145)
         PHI(149)= PHI(149)+PHI(143)*SFAC(2)
         PHI(150)= PHI(150)+PHI(144)*SFAC(2)
         PHI(151)= PHI(151)+PHI(145)*SFAC(2)
         PHI(155)= PHI(155)+PHI(152)*SFAC(3)
         PHI(156)= PHI(156)+PHI(153)*SFAC(3)
         PHI(157)= PHI(157)+PHI(154)*SFAC(3)
         PHI(167)= PHI(167)+PHI(164)
         PHI(168)= PHI(168)+PHI(165)
         PHI(169)= PHI(169)+PHI(166)
         PHI(173)= PHI(173)+PHI(170)*SFAC(2)
         PHI(174)= PHI(174)+PHI(171)*SFAC(2)
         PHI(175)= PHI(175)+PHI(172)*SFAC(2)
         PHI(176)= PHI(176)+PHI(170)*SFAC(3)
         PHI(177)= PHI(177)+PHI(171)*SFAC(3)
         PHI(178)= PHI(178)+PHI(172)*SFAC(3)
         PHI(182)= PHI(182)+PHI(179)*SFAC(4)
         PHI(183)= PHI(183)+PHI(180)*SFAC(4)
         PHI(184)= PHI(184)+PHI(181)*SFAC(4)
         PHI(191)= PHI(191)+PHI(188)
         PHI(192)= PHI(192)+PHI(189)
         PHI(193)= PHI(193)+PHI(190)
         PHI(194)= PHI(194)+PHI(188)*SFAC(2)
         PHI(195)= PHI(195)+PHI(189)*SFAC(2)
         PHI(196)= PHI(196)+PHI(190)*SFAC(2)
         PHI(200)= PHI(200)+PHI(197)*SFAC(3)
         PHI(201)= PHI(201)+PHI(198)*SFAC(3)
         PHI(202)= PHI(202)+PHI(199)*SFAC(3)
         DO N= 1,NL
            FAC= SFAC(LSF(N))
            J=LJI(N)
            IF(FAC.EQ.ONE) THEN
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)
                  J=J+1
               END DO
            ELSE
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)*FAC
                  J=J+1
               END DO
            END IF
         END DO
      END DO
C  POST-CONTRACTION PHASE
      PHI(225)= PHI(225)-PHI(224)
      PHI(227)= PHI(227)-PHI(224)
      PHI(230)= PHI(230)-PHI(224)
      PHI(232)= PHI(232)-PHI(231)
      PHI(234)= PHI(234)-PHI(231)
      PHI(237)= PHI(237)-PHI(231)
      PHI(246)= PHI(246)-PHI(245)
      PHI(248)= PHI(248)-PHI(245)
      PHI(251)= PHI(251)-PHI(245)
      PHI(253)= PHI(253)-PHI(252)
      PHI(255)= PHI(255)-PHI(252)
      PHI(258)= PHI(258)-PHI(252)
      PHI(274)= PHI(274)-PHI(273)
      PHI(276)= PHI(276)-PHI(273)
      PHI(279)= PHI(279)-PHI(273)
      PHI(288)= PHI(288)-PHI(287)
      PHI(290)= PHI(290)-PHI(287)
      PHI(293)= PHI(293)-PHI(287)
      PHI(316)= PHI(316)-PHI(315)
      PHI(318)= PHI(318)-PHI(315)
      PHI(321)= PHI(321)-PHI(315)
      PHI(330)= PHI(330)-PHI(329)
      PHI(332)= PHI(332)-PHI(329)
      PHI(335)= PHI(335)-PHI(329)
      PHI(337)= PHI(337)-PHI(336)
      PHI(339)= PHI(339)-PHI(336)
      PHI(342)= PHI(342)-PHI(336)
      PHI(351)= PHI(351)-PHI(350)
      PHI(353)= PHI(353)-PHI(350)
      PHI(356)= PHI(356)-PHI(350)
      PHI(372)= PHI(372)-PHI(371)
      PHI(374)= PHI(374)-PHI(371)
      PHI(377)= PHI(377)-PHI(371)
      PHI(379)= PHI(379)-PHI(378)
      PHI(381)= PHI(381)-PHI(378)
      PHI(384)= PHI(384)-PHI(378)
      PHI(393)= PHI(393)-PHI(392)
      PHI(395)= PHI(395)-PHI(392)
      PHI(398)= PHI(398)-PHI(392)
      PHI(414)= PHI(414)-PHI(413)
      PHI(416)= PHI(416)-PHI(413)
      PHI(419)= PHI(419)-PHI(413)
      PHI(428)= PHI(428)-PHI(427)
      PHI(430)= PHI(430)-PHI(427)
      PHI(433)= PHI(433)-PHI(427)
      III=433+ 30
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*3
      CALL PHIIJ3(III,PHI)
      III=III+ 13*4
      CALL PHIIJ3(III,PHI)
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
      III=III+ 13*3
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
      III=III+ 13*3
      CALL PHIIJ3(III,PHI)
C
      III=III+ 61
      III=III+ 22
      CALL PHIIJ4(III,PHI)
      III=III+ 22*4
      CALL PHIIJ4(III,PHI)
      III=III+ 22*2
      CALL PHIIJ4(III,PHI)
      III=III+ 22*3
      CALL PHIIJ4(III,PHI)
C
      III=III+130
      CALL PHIIJ5(III,PHI)
C
      CNF(1)= XB-XA
      CNF(2)= YB-YA
      CNF(3)= ZB-ZA
      WK1(  2)=          PHI(128)        +PHI( 95)*CNF( 1)
      WK1(  3)=          PHI(129)        +PHI( 95)*CNF( 2)
      WK1(  4)=          PHI(130)        +PHI( 95)*CNF( 3)
      WK1(  7)=          PHI(176)        +PHI(104)*CNF( 1)
      WK1(  8)=          PHI(177)        +PHI(104)*CNF( 2)
      WK1(  9)=          PHI(178)        +PHI(104)*CNF( 3)
      WK1( 10)= PHI(337)+PHI(176)*CNF( 1)+PHI( 87)*CNF( 4)
      WK1( 11)= PHI(338)+PHI(177)*CNF( 1)
      WK1( 12)= PHI(339)+PHI(177)*CNF( 2)+PHI( 87)*CNF( 4)
      WK1( 13)= PHI(340)+PHI(178)*CNF( 1)
      WK1( 14)= PHI(341)+PHI(178)*CNF( 2)
      WK1( 15)= PHI(342)+PHI(178)*CNF( 3)+PHI( 87)*CNF( 4)
      CALL DPPP_BCTE(WK1,WK2,LENW,CNF, 1)
      WK1(  2)=          PHI(116)        +PHI( 92)*CNF( 1)
      WK1(  3)=          PHI(117)        +PHI( 92)*CNF( 2)
      WK1(  4)=          PHI(118)        +PHI( 92)*CNF( 3)
      WK1(  7)=          PHI(167)        +PHI(101)*CNF( 1)
      WK1(  8)=          PHI(168)        +PHI(101)*CNF( 2)
      WK1(  9)=          PHI(169)        +PHI(101)*CNF( 3)
      WK1( 10)= PHI(316)+PHI(167)*CNF( 1)+PHI( 84)*CNF( 4)
      WK1( 11)= PHI(317)+PHI(168)*CNF( 1)
      WK1( 12)= PHI(318)+PHI(168)*CNF( 2)+PHI( 84)*CNF( 4)
      WK1( 13)= PHI(319)+PHI(169)*CNF( 1)
      WK1( 14)= PHI(320)+PHI(169)*CNF( 2)
      WK1( 15)= PHI(321)+PHI(169)*CNF( 3)+PHI( 84)*CNF( 4)
      CALL DPPP_BCTE(WK1,WK2,LENW,CNF, 2)
      I=232
      J=149
      L=3
      DO K=  3,  5
         IF(K.EQ. 5) I=I+1
         IF(K.EQ. 5) L=L-1
         LLL=L+L+1
         M=I+147
         N=M+240+3-L
         WK1(  2)=           -PHI(I   )        -PHI(J    )*CNF( 1)
         WK1(  3)=           -PHI(I+ 1)        -PHI(J    )*CNF( 2)
         WK1(  4)=           -PHI(I+ L)        -PHI(J    )*CNF( 3)
         WK1(  7)=           -PHI(M   )        -PHI(J+ 45)*CNF( 1)
         WK1(  8)=           -PHI(M+ 1)        -PHI(J+ 45)*CNF( 2)
         WK1(  9)=           -PHI(M+ L)        -PHI(J+ 45)*CNF( 3)
         WK1( 10)=-PHI(N    )-PHI(M   )*CNF( 1)-PHI(J- 24)*CNF( 4)
         WK1( 11)=-PHI(N+  1)-PHI(M+ 1)*CNF( 1)
         WK1( 12)=-PHI(N+  2)-PHI(M+ 1)*CNF( 2)-PHI(J- 24)*CNF( 4)
         WK1( 13)=-PHI(N+1+L)-PHI(M+ L)*CNF( 1)
         WK1( 14)=-PHI(N+2+L)-PHI(M+ L)*CNF( 2)
         WK1( 15)=-PHI(N+LLL)-PHI(M+ L)*CNF( 3)-PHI(J- 24)*CNF( 4)
         CALL DPPP_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      I=476
      J=274
      L=4
      DO K=  6, 11
         IF(K.EQ. 9 .OR. K.EQ.11) I=I+1
         IF(K.EQ. 9 .OR. K.EQ.11) L=L-1
         LLL=L+L+1
         M=I+208
         N=M+236+4-L
         WK1(  2)=            PHI(I   )        +PHI(J    )*CNF( 1)
         WK1(  3)=            PHI(I+ 1)        +PHI(J    )*CNF( 2)
         WK1(  4)=            PHI(I+ L)        +PHI(J    )*CNF( 3)
         WK1(  7)=            PHI(M   )        +PHI(J+140)*CNF( 1)
         WK1(  8)=            PHI(M+ 1)        +PHI(J+140)*CNF( 2)
         WK1(  9)=            PHI(M+ L)        +PHI(J+140)*CNF( 3)
         WK1( 10)= PHI(N    )+PHI(M   )*CNF( 1)+PHI(J- 49)*CNF( 4)
         WK1( 11)= PHI(N+  1)+PHI(M+ 1)*CNF( 1)
         WK1( 12)= PHI(N+  2)+PHI(M+ 1)*CNF( 2)+PHI(J- 49)*CNF( 4)
         WK1( 13)= PHI(N+1+L)+PHI(M+ L)*CNF( 1)
         WK1( 14)= PHI(N+2+L)+PHI(M+ L)*CNF( 2)
         WK1( 15)= PHI(N+LLL)+PHI(M+ L)*CNF( 3)+PHI(J- 49)*CNF( 4)
         CALL DPPP_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      WK1(  2)=          PHI(137)        +PHI( 97)*CNF( 1)
      WK1(  3)=          PHI(138)        +PHI( 97)*CNF( 2)
      WK1(  4)=          PHI(139)        +PHI( 97)*CNF( 3)
      WK1(  7)=          PHI(182)        +PHI(106)*CNF( 1)
      WK1(  8)=          PHI(183)        +PHI(106)*CNF( 2)
      WK1(  9)=          PHI(184)        +PHI(106)*CNF( 3)
      WK1( 10)= PHI(351)+PHI(182)*CNF( 1)+PHI( 89)*CNF( 4)
      WK1( 11)= PHI(352)+PHI(183)*CNF( 1)
      WK1( 12)= PHI(353)+PHI(183)*CNF( 2)+PHI( 89)*CNF( 4)
      WK1( 13)= PHI(354)+PHI(184)*CNF( 1)
      WK1( 14)= PHI(355)+PHI(184)*CNF( 2)
      WK1( 15)= PHI(356)+PHI(184)*CNF( 3)+PHI( 89)*CNF( 4)
      CALL DPPP_BCTE(WK1,WK2,LENW,CNF,12)
      WK1(  2)=          PHI(125)        +PHI( 94)*CNF( 1)
      WK1(  3)=          PHI(126)        +PHI( 94)*CNF( 2)
      WK1(  4)=          PHI(127)        +PHI( 94)*CNF( 3)
      WK1(  7)=          PHI(173)        +PHI(103)*CNF( 1)
      WK1(  8)=          PHI(174)        +PHI(103)*CNF( 2)
      WK1(  9)=          PHI(175)        +PHI(103)*CNF( 3)
      WK1( 10)= PHI(330)+PHI(173)*CNF( 1)+PHI( 86)*CNF( 4)
      WK1( 11)= PHI(331)+PHI(174)*CNF( 1)
      WK1( 12)= PHI(332)+PHI(174)*CNF( 2)+PHI( 86)*CNF( 4)
      WK1( 13)= PHI(333)+PHI(175)*CNF( 1)
      WK1( 14)= PHI(334)+PHI(175)*CNF( 2)
      WK1( 15)= PHI(335)+PHI(175)*CNF( 3)+PHI( 86)*CNF( 4)
      CALL DPPP_BCTE(WK1,WK2,LENW,CNF,13)
      I=253
      J=155
      L=3
      DO K= 14, 16
         IF(K.EQ.16) I=I+1
         IF(K.EQ.16) L=L-1
         LLL=L+L+1
         M=I+140
         N=M+252+3-L
         WK1(  2)=           -PHI(I   )        -PHI(J    )*CNF( 1)
         WK1(  3)=           -PHI(I+ 1)        -PHI(J    )*CNF( 2)
         WK1(  4)=           -PHI(I+ L)        -PHI(J    )*CNF( 3)
         WK1(  7)=           -PHI(M   )        -PHI(J+ 45)*CNF( 1)
         WK1(  8)=           -PHI(M+ 1)        -PHI(J+ 45)*CNF( 2)
         WK1(  9)=           -PHI(M+ L)        -PHI(J+ 45)*CNF( 3)
         WK1( 10)=-PHI(N    )-PHI(M   )*CNF( 1)-PHI(J- 21)*CNF( 4)
         WK1( 11)=-PHI(N+  1)-PHI(M+ 1)*CNF( 1)
         WK1( 12)=-PHI(N+  2)-PHI(M+ 1)*CNF( 2)-PHI(J- 21)*CNF( 4)
         WK1( 13)=-PHI(N+1+L)-PHI(M+ L)*CNF( 1)
         WK1( 14)=-PHI(N+2+L)-PHI(M+ L)*CNF( 2)
         WK1( 15)=-PHI(N+LLL)-PHI(M+ L)*CNF( 3)-PHI(J- 21)*CNF( 4)
         CALL DPPP_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      I=225
      J=146
      L=3
      DO K= 17, 19
         IF(K.EQ.19) I=I+1
         IF(K.EQ.19) L=L-1
         LLL=L+L+1
         M=I+147
         N=M+234+3-L
         WK1(  2)=           -PHI(I   )        -PHI(J    )*CNF( 1)
         WK1(  3)=           -PHI(I+ 1)        -PHI(J    )*CNF( 2)
         WK1(  4)=           -PHI(I+ L)        -PHI(J    )*CNF( 3)
         WK1(  7)=           -PHI(M   )        -PHI(J+ 45)*CNF( 1)
         WK1(  8)=           -PHI(M+ 1)        -PHI(J+ 45)*CNF( 2)
         WK1(  9)=           -PHI(M+ L)        -PHI(J+ 45)*CNF( 3)
         WK1( 10)=-PHI(N    )-PHI(M   )*CNF( 1)-PHI(J- 24)*CNF( 4)
         WK1( 11)=-PHI(N+  1)-PHI(M+ 1)*CNF( 1)
         WK1( 12)=-PHI(N+  2)-PHI(M+ 1)*CNF( 2)-PHI(J- 24)*CNF( 4)
         WK1( 13)=-PHI(N+1+L)-PHI(M+ L)*CNF( 1)
         WK1( 14)=-PHI(N+2+L)-PHI(M+ L)*CNF( 2)
         WK1( 15)=-PHI(N+LLL)-PHI(M+ L)*CNF( 3)-PHI(J- 24)*CNF( 4)
         CALL DPPP_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      I=515
      J=288
      L=4
      DO K= 20, 25
         IF(K.EQ.23 .OR. K.EQ.25) I=I+1
         IF(K.EQ.23 .OR. K.EQ.25) L=L-1
         LLL=L+L+1
         M=I+195
         N=M+254+4-L
         WK1(  2)=            PHI(I   )        +PHI(J    )*CNF( 1)
         WK1(  3)=            PHI(I+ 1)        +PHI(J    )*CNF( 2)
         WK1(  4)=            PHI(I+ L)        +PHI(J    )*CNF( 3)
         WK1(  7)=            PHI(M   )        +PHI(J+140)*CNF( 1)
         WK1(  8)=            PHI(M+ 1)        +PHI(J+140)*CNF( 2)
         WK1(  9)=            PHI(M+ L)        +PHI(J+140)*CNF( 3)
         WK1( 10)= PHI(N    )+PHI(M   )*CNF( 1)+PHI(J- 42)*CNF( 4)
         WK1( 11)= PHI(N+  1)+PHI(M+ 1)*CNF( 1)
         WK1( 12)= PHI(N+  2)+PHI(M+ 1)*CNF( 2)+PHI(J- 42)*CNF( 4)
         WK1( 13)= PHI(N+1+L)+PHI(M+ L)*CNF( 1)
         WK1( 14)= PHI(N+2+L)+PHI(M+ L)*CNF( 2)
         WK1( 15)= PHI(N+LLL)+PHI(M+ L)*CNF( 3)+PHI(J- 42)*CNF( 4)
         CALL DPPP_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      I=832
      J=554
      L=5
      DO K= 26, 35
         IF(K.EQ.30 .OR. K.EQ.33 .OR. K.EQ.35) I=I+1
         IF(K.EQ.30 .OR. K.EQ.33 .OR. K.EQ.35) L=L-1
         LLL=L+L+1
         M=I+198
         N=M+130+5-L
         WK1(  2)=           -PHI(I   )        -PHI(J    )*CNF( 1)
         WK1(  3)=           -PHI(I+ 1)        -PHI(J    )*CNF( 2)
         WK1(  4)=           -PHI(I+ L)        -PHI(J    )*CNF( 3)
         WK1(  7)=           -PHI(M   )        -PHI(J+195)*CNF( 1)
         WK1(  8)=           -PHI(M+ 1)        -PHI(J+195)*CNF( 2)
         WK1(  9)=           -PHI(M+ L)        -PHI(J+195)*CNF( 3)
         WK1( 10)=-PHI(N    )-PHI(M   )*CNF( 1)-PHI(J- 52)*CNF( 4)
         WK1( 11)=-PHI(N+  1)-PHI(M+ 1)*CNF( 1)
         WK1( 12)=-PHI(N+  2)-PHI(M+ 1)*CNF( 2)-PHI(J- 52)*CNF( 4)
         WK1( 13)=-PHI(N+1+L)-PHI(M+ L)*CNF( 1)
         WK1( 14)=-PHI(N+2+L)-PHI(M+ L)*CNF( 2)
         WK1( 15)=-PHI(N+LLL)-PHI(M+ L)*CNF( 3)-PHI(J- 52)*CNF( 4)
         CALL DPPP_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      CNF(1)= XD-XC
      CNF(2)= YD-YC
      CNF(3)= ZD-ZC
      DO I=1,9
         CALL DPWRKT(I,WK2,LENW,CNF)
         CALL DPWRKM(I,WK2,LENW,CNF)
         CALL DPWRKB(I,WK2,LENW,CNF)
      END DO
C
      RETURN
      END
C*MODULE INT2D   *DECK DPPP_BCTE
C>
C>    @brief   ERIC dppp backtransfer
C>
C>    @details ERIC [dp|pp] backtransfer step
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DPPP_BCTE(WK1,WK2,LENW,CNF,JR)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    LENW,I,J,JR
      DIMENSION  WK1(*),WK2(LENW,*),CNF(*)
C
      WK1(10)= WK1(10)+WK1( 7)*CNF( 1)
      WK1(11)= WK1(11)+WK1( 7)*CNF( 2)
      WK1(12)= WK1(12)+WK1( 8)*CNF( 2)
      WK1(13)= WK1(13)+WK1( 7)*CNF( 3)
      WK1(14)= WK1(14)+WK1( 8)*CNF( 3)
      WK1(15)= WK1(15)+WK1( 9)*CNF( 3)
C
      WK1(16)= WK1(10)-WK1( 2)*CNF( 1)
      WK1(17)= WK1(11)-WK1( 3)*CNF( 1)
      WK1(18)= WK1(13)-WK1( 4)*CNF( 1)
      WK1(19)= WK1(11)-WK1( 2)*CNF( 2)
      WK1(20)= WK1(12)-WK1( 3)*CNF( 2)
      WK1(21)= WK1(14)-WK1( 4)*CNF( 2)
      WK1(22)= WK1(13)-WK1( 2)*CNF( 3)
      WK1(23)= WK1(14)-WK1( 3)*CNF( 3)
      WK1(24)= WK1(15)-WK1( 4)*CNF( 3)
      J= 15
      DO I=1,9
         J=J+1
         WK2(JR,I)= WK1(J)
      END DO
C
      RETURN
      END
C  LPHI= 928
C  LWK1=  11
C  LWK2= 318
C  LENW=  53
C*MODULE INT2D   *DECK DPDS
C>
C>    @brief   ERIC dpds case
C>
C>    @details ERIC [dp|ds] integral quartet
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DPDS (IPRIM,JPRIM,KPRIM,LPRIM,IEQJ,KEQL,
     *                 XA,YA,ZA,XB,YB,ZB,XC,YC,ZC,XD,YD,ZD,
     *                 PHI,WK1,WK2,LENW)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      LOGICAL    IEQJ,KEQL
      DIMENSION  PHI(*),WK1(*),WK2(LENW,*)
C
      PARAMETER (MXGSH=30, MXG2= MXGSH*MXGSH)
C
      PARAMETER (NTX=4, NPF=450, NGRD=7, NPX=1000, MXQT=16)
      COMMON /FMTTBL/ FGRID(0:NTX,0:NPF,0:NGRD),XGRID(0:NTX,0:NPX)
     *,               TMAX,RFINC(0:NGRD),RXINC
     *,               RMR(MXQT),TLGM(0:MXQT),NORD
      COMMON /ERIPRM/ EXI(MXGSH),EXJ(MXGSH),EXK(MXGSH),EXL(MXGSH),
     *                CCI(MXGSH),CCJ(MXGSH),CCK(MXGSH),CCL(MXGSH),
     *                XAB(MXG2),YAB(MXG2),ZAB(MXG2),
     *                XCD(MXG2),YCD(MXG2),ZCD(MXG2),
     *                CCBRA(MXG2),CCKET(MXG2),RXB(MXG2),
     *                SLBRA(MXG2),SLKET(MXG2),RXK(MXG2)
      LOGICAL         LCFLAG,LRINT
      COMMON /NLRC  / LCFLAG,EMU,EMU2,LRFILE
      COMMON /NLRCF / LRINT
      COMMON /SHLNOS/ QQ4,IDUMMY(20)
C
      DIMENSION  FT(0:16),SFAC( 9),CNF(11)
C
      PARAMETER (NL= 22, NK= 19, NJ= 11, NI=  6)
      DIMENSION  LSF(NL),KSF(NK),JSF(NJ),ISF(NI)
      DIMENSION  LJI(NL),KJI(NK),JJI(NJ),IJI(NI)
      DIMENSION  L0I(NL),K0I(NK),J0I(NJ),I0I(NI)
      DIMENSION  L0F(NL),K0F(NK),J0F(NJ),I0F(NI)
C
      PARAMETER (ZER=0.0D+00, ONE=1.0D+00, TWO=2.0D+00)
      PARAMETER (CCTOL=1.0D-13)
      DATA CNF/0.0D+00,0.0D+00,0.0D+00,1.0D+00,2.0D+00,3.0D+00,
     &         4.0D+00,5.0D+00,6.0D+00,7.0D+00,8.0D+00/
      SAVE CNF
C
      DATA LSF/  1,  2,  1,  2,  3,  4,  1,  2,  3,  1,
     *           2,  1,  1,  2,  3,  1,  2,  1,  1,  2,  1,  1/
      DATA LJI/179,193,221,235,235,256,277,277,298,319,
     *         333,373,425,425,464,503,529,568,638,682,748,860/
      DATA L0I/186,200,228,242,249,263,284,291,305,326,
     *         340,386,438,451,477,516,542,581,660,704,770,894/
      DATA L0F/192,206,234,248,255,269,290,297,311,332,
     *         346,398,450,463,489,528,554,593,681,725,791,927/
C
      DATA KSF/  3,  4,  2,  3,  4,  3,  4,  3,  4,  4,
     *           3,  4,  3,  4,  4,  3,  4,  4,  4/
      DATA KJI/172,172,214,214,214,270,270,312,312,360,
     *         412,412,490,490,555,616,616,726,826/
      DATA K0I/179,193,221,235,256,277,298,319,333,373,
     *         425,464,503,529,568,638,682,748,860/
      DATA K0F/185,199,227,241,262,283,304,325,339,385,
     *         437,476,515,541,580,659,703,769,893/
C
      DATA JSF/  1,  1,  2,  3,  1,  1,  2,  3,  1,  2,  1/
      DATA JJI/165,207,207,207,347,399,399,399,594,594,792/
      DATA J0I/172,214,270,312,360,412,490,555,616,726,826/
      DATA J0F/178,220,276,318,372,424,502,567,637,747,859/
C
      DATA ISF/  2,  3,  2,  3,  3,  3/
      DATA IJI/  5,  5, 12, 12, 25, 47/
      DATA I0I/165,207,347,399,594,792/
      DATA I0F/171,213,359,411,615,825/
C
      SFAC(1)= ONE
      PHI( 84)= ZER
      PHI( 86)= ZER
      PHI( 87)= ZER
      PHI( 89)= ZER
      PHI( 93)= ZER
      PHI( 95)= ZER
      PHI( 96)= ZER
      PHI( 98)= ZER
      PHI(108)= ZER
      PHI(109)= ZER
      PHI(110)= ZER
      PHI(111)= ZER
      PHI(112)= ZER
      PHI(113)= ZER
      PHI(117)= ZER
      PHI(118)= ZER
      PHI(119)= ZER
      PHI(129)= ZER
      PHI(130)= ZER
      PHI(131)= ZER
      PHI(135)= ZER
      PHI(136)= ZER
      PHI(137)= ZER
      PHI(138)= ZER
      PHI(139)= ZER
      PHI(140)= ZER
      PHI(144)= ZER
      PHI(145)= ZER
      PHI(146)= ZER
      PHI(153)= ZER
      PHI(154)= ZER
      PHI(155)= ZER
      PHI(156)= ZER
      PHI(157)= ZER
      PHI(158)= ZER
      PHI(162)= ZER
      PHI(163)= ZER
      PHI(164)= ZER
      DO N= 1,NL
         DO I=L0I(N),L0F(N)
            PHI(I)= ZER
         END DO
      END DO
      KL=0
      DO LL=1,LPRIM
         X04= EXL(LL)
         PHI( 83)= ZER
         PHI( 85)= ZER
         PHI( 88)= ZER
         PHI( 92)= ZER
         PHI( 94)= ZER
         PHI( 97)= ZER
         PHI(105)= ZER
         PHI(106)= ZER
         PHI(107)= ZER
         PHI(114)= ZER
         PHI(115)= ZER
         PHI(116)= ZER
         PHI(126)= ZER
         PHI(127)= ZER
         PHI(128)= ZER
         PHI(132)= ZER
         PHI(133)= ZER
         PHI(134)= ZER
         PHI(141)= ZER
         PHI(142)= ZER
         PHI(143)= ZER
         PHI(150)= ZER
         PHI(151)= ZER
         PHI(152)= ZER
         PHI(159)= ZER
         PHI(160)= ZER
         PHI(161)= ZER
         DO N= 1,NK
            DO I=K0I(N),K0F(N)
               PHI(I)= ZER
            END DO
         END DO
         KTOP= KPRIM
         IF(KEQL) KTOP= LL
         DO KK=1,KTOP
            KL= KL+1
            CFK= CCKET(KL)
            IF(ABS(CFK).GT.CCTOL) THEN
               CFK= CFK*QQ4
               X03= EXK(KK)
               X34= X03+X04
               XKL= XCD(KL)
               YKL= YCD(KL)
               ZKL= ZCD(KL)
               PHI( 82)= ZER
               PHI( 91)= ZER
               PHI(102)= ZER
               PHI(103)= ZER
               PHI(104)= ZER
               PHI(123)= ZER
               PHI(124)= ZER
               PHI(125)= ZER
               PHI(147)= ZER
               PHI(148)= ZER
               PHI(149)= ZER
               DO N= 1,NJ
                  DO I=J0I(N),J0F(N)
                     PHI(I)= ZER
                  END DO
               END DO
               IJ=0
               DO JJ=1,JPRIM
                  X02= EXJ(JJ)
                  PHI( 81)= ZER
                  PHI( 90)= ZER
                  PHI( 99)= ZER
                  PHI(100)= ZER
                  PHI(101)= ZER
                  PHI(120)= ZER
                  PHI(121)= ZER
                  PHI(122)= ZER
                  DO N= 1,NI
                     DO I=I0I(N),I0F(N)
                        PHI(I)= ZER
                     END DO
                  END DO
                  ITOP= IPRIM
                  IF(IEQJ) ITOP= JJ
                  DO II=1,ITOP
                     IJ= IJ+1
                     CFB= CCBRA(IJ)
                     IF(ABS(CFB).GT.CCTOL) THEN
                        X01= EXI(II)
                        X12= X01+X02
                        X41= ONE/(X12+X34)
                        FTZ= CFB*CFK
                        RX = XKL-XAB(IJ)
                        RY = YKL-YAB(IJ)
                        RZ = ZKL-ZAB(IJ)
                        RSQ= RX*RX+RY*RY+RZ*RZ
                        RHO= X12*X34*X41
                        IF(LRINT) THEN
                           EFR= EMU2/(EMU2+RHO)
                           RHO= RHO*EFR
                        ENDIF
                        TT = RSQ*RHO
                        N=5
                        IF(TT.LE.TMAX) THEN
C
C     FM(T) EVALUATION
C
                           TV= TT*RFINC(N)
                           IP= NINT(TV)
                           FX=    FGRID(4,IP,N) *TV
                           FX=(FX+FGRID(3,IP,N))*TV
                           FX=(FX+FGRID(2,IP,N))*TV
                           FX=(FX+FGRID(1,IP,N))*TV
                           FX= FX+FGRID(0,IP,N)
                           TV= TT*RXINC
                           IP= NINT(TV)
                           ET=    XGRID(4,IP) *TV
                           ET=(ET+XGRID(3,IP))*TV
                           ET=(ET+XGRID(2,IP))*TV
                           ET=(ET+XGRID(1,IP))*TV
                           ET= ET+XGRID(0,IP)
C
                           FT(8)= FX
                           T2= TT+TT
                           DO M=8,1,-1
                              FT(M-1)=(T2*FT(M)+ET)*RMR(M)
                           END DO
C
                           RHO= RHO+RHO
                           IF(LRINT) FTZ= FTZ*SQRT(EFR)
                           FTF= FTZ*SQRT(X41)
                           DO 210 M=0,N
                              FT(M)= FT(M)*FTF
  210                      FTF= FTF*RHO
                        ELSE
                           XIN= ONE/RSQ
                           FTF= FTZ*SQRT(XIN)*SLBRA(IJ)*SLKET(KL)
                           FT(0)= FTF
                           DO 220 M=1,N
                              FTF= FTF*XIN
  220                      FT(M)= TLGM(M)*FTF
                        END IF
C
                        CALL PHIFTS(6,RX,RY,RZ,PHI,FT)
C
                        FAC= RXB(IJ)
                        SFAC(2)= FAC
                        SFAC(3)= SFAC(2)*FAC
                        PHI( 81)= PHI( 81)+PHI(  1)*SFAC(2)
                        PHI( 90)= PHI( 90)+PHI(  1)*SFAC(3)
C
                        PHI( 99)= PHI( 99)+PHI(  2)*SFAC(2)
                        PHI(100)= PHI(100)+PHI(  3)*SFAC(2)
                        PHI(101)= PHI(101)+PHI(  4)*SFAC(2)
                        PHI(120)= PHI(120)+PHI(  2)*SFAC(3)
                        PHI(121)= PHI(121)+PHI(  3)*SFAC(3)
                        PHI(122)= PHI(122)+PHI(  4)*SFAC(3)
                        DO N= 1,NI
                           FAC= SFAC(ISF(N))
                           J=IJI(N)
                           DO I=I0I(N),I0F(N)
                              PHI(I)= PHI(I)+PHI(J)*FAC
                              J=J+1
                           END DO
                        END DO
                     END IF
                  END DO
                  FAC= EXJ(JJ)*TWO
                  SFAC(2)= FAC
                  SFAC(3)= SFAC(2)*FAC
                  PHI( 82)= PHI( 82)+PHI( 81)
                  PHI( 91)= PHI( 91)+PHI( 90)*SFAC(3)
C
                  PHI(102)= PHI(102)+PHI( 99)
                  PHI(103)= PHI(103)+PHI(100)
                  PHI(104)= PHI(104)+PHI(101)
                  PHI(123)= PHI(123)+PHI(120)*SFAC(2)
                  PHI(124)= PHI(124)+PHI(121)*SFAC(2)
                  PHI(125)= PHI(125)+PHI(122)*SFAC(2)
                  PHI(147)= PHI(147)+PHI(120)*SFAC(3)
                  PHI(148)= PHI(148)+PHI(121)*SFAC(3)
                  PHI(149)= PHI(149)+PHI(122)*SFAC(3)
                  DO N= 1,NJ
                     FAC= SFAC(JSF(N))
                     J=JJI(N)
                     IF(FAC.EQ.ONE) THEN
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)
                           J=J+1
                        END DO
                     ELSE
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)*FAC
                           J=J+1
                        END DO
                     END IF
                  END DO
               END DO
               FAC= RXK(KL)
               SFAC(2)= FAC
               SFAC(3)= SFAC(2)*FAC
               SFAC(4)= SFAC(3)*FAC
               PHI( 83)= PHI( 83)+PHI( 82)*SFAC(2)
               PHI( 85)= PHI( 85)+PHI( 82)*SFAC(3)
               PHI( 88)= PHI( 88)+PHI( 82)*SFAC(4)
               PHI( 92)= PHI( 92)+PHI( 91)*SFAC(2)
               PHI( 94)= PHI( 94)+PHI( 91)*SFAC(3)
               PHI( 97)= PHI( 97)+PHI( 91)*SFAC(4)
C
               PHI(105)= PHI(105)+PHI(102)*SFAC(3)
               PHI(106)= PHI(106)+PHI(103)*SFAC(3)
               PHI(107)= PHI(107)+PHI(104)*SFAC(3)
               PHI(114)= PHI(114)+PHI(102)*SFAC(4)
               PHI(115)= PHI(115)+PHI(103)*SFAC(4)
               PHI(116)= PHI(116)+PHI(104)*SFAC(4)
               PHI(126)= PHI(126)+PHI(123)*SFAC(2)
               PHI(127)= PHI(127)+PHI(124)*SFAC(2)
               PHI(128)= PHI(128)+PHI(125)*SFAC(2)
               PHI(132)= PHI(132)+PHI(123)*SFAC(3)
               PHI(133)= PHI(133)+PHI(124)*SFAC(3)
               PHI(134)= PHI(134)+PHI(125)*SFAC(3)
               PHI(141)= PHI(141)+PHI(123)*SFAC(4)
               PHI(142)= PHI(142)+PHI(124)*SFAC(4)
               PHI(143)= PHI(143)+PHI(125)*SFAC(4)
               PHI(150)= PHI(150)+PHI(147)*SFAC(3)
               PHI(151)= PHI(151)+PHI(148)*SFAC(3)
               PHI(152)= PHI(152)+PHI(149)*SFAC(3)
               PHI(159)= PHI(159)+PHI(147)*SFAC(4)
               PHI(160)= PHI(160)+PHI(148)*SFAC(4)
               PHI(161)= PHI(161)+PHI(149)*SFAC(4)
               DO N= 1,NK
                  FAC= SFAC(KSF(N))
                  J=KJI(N)
                  DO I=K0I(N),K0F(N)
                     PHI(I)= PHI(I)+PHI(J)*FAC
                     J=J+1
                  END DO
               END DO
            END IF
         END DO
         FAC= EXL(LL)*TWO
         SFAC(2)= FAC
         SFAC(3)= SFAC(2)*FAC
         SFAC(4)= SFAC(3)*FAC
         PHI( 84)= PHI( 84)+PHI( 83)
         PHI( 86)= PHI( 86)+PHI( 85)*SFAC(2)
         PHI( 87)= PHI( 87)+PHI( 85)*SFAC(3)
         PHI( 89)= PHI( 89)+PHI( 88)*SFAC(4)
         PHI( 93)= PHI( 93)+PHI( 92)
         PHI( 95)= PHI( 95)+PHI( 94)*SFAC(2)
         PHI( 96)= PHI( 96)+PHI( 94)*SFAC(3)
         PHI( 98)= PHI( 98)+PHI( 97)*SFAC(4)
C
         PHI(108)= PHI(108)+PHI(105)
         PHI(109)= PHI(109)+PHI(106)
         PHI(110)= PHI(110)+PHI(107)
         PHI(111)= PHI(111)+PHI(105)*SFAC(2)
         PHI(112)= PHI(112)+PHI(106)*SFAC(2)
         PHI(113)= PHI(113)+PHI(107)*SFAC(2)
         PHI(117)= PHI(117)+PHI(114)*SFAC(3)
         PHI(118)= PHI(118)+PHI(115)*SFAC(3)
         PHI(119)= PHI(119)+PHI(116)*SFAC(3)
         PHI(129)= PHI(129)+PHI(126)
         PHI(130)= PHI(130)+PHI(127)
         PHI(131)= PHI(131)+PHI(128)
         PHI(135)= PHI(135)+PHI(132)*SFAC(2)
         PHI(136)= PHI(136)+PHI(133)*SFAC(2)
         PHI(137)= PHI(137)+PHI(134)*SFAC(2)
         PHI(138)= PHI(138)+PHI(132)*SFAC(3)
         PHI(139)= PHI(139)+PHI(133)*SFAC(3)
         PHI(140)= PHI(140)+PHI(134)*SFAC(3)
         PHI(144)= PHI(144)+PHI(141)*SFAC(4)
         PHI(145)= PHI(145)+PHI(142)*SFAC(4)
         PHI(146)= PHI(146)+PHI(143)*SFAC(4)
         PHI(153)= PHI(153)+PHI(150)
         PHI(154)= PHI(154)+PHI(151)
         PHI(155)= PHI(155)+PHI(152)
         PHI(156)= PHI(156)+PHI(150)*SFAC(2)
         PHI(157)= PHI(157)+PHI(151)*SFAC(2)
         PHI(158)= PHI(158)+PHI(152)*SFAC(2)
         PHI(162)= PHI(162)+PHI(159)*SFAC(3)
         PHI(163)= PHI(163)+PHI(160)*SFAC(3)
         PHI(164)= PHI(164)+PHI(161)*SFAC(3)
         DO N= 1,NL
            FAC= SFAC(LSF(N))
            J=LJI(N)
            IF(FAC.EQ.ONE) THEN
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)
                  J=J+1
               END DO
            ELSE
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)*FAC
                  J=J+1
               END DO
            END IF
         END DO
      END DO
C  POST-CONTRACTION PHASE
      PHI(187)= PHI(187)-PHI(186)
      PHI(189)= PHI(189)-PHI(186)
      PHI(192)= PHI(192)-PHI(186)
      PHI(201)= PHI(201)-PHI(200)
      PHI(203)= PHI(203)-PHI(200)
      PHI(206)= PHI(206)-PHI(200)
      PHI(229)= PHI(229)-PHI(228)
      PHI(231)= PHI(231)-PHI(228)
      PHI(234)= PHI(234)-PHI(228)
      PHI(243)= PHI(243)-PHI(242)
      PHI(245)= PHI(245)-PHI(242)
      PHI(248)= PHI(248)-PHI(242)
      PHI(250)= PHI(250)-PHI(249)
      PHI(252)= PHI(252)-PHI(249)
      PHI(255)= PHI(255)-PHI(249)
      PHI(264)= PHI(264)-PHI(263)
      PHI(266)= PHI(266)-PHI(263)
      PHI(269)= PHI(269)-PHI(263)
      PHI(285)= PHI(285)-PHI(284)
      PHI(287)= PHI(287)-PHI(284)
      PHI(290)= PHI(290)-PHI(284)
      PHI(292)= PHI(292)-PHI(291)
      PHI(294)= PHI(294)-PHI(291)
      PHI(297)= PHI(297)-PHI(291)
      PHI(306)= PHI(306)-PHI(305)
      PHI(308)= PHI(308)-PHI(305)
      PHI(311)= PHI(311)-PHI(305)
      PHI(327)= PHI(327)-PHI(326)
      PHI(329)= PHI(329)-PHI(326)
      PHI(332)= PHI(332)-PHI(326)
      PHI(341)= PHI(341)-PHI(340)
      PHI(343)= PHI(343)-PHI(340)
      PHI(346)= PHI(346)-PHI(340)
      III=346+ 30
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*4
      CALL PHIIJ3(III,PHI)
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
      III=III+ 13*3
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
      III=III+ 13*3
      CALL PHIIJ3(III,PHI)
C
      III=III+ 61
      III=III+ 22
      CALL PHIIJ4(III,PHI)
      III=III+ 22*2
      CALL PHIIJ4(III,PHI)
      III=III+ 22*3
      CALL PHIIJ4(III,PHI)
C
      III=III+130
      CALL PHIIJ5(III,PHI)
C
      CNF(1)= XB-XA
      CNF(2)= YB-YA
      CNF(3)= ZB-ZA
      WK1(  3)=          PHI(138)        +PHI( 96)*CNF( 1)
      WK1(  4)=          PHI(139)        +PHI( 96)*CNF( 2)
      WK1(  5)=          PHI(140)        +PHI( 96)*CNF( 3)
      WK1(  6)= PHI(250)+PHI(138)*CNF( 1)+PHI( 87)*CNF( 4)
      WK1(  7)= PHI(251)+PHI(139)*CNF( 1)
      WK1(  8)= PHI(252)+PHI(139)*CNF( 2)+PHI( 87)*CNF( 4)
      WK1(  9)= PHI(253)+PHI(140)*CNF( 1)
      WK1( 10)= PHI(254)+PHI(140)*CNF( 2)
      WK1( 11)= PHI(255)+PHI(140)*CNF( 3)+PHI( 87)*CNF( 4)
      CALL DPDS_BCTE(WK1,WK2,LENW,CNF, 1)
      WK1(  3)=          PHI(129)        +PHI( 93)*CNF( 1)
      WK1(  4)=          PHI(130)        +PHI( 93)*CNF( 2)
      WK1(  5)=          PHI(131)        +PHI( 93)*CNF( 3)
      WK1(  6)= PHI(229)+PHI(129)*CNF( 1)+PHI( 84)*CNF( 4)
      WK1(  7)= PHI(230)+PHI(130)*CNF( 1)
      WK1(  8)= PHI(231)+PHI(130)*CNF( 2)+PHI( 84)*CNF( 4)
      WK1(  9)= PHI(232)+PHI(131)*CNF( 1)
      WK1( 10)= PHI(233)+PHI(131)*CNF( 2)
      WK1( 11)= PHI(234)+PHI(131)*CNF( 3)+PHI( 84)*CNF( 4)
      CALL DPDS_BCTE(WK1,WK2,LENW,CNF, 2)
      I=292
      J=156
      L=3
      DO K=  3,  5
         IF(K.EQ. 5) I=I+1
         IF(K.EQ. 5) L=L-1
         LLL=L+L+1
         M=I+162+3-L
         WK1(  3)=           -PHI(I   )        -PHI(J   )*CNF( 1)
         WK1(  4)=           -PHI(I+ 1)        -PHI(J   )*CNF( 2)
         WK1(  5)=           -PHI(I+ L)        -PHI(J   )*CNF( 3)
         WK1(  6)=-PHI(M    )-PHI(I   )*CNF( 1)-PHI(J-45)*CNF( 4)
         WK1(  7)=-PHI(M+  1)-PHI(I+ 1)*CNF( 1)
         WK1(  8)=-PHI(M+  2)-PHI(I+ 1)*CNF( 2)-PHI(J-45)*CNF( 4)
         WK1(  9)=-PHI(M+1+L)-PHI(I+ L)*CNF( 1)
         WK1( 10)=-PHI(M+2+L)-PHI(I+ L)*CNF( 2)
         WK1( 11)=-PHI(M+LLL)-PHI(I+ L)*CNF( 3)-PHI(J-45)*CNF( 4)
         CALL DPDS_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      I=519
      J=327
      L=4
      DO K=  6, 11
         IF(K.EQ. 9 .OR. K.EQ.11) I=I+1
         IF(K.EQ. 9 .OR. K.EQ.11) L=L-1
         LLL=L+L+1
         M=I+148+4-L
         WK1(  3)=            PHI(I   )        +PHI(J    )*CNF( 1)
         WK1(  4)=            PHI(I+ 1)        +PHI(J    )*CNF( 2)
         WK1(  5)=            PHI(I+ L)        +PHI(J    )*CNF( 3)
         WK1(  6)= PHI(M    )+PHI(I   )*CNF( 1)+PHI(J-140)*CNF( 4)
         WK1(  7)= PHI(M+  1)+PHI(I+ 1)*CNF( 1)
         WK1(  8)= PHI(M+  2)+PHI(I+ 1)*CNF( 2)+PHI(J-140)*CNF( 4)
         WK1(  9)= PHI(M+1+L)+PHI(I+ L)*CNF( 1)
         WK1( 10)= PHI(M+2+L)+PHI(I+ L)*CNF( 2)
         WK1( 11)= PHI(M+LLL)+PHI(I+ L)*CNF( 3)+PHI(J-140)*CNF( 4)
         CALL DPDS_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      WK1(  3)=          PHI(144)        +PHI( 98)*CNF( 1)
      WK1(  4)=          PHI(145)        +PHI( 98)*CNF( 2)
      WK1(  5)=          PHI(146)        +PHI( 98)*CNF( 3)
      WK1(  6)= PHI(264)+PHI(144)*CNF( 1)+PHI( 89)*CNF( 4)
      WK1(  7)= PHI(265)+PHI(145)*CNF( 1)
      WK1(  8)= PHI(266)+PHI(145)*CNF( 2)+PHI( 89)*CNF( 4)
      WK1(  9)= PHI(267)+PHI(146)*CNF( 1)
      WK1( 10)= PHI(268)+PHI(146)*CNF( 2)
      WK1( 11)= PHI(269)+PHI(146)*CNF( 3)+PHI( 89)*CNF( 4)
      CALL DPDS_BCTE(WK1,WK2,LENW,CNF,12)
      WK1(  3)=          PHI(135)        +PHI( 95)*CNF( 1)
      WK1(  4)=          PHI(136)        +PHI( 95)*CNF( 2)
      WK1(  5)=          PHI(137)        +PHI( 95)*CNF( 3)
      WK1(  6)= PHI(243)+PHI(135)*CNF( 1)+PHI( 86)*CNF( 4)
      WK1(  7)= PHI(244)+PHI(136)*CNF( 1)
      WK1(  8)= PHI(245)+PHI(136)*CNF( 2)+PHI( 86)*CNF( 4)
      WK1(  9)= PHI(246)+PHI(137)*CNF( 1)
      WK1( 10)= PHI(247)+PHI(137)*CNF( 2)
      WK1( 11)= PHI(248)+PHI(137)*CNF( 3)+PHI( 86)*CNF( 4)
      CALL DPDS_BCTE(WK1,WK2,LENW,CNF,13)
      I=306
      J=162
      L=3
      DO K= 14, 16
         IF(K.EQ.16) I=I+1
         IF(K.EQ.16) L=L-1
         LLL=L+L+1
         M=I+174+3-L
         WK1(  3)=           -PHI(I   )        -PHI(J    )*CNF( 1)
         WK1(  4)=           -PHI(I+ 1)        -PHI(J    )*CNF( 2)
         WK1(  5)=           -PHI(I+ L)        -PHI(J    )*CNF( 3)
         WK1(  6)=-PHI(M    )-PHI(I   )*CNF( 1)-PHI(J -45)*CNF( 4)
         WK1(  7)=-PHI(M+  1)-PHI(I+ 1)*CNF( 1)
         WK1(  8)=-PHI(M+  2)-PHI(I+ 1)*CNF( 2)-PHI(J -45)*CNF( 4)
         WK1(  9)=-PHI(M+1+L)-PHI(I+ L)*CNF( 1)
         WK1( 10)=-PHI(M+2+L)-PHI(I+ L)*CNF( 2)
         WK1( 11)=-PHI(M+LLL)-PHI(I+ L)*CNF( 3)-PHI(J -45)*CNF( 4)
         CALL DPDS_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      I=285
      J=153
      L=3
      DO K= 17, 19
         IF(K.EQ.19) I=I+1
         IF(K.EQ.19) L=L-1
         LLL=L+L+1
         M=I+156+3-L
         WK1(  3)=           -PHI(I   )        -PHI(J    )*CNF( 1)
         WK1(  4)=           -PHI(I+ 1)        -PHI(J    )*CNF( 2)
         WK1(  5)=           -PHI(I+ L)        -PHI(J    )*CNF( 3)
         WK1(  6)=-PHI(M    )-PHI(I   )*CNF( 1)-PHI(J- 45)*CNF( 4)
         WK1(  7)=-PHI(M+  1)-PHI(I+ 1)*CNF( 1)
         WK1(  8)=-PHI(M+  2)-PHI(I+ 1)*CNF( 2)-PHI(J- 45)*CNF( 4)
         WK1(  9)=-PHI(M+1+L)-PHI(I+ L)*CNF( 1)
         WK1( 10)=-PHI(M+2+L)-PHI(I+ L)*CNF( 2)
         WK1( 11)=-PHI(M+LLL)-PHI(I+ L)*CNF( 3)-PHI(J- 45)*CNF( 4)
         CALL DPDS_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      I=545
      J=341
      L=4
      DO K= 20, 25
         IF(K.EQ.23 .OR. K.EQ.25) I=I+1
         IF(K.EQ.23 .OR. K.EQ.25) L=L-1
         LLL=L+L+1
         M=I+166+4-L
         WK1(  3)=            PHI(I   )        +PHI(J    )*CNF( 1)
         WK1(  4)=            PHI(I+ 1)        +PHI(J    )*CNF( 2)
         WK1(  5)=            PHI(I+ L)        +PHI(J    )*CNF( 3)
         WK1(  6)= PHI(M    )+PHI(I   )*CNF( 1)+PHI(J-140)*CNF( 4)
         WK1(  7)= PHI(M+  1)+PHI(I+ 1)*CNF( 1)
         WK1(  8)= PHI(M+  2)+PHI(I+ 1)*CNF( 2)+PHI(J-140)*CNF( 4)
         WK1(  9)= PHI(M+1+L)+PHI(I+ L)*CNF( 1)
         WK1( 10)= PHI(M+2+L)+PHI(I+ L)*CNF( 2)
         WK1( 11)= PHI(M+LLL)+PHI(I+ L)*CNF( 3)+PHI(J-140)*CNF( 4)
         CALL DPDS_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      I=777
      J=584
      L=5
      DO K= 26, 35
         IF(K.EQ.30 .OR. K.EQ.33 .OR. K.EQ.35) I=I+1
         IF(K.EQ.30 .OR. K.EQ.33 .OR. K.EQ.35) L=L-1
         LLL=L+L+1
         M=I+130+5-L
         WK1(  3)=           -PHI(I   )        -PHI(J    )*CNF( 1)
         WK1(  4)=           -PHI(I+ 1)        -PHI(J    )*CNF( 2)
         WK1(  5)=           -PHI(I+ L)        -PHI(J    )*CNF( 3)
         WK1(  6)=-PHI(M    )-PHI(I   )*CNF( 1)-PHI(J-195)*CNF( 4)
         WK1(  7)=-PHI(M+  1)-PHI(I+ 1)*CNF( 1)
         WK1(  8)=-PHI(M+  2)-PHI(I+ 1)*CNF( 2)-PHI(J-195)*CNF( 4)
         WK1(  9)=-PHI(M+1+L)-PHI(I+ L)*CNF( 1)
         WK1( 10)=-PHI(M+2+L)-PHI(I+ L)*CNF( 2)
         WK1( 11)=-PHI(M+LLL)-PHI(I+ L)*CNF( 3)-PHI(J-195)*CNF( 4)
         CALL DPDS_BCTE(WK1,WK2,LENW,CNF, K)
         I=I+1
         J=J+1
      END DO
      CNF(1)= XD-XC
      CNF(2)= YD-YC
      CNF(3)= ZD-ZC
      DO I=1,6
         CALL DPWRKT(I,WK2,LENW,CNF)
         CALL DPWRKM(I,WK2,LENW,CNF)
         CALL DPWRKB(I,WK2,LENW,CNF)
      END DO
C
      RETURN
      END
C*MODULE INT2D   *DECK DPDS_BCTE
C>
C>    @brief   ERIC dpds backtransfer
C>
C>    @details ERIC [dp|ds] backtransfer step
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DPDS_BCTE(WK1,WK2,LENW,CNF,JR)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    LENW,I,J,JR
      DIMENSION  WK1(*),WK2(LENW,*),CNF(*)
C
      WK1( 6)= WK1( 6)+WK1( 3)*CNF( 1)
      WK1( 7)= WK1( 7)+WK1( 3)*CNF( 2)
      WK1( 8)= WK1( 8)+WK1( 4)*CNF( 2)
      WK1( 9)= WK1( 9)+WK1( 3)*CNF( 3)
      WK1(10)= WK1(10)+WK1( 4)*CNF( 3)
      WK1(11)= WK1(11)+WK1( 5)*CNF( 3)
      J=  5
      DO I=1,6
         J=J+1
         WK2(JR,I)= WK1(J)
      END DO
C
      RETURN
      END
C*MODULE INT2D   *DECK DPWRKT
C>
C>    @brief   ERIC dp utility (1)
C>
C>    @details common expressions for dp products in ERIC (1)
C>
C>    @author  Jose Sierra, 2013
C>
      SUBROUTINE DPWRKT(I,WK2,LENW,CNF)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    I,LENW
      DIMENSION  WK2(LENW,*),CNF(*)
C
         WK2(  6,I)= WK2(  6,I)+WK2(  3,I)*CNF( 1)+WK2(  2,I)*CNF( 4)
         WK2(  7,I)= WK2(  7,I)+WK2(  4,I)*CNF( 1)
         WK2(  8,I)= WK2(  8,I)+WK2(  4,I)*CNF( 2)+WK2(  2,I)*CNF( 4)
         WK2(  9,I)= WK2(  9,I)+WK2(  5,I)*CNF( 1)
         WK2( 10,I)= WK2( 10,I)+WK2(  5,I)*CNF( 2)
         WK2( 11,I)= WK2( 11,I)+WK2(  5,I)*CNF( 3)+WK2(  2,I)*CNF( 4)
C
         WK2(  3,I)= WK2(  3,I)+WK2(  1,I)*CNF( 1)
         WK2(  4,I)= WK2(  4,I)+WK2(  1,I)*CNF( 2)
         WK2(  5,I)= WK2(  5,I)+WK2(  1,I)*CNF( 3)
C
         WK2( 26,I)= WK2( 26,I)+WK2( 20,I)*CNF( 1)+WK2( 17,I)*CNF( 5)
         WK2( 27,I)= WK2( 27,I)+WK2( 21,I)*CNF( 1)+WK2( 18,I)*CNF( 4)
         WK2( 28,I)= WK2( 28,I)+WK2( 22,I)*CNF( 1)
         WK2( 29,I)= WK2( 29,I)+WK2( 22,I)*CNF( 2)+WK2( 18,I)*CNF( 5)
         WK2( 30,I)= WK2( 30,I)+WK2( 23,I)*CNF( 1)+WK2( 19,I)*CNF( 4)
         WK2( 31,I)= WK2( 31,I)+WK2( 24,I)*CNF( 1)
         WK2( 32,I)= WK2( 32,I)+WK2( 24,I)*CNF( 2)+WK2( 19,I)*CNF( 4)
         WK2( 33,I)= WK2( 33,I)+WK2( 25,I)*CNF( 1)
         WK2( 34,I)= WK2( 34,I)+WK2( 25,I)*CNF( 2)
         WK2( 35,I)= WK2( 35,I)+WK2( 25,I)*CNF( 3)+WK2( 19,I)*CNF( 5)
C
         WK2( 20,I)= WK2( 20,I)+WK2( 14,I)*CNF( 1)+WK2( 13,I)*CNF( 4)
         WK2( 21,I)= WK2( 21,I)+WK2( 15,I)*CNF( 1)
         WK2( 22,I)= WK2( 22,I)+WK2( 15,I)*CNF( 2)+WK2( 13,I)*CNF( 4)
         WK2( 23,I)= WK2( 23,I)+WK2( 16,I)*CNF( 1)
         WK2( 24,I)= WK2( 24,I)+WK2( 16,I)*CNF( 2)
         WK2( 25,I)= WK2( 25,I)+WK2( 16,I)*CNF( 3)+WK2( 13,I)*CNF( 4)
C
         WK2( 14,I)= WK2( 14,I)+WK2( 12,I)*CNF( 1)
         WK2( 15,I)= WK2( 15,I)+WK2( 12,I)*CNF( 2)
         WK2( 16,I)= WK2( 16,I)+WK2( 12,I)*CNF( 3)
         WK2( 17,I)= WK2( 17,I)+WK2( 13,I)*CNF( 1)
         WK2( 18,I)= WK2( 18,I)+WK2( 13,I)*CNF( 2)
         WK2( 19,I)= WK2( 19,I)+WK2( 13,I)*CNF( 3)
C
      RETURN
      END
C*MODULE INT2D   *DECK DPWRKM
C>
C>    @brief   ERIC dp utility (2)
C>
C>    @details common expressions for dp products in ERIC (2)
C>
C>    @author  Jose Sierra, 2013
C>
      SUBROUTINE DPWRKM(I,WK2,LENW,CNF)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    I,LENW
      DIMENSION  WK2(LENW,*),CNF(*)
C
         WK2(  6,I)= WK2(  6,I)+WK2(  3,I)*CNF( 1)
         WK2(  7,I)= WK2(  7,I)+WK2(  3,I)*CNF( 2)
         WK2(  8,I)= WK2(  8,I)+WK2(  4,I)*CNF( 2)
         WK2(  9,I)= WK2(  9,I)+WK2(  3,I)*CNF( 3)
         WK2( 10,I)= WK2( 10,I)+WK2(  4,I)*CNF( 3)
         WK2( 11,I)= WK2( 11,I)+WK2(  5,I)*CNF( 3)
C
         WK2( 26,I)= WK2( 26,I)+WK2( 20,I)*CNF( 1)+WK2( 17,I)*CNF( 4)
         WK2( 27,I)= WK2( 27,I)+WK2( 21,I)*CNF( 1)
         WK2( 28,I)= WK2( 28,I)+WK2( 21,I)*CNF( 2)+WK2( 17,I)*CNF( 4)
         WK2( 29,I)= WK2( 29,I)+WK2( 22,I)*CNF( 2)+WK2( 18,I)*CNF( 4)
         WK2( 30,I)= WK2( 30,I)+WK2( 23,I)*CNF( 1)
         WK2( 31,I)= WK2( 31,I)+WK2( 23,I)*CNF( 2)
         WK2( 32,I)= WK2( 32,I)+WK2( 24,I)*CNF( 2)
         WK2( 33,I)= WK2( 33,I)+WK2( 23,I)*CNF( 3)+WK2( 17,I)*CNF( 4)
         WK2( 34,I)= WK2( 34,I)+WK2( 24,I)*CNF( 3)+WK2( 18,I)*CNF( 4)
         WK2( 35,I)= WK2( 35,I)+WK2( 25,I)*CNF( 3)+WK2( 19,I)*CNF( 4)
C
         WK2( 20,I)= WK2( 20,I)+WK2( 14,I)*CNF( 1)
         WK2( 21,I)= WK2( 21,I)+WK2( 14,I)*CNF( 2)
         WK2( 22,I)= WK2( 22,I)+WK2( 15,I)*CNF( 2)
         WK2( 23,I)= WK2( 23,I)+WK2( 14,I)*CNF( 3)
         WK2( 24,I)= WK2( 24,I)+WK2( 15,I)*CNF( 3)
         WK2( 25,I)= WK2( 25,I)+WK2( 16,I)*CNF( 3)
C
         WK2( 26,I)= WK2( 26,I)+WK2( 20,I)*CNF( 1)
         WK2( 27,I)= WK2( 27,I)+WK2( 20,I)*CNF( 2)
         WK2( 28,I)= WK2( 28,I)+WK2( 21,I)*CNF( 2)
         WK2( 29,I)= WK2( 29,I)+WK2( 22,I)*CNF( 2)
         WK2( 30,I)= WK2( 30,I)+WK2( 20,I)*CNF( 3)
         WK2( 31,I)= WK2( 31,I)+WK2( 21,I)*CNF( 3)
         WK2( 32,I)= WK2( 32,I)+WK2( 22,I)*CNF( 3)
         WK2( 33,I)= WK2( 33,I)+WK2( 23,I)*CNF( 3)
         WK2( 34,I)= WK2( 34,I)+WK2( 24,I)*CNF( 3)
         WK2( 35,I)= WK2( 35,I)+WK2( 25,I)*CNF( 3)
C
      RETURN
      END
C*MODULE INT2D   *DECK DPWRKB
C>
C>    @brief   ERIC dp utility (3)
C>
C>    @details common expressions for dp products in ERIC (3)
C>
C>    @author  Jose Sierra, 2013
C>
      SUBROUTINE DPWRKB(I,WK2,LENW,CNF)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    I,LENW
      DIMENSION  WK2(LENW,*),CNF(*)
C
         WK2( 36,I)= WK2( 26,I)-WK2(  6,I)*CNF( 1)
         WK2( 37,I)= WK2( 27,I)-WK2(  7,I)*CNF( 1)
         WK2( 38,I)= WK2( 28,I)-WK2(  8,I)*CNF( 1)
         WK2( 39,I)= WK2( 30,I)-WK2(  9,I)*CNF( 1)
         WK2( 40,I)= WK2( 31,I)-WK2( 10,I)*CNF( 1)
         WK2( 41,I)= WK2( 33,I)-WK2( 11,I)*CNF( 1)
C
         WK2( 42,I)= WK2( 27,I)-WK2(  6,I)*CNF( 2)
         WK2( 43,I)= WK2( 28,I)-WK2(  7,I)*CNF( 2)
         WK2( 44,I)= WK2( 29,I)-WK2(  8,I)*CNF( 2)
         WK2( 45,I)= WK2( 31,I)-WK2(  9,I)*CNF( 2)
         WK2( 46,I)= WK2( 32,I)-WK2( 10,I)*CNF( 2)
         WK2( 47,I)= WK2( 34,I)-WK2( 11,I)*CNF( 2)
C
         WK2( 48,I)= WK2( 30,I)-WK2(  6,I)*CNF( 3)
         WK2( 49,I)= WK2( 31,I)-WK2(  7,I)*CNF( 3)
         WK2( 50,I)= WK2( 32,I)-WK2(  8,I)*CNF( 3)
         WK2( 51,I)= WK2( 33,I)-WK2(  9,I)*CNF( 3)
         WK2( 52,I)= WK2( 34,I)-WK2( 10,I)*CNF( 3)
         WK2( 53,I)= WK2( 35,I)-WK2( 11,I)*CNF( 3)
C
      RETURN
      END
C  LPHI= 319
C  LWK1=   1
C  LWK2= 165
C  LENW= 165
C*MODULE INT2D   *DECK DDSS
C>
C>    @brief   ERIC ddss case
C>
C>    @details ERIC [dd|ss] integral quartet
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DDSS (IPRIM,JPRIM,KPRIM,LPRIM,IEQJ,KEQL,
     *                 XC,YC,ZC,XD,YD,ZD,PHI,WK2,LENW)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      LOGICAL    IEQJ,KEQL
      DIMENSION  PHI(*),WK2(LENW,*)
C
      PARAMETER (MXGSH=30, MXG2= MXGSH*MXGSH)
C
      PARAMETER (NTX=4, NPF=450, NGRD=7, NPX=1000, MXQT=16)
      COMMON /FMTTBL/ FGRID(0:NTX,0:NPF,0:NGRD),XGRID(0:NTX,0:NPX)
     *,               TMAX,RFINC(0:NGRD),RXINC
     *,               RMR(MXQT),TLGM(0:MXQT),NORD
      COMMON /ERIPRM/ EXI(MXGSH),EXJ(MXGSH),EXK(MXGSH),EXL(MXGSH),
     *                CCI(MXGSH),CCJ(MXGSH),CCK(MXGSH),CCL(MXGSH),
     *                XAB(MXG2),YAB(MXG2),ZAB(MXG2),
     *                XCD(MXG2),YCD(MXG2),ZCD(MXG2),
     *                CCBRA(MXG2),CCKET(MXG2),RXB(MXG2),
     *                SLBRA(MXG2),SLKET(MXG2),RXK(MXG2)
      LOGICAL         LCFLAG,LRINT
      COMMON /NLRC  / LCFLAG,EMU,EMU2,LRFILE
      COMMON /NLRCF / LRINT
      COMMON /SHLNOS/ QQ4,IDUMMY(20)
C
      DIMENSION  FT(0:16),SFAC( 9),CNF(11)
C
      PARAMETER (NL=  7, NK=  6, NJ=  3, NI=  3)
      DIMENSION  LSF(NL),KSF(NK),JSF(NJ),ISF(NI)
      DIMENSION  LJI(NL),KJI(NK),JJI(NJ),IJI(NI)
      DIMENSION  L0I(NL),K0I(NK),J0I(NJ),I0I(NI)
      DIMENSION  L0F(NL),K0F(NK),J0F(NJ),I0F(NI)
C
      PARAMETER (ZER=0.0D+00, ONE=1.0D+00, TWO=2.0D+00)
      PARAMETER (CCTOL=1.0D-13)
      DATA CNF/0.0D+00,0.0D+00,0.0D+00,1.0D+00,2.0D+00,3.0D+00,
     &         4.0D+00,5.0D+00,6.0D+00,7.0D+00,8.0D+00/
      SAVE CNF
C
      DATA LSF/  1,  1,  2,  3,  1,  2,  1/
      DATA LJI/104,118,118,139,179,205,275/
      DATA L0I/111,125,132,146,192,218,297/
      DATA L0F/117,131,138,152,204,230,318/
C
      DATA KSF/  3,  4,  5,  4,  5,  5/
      DATA KJI/ 97, 97, 97,166,166,253/
      DATA K0I/104,118,139,179,205,275/
      DATA K0F/110,124,145,191,217,296/
C
      DATA JSF/  1,  1,  1/
      DATA JJI/ 90,153,231/
      DATA J0I/ 97,166,253/
      DATA J0F/103,178,274/
C
      DATA ISF/  1,  1,  1/
      DATA IJI/  5, 12, 25/
      DATA I0I/ 90,153,231/
      DATA I0F/ 96,165,252/
C
      SFAC(1)= ONE
      PHI( 50)= ZER
      PHI( 52)= ZER
      PHI( 53)= ZER
      PHI( 54)= ZER
      PHI( 56)= ZER
      PHI( 57)= ZER
      PHI( 59)= ZER
      PHI( 69)= ZER
      PHI( 70)= ZER
      PHI( 71)= ZER
      PHI( 72)= ZER
      PHI( 73)= ZER
      PHI( 74)= ZER
      PHI( 78)= ZER
      PHI( 79)= ZER
      PHI( 80)= ZER
      PHI( 81)= ZER
      PHI( 82)= ZER
      PHI( 83)= ZER
      PHI( 87)= ZER
      PHI( 88)= ZER
      PHI( 89)= ZER
      DO N= 1,NL
         DO I=L0I(N),L0F(N)
            PHI(I)= ZER
         END DO
      END DO
      KL=0
      DO LL=1,LPRIM
         X04= EXL(LL)
         PHI( 49)= ZER
         PHI( 51)= ZER
         PHI( 55)= ZER
         PHI( 58)= ZER
         PHI( 66)= ZER
         PHI( 67)= ZER
         PHI( 68)= ZER
         PHI( 75)= ZER
         PHI( 76)= ZER
         PHI( 77)= ZER
         PHI( 84)= ZER
         PHI( 85)= ZER
         PHI( 86)= ZER
         DO N= 1,NK
            DO I=K0I(N),K0F(N)
               PHI(I)= ZER
            END DO
         END DO
         KTOP= KPRIM
         IF(KEQL) KTOP= LL
         DO KK=1,KTOP
            KL= KL+1
            CFK= CCKET(KL)
            IF(ABS(CFK).GT.CCTOL) THEN
               CFK= CFK*QQ4
               X03= EXK(KK)
               X34= X03+X04
               XKL= XCD(KL)
               YKL= YCD(KL)
               ZKL= ZCD(KL)
               PHI( 48)= ZER
               PHI( 63)= ZER
               PHI( 64)= ZER
               PHI( 65)= ZER
               DO N= 1,NJ
                  DO I=J0I(N),J0F(N)
                     PHI(I)= ZER
                  END DO
               END DO
               IJ=0
               DO JJ=1,JPRIM
                  X02= EXJ(JJ)
                  PHI( 47)= ZER
                  PHI( 60)= ZER
                  PHI( 61)= ZER
                  PHI( 62)= ZER
                  DO N= 1,NI
                     DO I=I0I(N),I0F(N)
                        PHI(I)= ZER
                     END DO
                  END DO
                  ITOP= IPRIM
                  IF(IEQJ) ITOP= JJ
                  DO II=1,ITOP
                     IJ= IJ+1
                     CFB= CCBRA(IJ)
                     IF(ABS(CFB).GT.CCTOL) THEN
                        X01= EXI(II)
                        X12= X01+X02
                        X41= ONE/(X12+X34)
                        FTZ= CFB*CFK
                        RX = XKL-XAB(IJ)
                        RY = YKL-YAB(IJ)
                        RZ = ZKL-ZAB(IJ)
                        RSQ= RX*RX+RY*RY+RZ*RZ
                        RHO= X12*X34*X41
                        IF(LRINT) THEN
                           EFR= EMU2/(EMU2+RHO)
                           RHO= RHO*EFR
                        ENDIF
                        TT = RSQ*RHO
                        N=4
                        IF(TT.LE.TMAX) THEN
C
C     FM(T) EVALUATION
C
                           TV= TT*RFINC(N)
                           IP= NINT(TV)
                           FX=    FGRID(4,IP,N) *TV
                           FX=(FX+FGRID(3,IP,N))*TV
                           FX=(FX+FGRID(2,IP,N))*TV
                           FX=(FX+FGRID(1,IP,N))*TV
                           FX= FX+FGRID(0,IP,N)
                           TV= TT*RXINC
                           IP= NINT(TV)
                           ET=    XGRID(4,IP) *TV
                           ET=(ET+XGRID(3,IP))*TV
                           ET=(ET+XGRID(2,IP))*TV
                           ET=(ET+XGRID(1,IP))*TV
                           ET= ET+XGRID(0,IP)
C
                           FT(N)= FX
                           T2= TT+TT
                           DO M=N,1,-1
                              FT(M-1)=(T2*FT(M)+ET)*RMR(M)
                           END DO
C
                           RHO= RHO+RHO
                           IF(LRINT) FTZ= FTZ*SQRT(EFR)
                           FTF= FTZ*SQRT(X41)
                           DO 210 M=0,N
                              FT(M)= FT(M)*FTF
  210                      FTF= FTF*RHO
                        ELSE
                           XIN= ONE/RSQ
                           FTF= FTZ*SQRT(XIN)*SLBRA(IJ)*SLKET(KL)
                           FT(0)= FTF
                           DO 220 M=1,N
                              FTF= FTF*XIN
  220                      FT(M)= TLGM(M)*FTF
                        END IF
C
                        CALL PHIFTS(5,RX,RY,RZ,PHI,FT)
C
C                       FAC= RXB(IJ)
                        PHI( 47)= PHI( 47)+PHI(  1)
C
                        PHI( 60)= PHI( 60)+PHI(  2)
                        PHI( 61)= PHI( 61)+PHI(  3)
                        PHI( 62)= PHI( 62)+PHI(  4)
                        DO N= 1,NI
                           FAC= SFAC(ISF(N))
                           J=IJI(N)
                           IF(FAC.EQ.ONE) THEN
                              DO I=I0I(N),I0F(N)
                                 PHI(I)= PHI(I)+PHI(J)
                                 J=J+1
                              END DO
                           ELSE
                              DO I=I0I(N),I0F(N)
                                 PHI(I)= PHI(I)+PHI(J)*FAC
                                 J=J+1
                              END DO
                           END IF
                        END DO
                     END IF
                  END DO
C                 FAC= EXJ(JJ)*TWO
                  PHI( 48)= PHI( 48)+PHI( 47)
C
                  PHI( 63)= PHI( 63)+PHI( 60)
                  PHI( 64)= PHI( 64)+PHI( 61)
                  PHI( 65)= PHI( 65)+PHI( 62)
                  DO N= 1,NJ
                     FAC= SFAC(JSF(N))
                     J=JJI(N)
                     IF(FAC.EQ.ONE) THEN
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)
                           J=J+1
                        END DO
                     ELSE
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)*FAC
                           J=J+1
                        END DO
                     END IF
                  END DO
               END DO
               FAC= RXK(KL)
               SFAC(2)= FAC
               SFAC(3)= SFAC(2)*FAC
               SFAC(4)= SFAC(3)*FAC
               SFAC(5)= SFAC(4)*FAC
               PHI( 49)= PHI( 49)+PHI( 48)*SFAC(2)
               PHI( 51)= PHI( 51)+PHI( 48)*SFAC(3)
               PHI( 55)= PHI( 55)+PHI( 48)*SFAC(4)
               PHI( 58)= PHI( 58)+PHI( 48)*SFAC(5)
C
               PHI( 66)= PHI( 66)+PHI( 63)*SFAC(3)
               PHI( 67)= PHI( 67)+PHI( 64)*SFAC(3)
               PHI( 68)= PHI( 68)+PHI( 65)*SFAC(3)
               PHI( 75)= PHI( 75)+PHI( 63)*SFAC(4)
               PHI( 76)= PHI( 76)+PHI( 64)*SFAC(4)
               PHI( 77)= PHI( 77)+PHI( 65)*SFAC(4)
               PHI( 84)= PHI( 84)+PHI( 63)*SFAC(5)
               PHI( 85)= PHI( 85)+PHI( 64)*SFAC(5)
               PHI( 86)= PHI( 86)+PHI( 65)*SFAC(5)
               DO N= 1,NK
                  FAC= SFAC(KSF(N))
                  J=KJI(N)
                  DO I=K0I(N),K0F(N)
                     PHI(I)= PHI(I)+PHI(J)*FAC
                     J=J+1
                  END DO
               END DO
            END IF
         END DO
         FAC= EXL(LL)*TWO
         SFAC(2)= FAC
         SFAC(3)= SFAC(2)*FAC
         SFAC(4)= SFAC(3)*FAC
         SFAC(5)= SFAC(4)*FAC
         PHI( 50)= PHI( 50)+PHI( 49)
         PHI( 52)= PHI( 52)+PHI( 51)
         PHI( 53)= PHI( 53)+PHI( 51)*SFAC(2)
         PHI( 54)= PHI( 54)+PHI( 51)*SFAC(3)
         PHI( 56)= PHI( 56)+PHI( 55)*SFAC(3)
         PHI( 57)= PHI( 57)+PHI( 55)*SFAC(4)
         PHI( 59)= PHI( 59)+PHI( 58)*SFAC(5)
C
         PHI( 69)= PHI( 69)+PHI( 66)
         PHI( 70)= PHI( 70)+PHI( 67)
         PHI( 71)= PHI( 71)+PHI( 68)
         PHI( 72)= PHI( 72)+PHI( 66)*SFAC(2)
         PHI( 73)= PHI( 73)+PHI( 67)*SFAC(2)
         PHI( 74)= PHI( 74)+PHI( 68)*SFAC(2)
         PHI( 78)= PHI( 78)+PHI( 75)*SFAC(2)
         PHI( 79)= PHI( 79)+PHI( 76)*SFAC(2)
         PHI( 80)= PHI( 80)+PHI( 77)*SFAC(2)
         PHI( 81)= PHI( 81)+PHI( 75)*SFAC(3)
         PHI( 82)= PHI( 82)+PHI( 76)*SFAC(3)
         PHI( 83)= PHI( 83)+PHI( 77)*SFAC(3)
         PHI( 87)= PHI( 87)+PHI( 84)*SFAC(4)
         PHI( 88)= PHI( 88)+PHI( 85)*SFAC(4)
         PHI( 89)= PHI( 89)+PHI( 86)*SFAC(4)
         DO N= 1,NL
            FAC= SFAC(LSF(N))
            J=LJI(N)
            IF(FAC.EQ.ONE) THEN
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)
                  J=J+1
               END DO
            ELSE
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)*FAC
                  J=J+1
               END DO
            END IF
         END DO
      END DO
C  POST-CONTRACTION PHASE
      PHI(112)= PHI(112)-PHI(111)
      PHI(114)= PHI(114)-PHI(111)
      PHI(117)= PHI(117)-PHI(111)
      PHI(126)= PHI(126)-PHI(125)
      PHI(128)= PHI(128)-PHI(125)
      PHI(131)= PHI(131)-PHI(125)
      PHI(133)= PHI(133)-PHI(132)
      PHI(135)= PHI(135)-PHI(132)
      PHI(138)= PHI(138)-PHI(132)
      PHI(147)= PHI(147)-PHI(146)
      PHI(149)= PHI(149)-PHI(146)
      PHI(152)= PHI(152)-PHI(146)
      III=152+ 30
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
C
      III=III+ 61
      III=III+ 22
      CALL PHIIJ4(III,PHI)
C
      WK2(  1,1)= PHI( 54)
      WK2(  2,1)= PHI( 50)
      WK2(  3,1)=-PHI( 72)
      WK2(  4,1)=-PHI( 73)
      WK2(  5,1)=-PHI( 74)
      WK2(  6,1)= PHI(112)
      WK2(  7,1)= PHI(113)
      WK2(  8,1)= PHI(114)
      WK2(  9,1)= PHI(115)
      WK2( 10,1)= PHI(116)
      WK2( 11,1)= PHI(117)
      WK2( 12,1)= PHI( 57)
      WK2( 13,1)= PHI( 53)
      WK2( 14,1)=-PHI( 81)
      WK2( 15,1)=-PHI( 82)
      WK2( 16,1)=-PHI( 83)
      WK2( 17,1)=-PHI( 69)
      WK2( 18,1)=-PHI( 70)
      WK2( 19,1)=-PHI( 71)
      WK2( 20,1)= PHI(133)
      WK2( 21,1)= PHI(134)
      WK2( 22,1)= PHI(135)
      WK2( 23,1)= PHI(136)
      WK2( 24,1)= PHI(137)
      WK2( 25,1)= PHI(138)
      WK2( 26,1)=-PHI(195)
      WK2( 27,1)=-PHI(196)
      WK2( 28,1)=-PHI(197)
      WK2( 29,1)=-PHI(198)
      WK2( 30,1)=-PHI(199)
      WK2( 31,1)=-PHI(200)
      WK2( 32,1)=-PHI(201)
      WK2( 33,1)=-PHI(202)
      WK2( 34,1)=-PHI(203)
      WK2( 35,1)=-PHI(204)
      WK2( 36,1)= PHI( 59)
      WK2( 37,1)= PHI( 56)
      WK2( 38,1)= PHI( 52)
      WK2( 39,1)=-PHI( 87)
      WK2( 40,1)=-PHI( 88)
      WK2( 41,1)=-PHI( 89)
      WK2( 42,1)=-PHI( 78)
      WK2( 43,1)=-PHI( 79)
      WK2( 44,1)=-PHI( 80)
      WK2( 45,1)= PHI(147)
      WK2( 46,1)= PHI(148)
      WK2( 47,1)= PHI(149)
      WK2( 48,1)= PHI(150)
      WK2( 49,1)= PHI(151)
      WK2( 50,1)= PHI(152)
      WK2( 51,1)= PHI(126)
      WK2( 52,1)= PHI(127)
      WK2( 53,1)= PHI(128)
      WK2( 54,1)= PHI(129)
      WK2( 55,1)= PHI(130)
      WK2( 56,1)= PHI(131)
      WK2( 57,1)=-PHI(221)
      WK2( 58,1)=-PHI(222)
      WK2( 59,1)=-PHI(223)
      WK2( 60,1)=-PHI(224)
      WK2( 61,1)=-PHI(225)
      WK2( 62,1)=-PHI(226)
      WK2( 63,1)=-PHI(227)
      WK2( 64,1)=-PHI(228)
      WK2( 65,1)=-PHI(229)
      WK2( 66,1)=-PHI(230)
      WK2( 67,1)= PHI(304)
      WK2( 68,1)= PHI(305)
      WK2( 69,1)= PHI(306)
      WK2( 70,1)= PHI(307)
      WK2( 71,1)= PHI(308)
      WK2( 72,1)= PHI(309)
      WK2( 73,1)= PHI(310)
      WK2( 74,1)= PHI(311)
      WK2( 75,1)= PHI(312)
      WK2( 76,1)= PHI(313)
      WK2( 77,1)= PHI(314)
      WK2( 78,1)= PHI(315)
      WK2( 79,1)= PHI(316)
      WK2( 80,1)= PHI(317)
      WK2( 81,1)= PHI(318)
      CNF(1)= XD-XC
      CNF(2)= YD-YC
      CNF(3)= ZD-ZC
      DO I=1,1
         ICOPY = I
         CALL DDWRK1(ICOPY,WK2,LENW,CNF)
      END DO
C
      RETURN
      END
C  LPHI= 802
C  LWK1=   4
C  LWK2= 495
C  LENW= 165
C*MODULE INT2D   *DECK DDPS
C>
C>    @brief   ERIC ddps case
C>
C>    @details ERIC [dd|ps] integral quartet
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DDPS (IPRIM,JPRIM,KPRIM,LPRIM,IEQJ,KEQL,
     *                 XA,YA,ZA,XB,YB,ZB,XC,YC,ZC,XD,YD,ZD,
     *                 PHI,WK1,WK2,LENW)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      LOGICAL    IEQJ,KEQL
      DIMENSION  PHI(*),WK1(*),WK2(LENW,*)
C
      PARAMETER (MXGSH=30, MXG2= MXGSH*MXGSH)
C
      PARAMETER (NTX=4, NPF=450, NGRD=7, NPX=1000, MXQT=16)
      COMMON /FMTTBL/ FGRID(0:NTX,0:NPF,0:NGRD),XGRID(0:NTX,0:NPX)
     *,               TMAX,RFINC(0:NGRD),RXINC
     *,               RMR(MXQT),TLGM(0:MXQT),NORD
      COMMON /ERIPRM/ EXI(MXGSH),EXJ(MXGSH),EXK(MXGSH),EXL(MXGSH),
     *                CCI(MXGSH),CCJ(MXGSH),CCK(MXGSH),CCL(MXGSH),
     *                XAB(MXG2),YAB(MXG2),ZAB(MXG2),
     *                XCD(MXG2),YCD(MXG2),ZCD(MXG2),
     *                CCBRA(MXG2),CCKET(MXG2),RXB(MXG2),
     *                SLBRA(MXG2),SLKET(MXG2),RXK(MXG2)
      LOGICAL         LCFLAG,LRINT
      COMMON /NLRC  / LCFLAG,EMU,EMU2,LRFILE
      COMMON /NLRCF / LRINT
      COMMON /SHLNOS/ QQ4,IDUMMY(20)
C
      DIMENSION  FT(0:16),SFAC( 9),CNF(11)
C
      PARAMETER (NL= 19, NK= 15, NJ=  7, NI=  4)
      DIMENSION  LSF(NL),KSF(NK),JSF(NJ),ISF(NI)
      DIMENSION  LJI(NL),KJI(NK),JJI(NJ),IJI(NI)
      DIMENSION  L0I(NL),K0I(NK),J0I(NJ),I0I(NI)
      DIMENSION  L0F(NL),K0F(NK),J0F(NJ),I0F(NI)
C
      PARAMETER (ZER=0.0D+00, ONE=1.0D+00, TWO=2.0D+00)
      PARAMETER (CCTOL=1.0D-13)
      DATA CNF/0.0D+00,0.0D+00,0.0D+00,1.0D+00,2.0D+00,3.0D+00,
     &         4.0D+00,5.0D+00,6.0D+00,7.0D+00,8.0D+00/
      SAVE CNF
C
      DATA LSF/  1,  2,  2,  3,  4,  1,  1,  2,  3,  1,
     *           1,  2,  3,  1,  2,  1,  2,  1,  1/
      DATA LJI/174,174,195,195,216,237,251,251,272,312,
     *         338,338,377,416,442,512,556,622,734/
      DATA L0I/181,188,202,209,223,244,258,265,279,325,
     *         351,364,390,429,455,534,578,644,768/
      DATA L0F/187,194,208,215,229,250,264,271,285,337,
     *         363,376,402,441,467,555,599,665,801/
C
      DATA KSF/  3,  4,  5,  3,  4,  5,  3,  4,  5,  4,
     *           5,  4,  5,  5,  5/
      DATA KJI/167,167,167,230,230,230,299,299,299,403,
     *         403,490,490,600,700/
      DATA K0I/174,195,216,237,251,272,312,338,377,416,
     *         442,512,556,622,734/
      DATA K0F/180,201,222,243,257,278,324,350,389,428,
     *         454,533,577,643,767/
C
      DATA JSF/  1,  2,  1,  2,  1,  2,  1/
      DATA JJI/160,160,286,286,468,468,666/
      DATA J0I/167,230,299,403,490,600,700/
      DATA J0F/173,236,311,415,511,621,733/
C
      DATA ISF/  2,  2,  2,  2/
      DATA IJI/  5, 12, 25, 47/
      DATA I0I/160,286,468,666/
      DATA I0F/166,298,489,699/
C
      SFAC(1)= ONE
      PHI( 84)= ZER
      PHI( 86)= ZER
      PHI( 87)= ZER
      PHI( 88)= ZER
      PHI( 90)= ZER
      PHI( 91)= ZER
      PHI( 93)= ZER
      PHI(103)= ZER
      PHI(104)= ZER
      PHI(105)= ZER
      PHI(109)= ZER
      PHI(110)= ZER
      PHI(111)= ZER
      PHI(112)= ZER
      PHI(113)= ZER
      PHI(114)= ZER
      PHI(115)= ZER
      PHI(116)= ZER
      PHI(117)= ZER
      PHI(121)= ZER
      PHI(122)= ZER
      PHI(123)= ZER
      PHI(124)= ZER
      PHI(125)= ZER
      PHI(126)= ZER
      PHI(130)= ZER
      PHI(131)= ZER
      PHI(132)= ZER
      PHI(139)= ZER
      PHI(140)= ZER
      PHI(141)= ZER
      PHI(142)= ZER
      PHI(143)= ZER
      PHI(144)= ZER
      PHI(148)= ZER
      PHI(149)= ZER
      PHI(150)= ZER
      PHI(151)= ZER
      PHI(152)= ZER
      PHI(153)= ZER
      PHI(157)= ZER
      PHI(158)= ZER
      PHI(159)= ZER
      DO N= 1,NL
         DO I=L0I(N),L0F(N)
            PHI(I)= ZER
         END DO
      END DO
      KL=0
      DO LL=1,LPRIM
         X04= EXL(LL)
         PHI( 83)= ZER
         PHI( 85)= ZER
         PHI( 89)= ZER
         PHI( 92)= ZER
         PHI(100)= ZER
         PHI(101)= ZER
         PHI(102)= ZER
         PHI(106)= ZER
         PHI(107)= ZER
         PHI(108)= ZER
         PHI(118)= ZER
         PHI(119)= ZER
         PHI(120)= ZER
         PHI(127)= ZER
         PHI(128)= ZER
         PHI(129)= ZER
         PHI(136)= ZER
         PHI(137)= ZER
         PHI(138)= ZER
         PHI(145)= ZER
         PHI(146)= ZER
         PHI(147)= ZER
         PHI(154)= ZER
         PHI(155)= ZER
         PHI(156)= ZER
         DO N= 1,NK
            DO I=K0I(N),K0F(N)
               PHI(I)= ZER
            END DO
         END DO
         KTOP= KPRIM
         IF(KEQL) KTOP= LL
         DO KK=1,KTOP
            KL= KL+1
            CFK= CCKET(KL)
            IF(ABS(CFK).GT.CCTOL) THEN
               CFK= CFK*QQ4
               X03= EXK(KK)
               X34= X03+X04
               XKL= XCD(KL)
               YKL= YCD(KL)
               ZKL= ZCD(KL)
               PHI( 82)= ZER
               PHI( 97)= ZER
               PHI( 98)= ZER
               PHI( 99)= ZER
               PHI(133)= ZER
               PHI(134)= ZER
               PHI(135)= ZER
               DO N= 1,NJ
                  DO I=J0I(N),J0F(N)
                     PHI(I)= ZER
                  END DO
               END DO
               IJ=0
               DO JJ=1,JPRIM
                  X02= EXJ(JJ)
                  PHI( 81)= ZER
                  PHI( 94)= ZER
                  PHI( 95)= ZER
                  PHI( 96)= ZER
                  DO N= 1,NI
                     DO I=I0I(N),I0F(N)
                        PHI(I)= ZER
                     END DO
                  END DO
                  ITOP= IPRIM
                  IF(IEQJ) ITOP= JJ
                  DO II=1,ITOP
                     IJ= IJ+1
                     CFB= CCBRA(IJ)
                     IF(ABS(CFB).GT.CCTOL) THEN
                        X01= EXI(II)
                        X12= X01+X02
                        X41= ONE/(X12+X34)
                        FTZ= CFB*CFK
                        RX = XKL-XAB(IJ)
                        RY = YKL-YAB(IJ)
                        RZ = ZKL-ZAB(IJ)
                        RSQ= RX*RX+RY*RY+RZ*RZ
                        RHO= X12*X34*X41
                        IF(LRINT) THEN
                           EFR= EMU2/(EMU2+RHO)
                           RHO= RHO*EFR
                        ENDIF
                        TT = RSQ*RHO
                        N=5
                        IF(TT.LE.TMAX) THEN
C
C     FM(T) EVALUATION
C
                           TV= TT*RFINC(N)
                           IP= NINT(TV)
                           FX=    FGRID(4,IP,N) *TV
                           FX=(FX+FGRID(3,IP,N))*TV
                           FX=(FX+FGRID(2,IP,N))*TV
                           FX=(FX+FGRID(1,IP,N))*TV
                           FX= FX+FGRID(0,IP,N)
                           TV= TT*RXINC
                           IP= NINT(TV)
                           ET=    XGRID(4,IP) *TV
                           ET=(ET+XGRID(3,IP))*TV
                           ET=(ET+XGRID(2,IP))*TV
                           ET=(ET+XGRID(1,IP))*TV
                           ET= ET+XGRID(0,IP)
C
                           FT(8)= FX
                           T2= TT+TT
                           DO M=8,1,-1
                              FT(M-1)=(T2*FT(M)+ET)*RMR(M)
                           END DO
C
                           RHO= RHO+RHO
                           IF(LRINT) FTZ= FTZ*SQRT(EFR)
                           FTF= FTZ*SQRT(X41)
                           DO 210 M=0,N
                              FT(M)= FT(M)*FTF
  210                      FTF= FTF*RHO
                        ELSE
                           XIN= ONE/RSQ
                           FTF= FTZ*SQRT(XIN)*SLBRA(IJ)*SLKET(KL)
                           FT(0)= FTF
                           DO 220 M=1,N
                              FTF= FTF*XIN
  220                      FT(M)= TLGM(M)*FTF
                        END IF
C
                        CALL PHIFTS(6,RX,RY,RZ,PHI,FT)
C
                        FAC= RXB(IJ)
                        SFAC(2)= FAC
                        PHI( 81)= PHI( 81)+PHI(  1)*SFAC(2)
C
                        PHI( 94)= PHI( 94)+PHI(  2)*SFAC(2)
                        PHI( 95)= PHI( 95)+PHI(  3)*SFAC(2)
                        PHI( 96)= PHI( 96)+PHI(  4)*SFAC(2)
                        DO N= 1,NI
                           FAC= SFAC(ISF(N))
                           J=IJI(N)
                           DO I=I0I(N),I0F(N)
                              PHI(I)= PHI(I)+PHI(J)*FAC
                              J=J+1
                           END DO
                        END DO
                     END IF
                  END DO
                  FAC= EXJ(JJ)*TWO
                  SFAC(2)= FAC
                  PHI( 82)= PHI( 82)+PHI( 81)*SFAC(2)
C
                  PHI( 97)= PHI( 97)+PHI( 94)
                  PHI( 98)= PHI( 98)+PHI( 95)
                  PHI( 99)= PHI( 99)+PHI( 96)
                  PHI(133)= PHI(133)+PHI( 94)*SFAC(2)
                  PHI(134)= PHI(134)+PHI( 95)*SFAC(2)
                  PHI(135)= PHI(135)+PHI( 96)*SFAC(2)
                  DO N= 1,NJ
                     FAC= SFAC(JSF(N))
                     J=JJI(N)
                     IF(FAC.EQ.ONE) THEN
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)
                           J=J+1
                        END DO
                     ELSE
                        DO I=J0I(N),J0F(N)
                           PHI(I)= PHI(I)+PHI(J)*FAC
                           J=J+1
                        END DO
                     END IF
                  END DO
               END DO
               FAC= RXK(KL)
               SFAC(2)= FAC
               SFAC(3)= SFAC(2)*FAC
               SFAC(4)= SFAC(3)*FAC
               SFAC(5)= SFAC(4)*FAC
               PHI( 83)= PHI( 83)+PHI( 82)*SFAC(2)
               PHI( 85)= PHI( 85)+PHI( 82)*SFAC(3)
               PHI( 89)= PHI( 89)+PHI( 82)*SFAC(4)
               PHI( 92)= PHI( 92)+PHI( 82)*SFAC(5)
C
               PHI(100)= PHI(100)+PHI( 97)*SFAC(2)
               PHI(101)= PHI(101)+PHI( 98)*SFAC(2)
               PHI(102)= PHI(102)+PHI( 99)*SFAC(2)
               PHI(106)= PHI(106)+PHI( 97)*SFAC(3)
               PHI(107)= PHI(107)+PHI( 98)*SFAC(3)
               PHI(108)= PHI(108)+PHI( 99)*SFAC(3)
               PHI(118)= PHI(118)+PHI( 97)*SFAC(4)
               PHI(119)= PHI(119)+PHI( 98)*SFAC(4)
               PHI(120)= PHI(120)+PHI( 99)*SFAC(4)
               PHI(127)= PHI(127)+PHI( 97)*SFAC(5)
               PHI(128)= PHI(128)+PHI( 98)*SFAC(5)
               PHI(129)= PHI(129)+PHI( 99)*SFAC(5)
               PHI(136)= PHI(136)+PHI(133)*SFAC(3)
               PHI(137)= PHI(137)+PHI(134)*SFAC(3)
               PHI(138)= PHI(138)+PHI(135)*SFAC(3)
               PHI(145)= PHI(145)+PHI(133)*SFAC(4)
               PHI(146)= PHI(146)+PHI(134)*SFAC(4)
               PHI(147)= PHI(147)+PHI(135)*SFAC(4)
               PHI(154)= PHI(154)+PHI(133)*SFAC(5)
               PHI(155)= PHI(155)+PHI(134)*SFAC(5)
               PHI(156)= PHI(156)+PHI(135)*SFAC(5)
               DO N= 1,NK
                  FAC= SFAC(KSF(N))
                  J=KJI(N)
                  DO I=K0I(N),K0F(N)
                     PHI(I)= PHI(I)+PHI(J)*FAC
                     J=J+1
                  END DO
               END DO
            END IF
         END DO
         FAC= EXL(LL)*TWO
         SFAC(2)= FAC
         SFAC(3)= SFAC(2)*FAC
         SFAC(4)= SFAC(3)*FAC
         SFAC(5)= SFAC(4)*FAC
         PHI( 84)= PHI( 84)+PHI( 83)
         PHI( 86)= PHI( 86)+PHI( 85)
         PHI( 87)= PHI( 87)+PHI( 85)*SFAC(2)
         PHI( 88)= PHI( 88)+PHI( 85)*SFAC(3)
         PHI( 90)= PHI( 90)+PHI( 89)*SFAC(3)
         PHI( 91)= PHI( 91)+PHI( 89)*SFAC(4)
         PHI( 93)= PHI( 93)+PHI( 92)*SFAC(5)
C
         PHI(103)= PHI(103)+PHI(100)
         PHI(104)= PHI(104)+PHI(101)
         PHI(105)= PHI(105)+PHI(102)
         PHI(109)= PHI(109)+PHI(106)
         PHI(110)= PHI(110)+PHI(107)
         PHI(111)= PHI(111)+PHI(108)
         PHI(112)= PHI(112)+PHI(106)*SFAC(2)
         PHI(113)= PHI(113)+PHI(107)*SFAC(2)
         PHI(114)= PHI(114)+PHI(108)*SFAC(2)
         PHI(115)= PHI(115)+PHI(106)*SFAC(3)
         PHI(116)= PHI(116)+PHI(107)*SFAC(3)
         PHI(117)= PHI(117)+PHI(108)*SFAC(3)
         PHI(121)= PHI(121)+PHI(118)*SFAC(3)
         PHI(122)= PHI(122)+PHI(119)*SFAC(3)
         PHI(123)= PHI(123)+PHI(120)*SFAC(3)
         PHI(124)= PHI(124)+PHI(118)*SFAC(4)
         PHI(125)= PHI(125)+PHI(119)*SFAC(4)
         PHI(126)= PHI(126)+PHI(120)*SFAC(4)
         PHI(130)= PHI(130)+PHI(127)*SFAC(5)
         PHI(131)= PHI(131)+PHI(128)*SFAC(5)
         PHI(132)= PHI(132)+PHI(129)*SFAC(5)
         PHI(139)= PHI(139)+PHI(136)
         PHI(140)= PHI(140)+PHI(137)
         PHI(141)= PHI(141)+PHI(138)
         PHI(142)= PHI(142)+PHI(136)*SFAC(2)
         PHI(143)= PHI(143)+PHI(137)*SFAC(2)
         PHI(144)= PHI(144)+PHI(138)*SFAC(2)
         PHI(148)= PHI(148)+PHI(145)*SFAC(2)
         PHI(149)= PHI(149)+PHI(146)*SFAC(2)
         PHI(150)= PHI(150)+PHI(147)*SFAC(2)
         PHI(151)= PHI(151)+PHI(145)*SFAC(3)
         PHI(152)= PHI(152)+PHI(146)*SFAC(3)
         PHI(153)= PHI(153)+PHI(147)*SFAC(3)
         PHI(157)= PHI(157)+PHI(154)*SFAC(4)
         PHI(158)= PHI(158)+PHI(155)*SFAC(4)
         PHI(159)= PHI(159)+PHI(156)*SFAC(4)
         DO N= 1,NL
            FAC= SFAC(LSF(N))
            J=LJI(N)
            IF(FAC.EQ.ONE) THEN
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)
                  J=J+1
               END DO
            ELSE
               DO I=L0I(N),L0F(N)
                  PHI(I)= PHI(I)+PHI(J)*FAC
                  J=J+1
               END DO
            END IF
         END DO
      END DO
C  POST-CONTRACTION PHASE
      PHI(182)= PHI(182)-PHI(181)
      PHI(184)= PHI(184)-PHI(181)
      PHI(187)= PHI(187)-PHI(181)
      PHI(189)= PHI(189)-PHI(188)
      PHI(191)= PHI(191)-PHI(188)
      PHI(194)= PHI(194)-PHI(188)
      PHI(203)= PHI(203)-PHI(202)
      PHI(205)= PHI(205)-PHI(202)
      PHI(208)= PHI(208)-PHI(202)
      PHI(210)= PHI(210)-PHI(209)
      PHI(212)= PHI(212)-PHI(209)
      PHI(215)= PHI(215)-PHI(209)
      PHI(224)= PHI(224)-PHI(223)
      PHI(226)= PHI(226)-PHI(223)
      PHI(229)= PHI(229)-PHI(223)
      PHI(245)= PHI(245)-PHI(244)
      PHI(247)= PHI(247)-PHI(244)
      PHI(250)= PHI(250)-PHI(244)
      PHI(259)= PHI(259)-PHI(258)
      PHI(261)= PHI(261)-PHI(258)
      PHI(264)= PHI(264)-PHI(258)
      PHI(266)= PHI(266)-PHI(265)
      PHI(268)= PHI(268)-PHI(265)
      PHI(271)= PHI(271)-PHI(265)
      PHI(280)= PHI(280)-PHI(279)
      PHI(282)= PHI(282)-PHI(279)
      PHI(285)= PHI(285)-PHI(279)
      III=285+ 30
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
      III=III+ 13
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
      III=III+ 13*3
      CALL PHIIJ3(III,PHI)
      III=III+ 13*2
      CALL PHIIJ3(III,PHI)
C
      III=III+ 61
      III=III+ 22
      CALL PHIIJ4(III,PHI)
      III=III+ 22*2
      CALL PHIIJ4(III,PHI)
      III=III+ 22*3
      CALL PHIIJ4(III,PHI)
C
      III=III+130
      CALL PHIIJ5(III,PHI)
C
      CNF(1)= XB-XA
      CNF(2)= YB-YA
      CNF(3)= ZB-ZA
      WK1(  2)= PHI(115)+PHI( 88)*CNF( 1)
      WK1(  3)= PHI(116)+PHI( 88)*CNF( 2)
      WK1(  4)= PHI(117)+PHI( 88)*CNF( 3)
      CALL DDPS_BCTE(WK1,WK2,LENW,1)
      WK1(  2)= PHI(103)+PHI( 84)*CNF( 1)
      WK1(  3)= PHI(104)+PHI( 84)*CNF( 2)
      WK1(  4)= PHI(105)+PHI( 84)*CNF( 3)
      CALL DDPS_BCTE(WK1,WK2,LENW,2)
      I=189
      J=142
      L=3
      DO K=  3,  5
         IF(K.EQ. 5) I=I+1
         IF(K.EQ. 5) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=328
      J=245
      L=4
      DO K=  6, 11
         IF(K.EQ. 9 .OR. K.EQ.11) I=I+1
         IF(K.EQ. 9 .OR. K.EQ.11) L=L-1
         WK1(  2)= PHI(I  )+PHI(J)*CNF( 1)
         WK1(  3)= PHI(I+1)+PHI(J)*CNF( 2)
         WK1(  4)= PHI(I+L)+PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      WK1(  2)= PHI(124)+PHI( 91)*CNF( 1)
      WK1(  3)= PHI(125)+PHI( 91)*CNF( 2)
      WK1(  4)= PHI(126)+PHI( 91)*CNF( 3)
      CALL DDPS_BCTE(WK1,WK2,LENW,12)
      WK1(  2)= PHI(112)+PHI( 87)*CNF( 1)
      WK1(  3)= PHI(113)+PHI( 87)*CNF( 2)
      WK1(  4)= PHI(114)+PHI( 87)*CNF( 3)
      CALL DDPS_BCTE(WK1,WK2,LENW,13)
      I=210
      J=151
      L=3
      DO K= 14, 16
         IF(K.EQ.16) I=I+1
         IF(K.EQ.16) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=182
      J=139
      L=3
      DO K= 17, 19
         IF(K.EQ.19) I=I+1
         IF(K.EQ.19) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=367
      J=266
      L=4
      DO K= 20, 25
         IF(K.EQ.23 .OR. K.EQ.25) I=I+1
         IF(K.EQ.23 .OR. K.EQ.25) L=L-1
         WK1(  2)= PHI(I  )+PHI(J)*CNF( 1)
         WK1(  3)= PHI(I+1)+PHI(J)*CNF( 2)
         WK1(  4)= PHI(I+L)+PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=541
      J=432
      L=5
      DO K= 26, 35
         IF(K.EQ.30 .OR. K.EQ.33 .OR. K.EQ.35) I=I+1
         IF(K.EQ.30 .OR. K.EQ.33 .OR. K.EQ.35) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      WK1(  2)= PHI(130)+PHI( 93)*CNF( 1)
      WK1(  3)= PHI(131)+PHI( 93)*CNF( 2)
      WK1(  4)= PHI(132)+PHI( 93)*CNF( 3)
      CALL DDPS_BCTE(WK1,WK2,LENW,36)
      WK1(  2)= PHI(121)+PHI( 90)*CNF( 1)
      WK1(  3)= PHI(122)+PHI( 90)*CNF( 2)
      WK1(  4)= PHI(123)+PHI( 90)*CNF( 3)
      CALL DDPS_BCTE(WK1,WK2,LENW,37)
      WK1(  2)= PHI(109)+PHI( 86)*CNF( 1)
      WK1(  3)= PHI(110)+PHI( 86)*CNF( 2)
      WK1(  4)= PHI(111)+PHI( 86)*CNF( 3)
      CALL DDPS_BCTE(WK1,WK2,LENW,38)
      I=224
      J=157
      L=3
      DO K= 39, 41
         IF(K.EQ.41) I=I+1
         IF(K.EQ.41) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=203
      J=148
      L=3
      DO K= 42, 44
         IF(K.EQ.44) I=I+1
         IF(K.EQ.44) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=393
      J=280
      L=4
      DO K= 45, 50
         IF(K.EQ.48 .OR. K.EQ.50) I=I+1
         IF(K.EQ.48 .OR. K.EQ.50) L=L-1
         WK1(  2)= PHI(I  )+PHI(J)*CNF( 1)
         WK1(  3)= PHI(I+1)+PHI(J)*CNF( 2)
         WK1(  4)= PHI(I+L)+PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=354
      J=259
      L=4
      DO K= 51, 56
         IF(K.EQ.54 .OR. K.EQ.56) I=I+1
         IF(K.EQ.54 .OR. K.EQ.56) L=L-1
         WK1(  2)= PHI(I  )+PHI(J)*CNF( 1)
         WK1(  3)= PHI(I+1)+PHI(J)*CNF( 2)
         WK1(  4)= PHI(I+L)+PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=585
      J=458
      L=5
      DO K= 57, 66
         IF(K.EQ.61 .OR. K.EQ.64 .OR. K.EQ.66) I=I+1
         IF(K.EQ.61 .OR. K.EQ.64 .OR. K.EQ.66) L=L-1
         WK1(  2)=-PHI(I  )-PHI(J)*CNF( 1)
         WK1(  3)=-PHI(I+1)-PHI(J)*CNF( 2)
         WK1(  4)=-PHI(I+L)-PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      I=781
      J=651
      L=6
      DO K= 67, 81
         IF(K.EQ.72 .OR. K.EQ.76 .OR. K.EQ.79 .OR. K.EQ.81) I=I+1
         IF(K.EQ.72 .OR. K.EQ.76 .OR. K.EQ.79 .OR. K.EQ.81) L=L-1
         WK1(  2)= PHI(I  )+PHI(J)*CNF( 1)
         WK1(  3)= PHI(I+1)+PHI(J)*CNF( 2)
         WK1(  4)= PHI(I+L)+PHI(J)*CNF( 3)
         CALL DDPS_BCTE(WK1,WK2,LENW, K)
         I=I+1
         J=J+1
      END DO
      CNF(1)= XD-XC
      CNF(2)= YD-YC
      CNF(3)= ZD-ZC
      DO I=1,3
         ICOPY = I
         CALL DDWRK1(ICOPY,WK2,LENW,CNF)
      END DO
C
      RETURN
      END
C*MODULE INT2D   *DECK DDPS_BCTE
C>
C>    @brief   ERIC ddps backtransfer
C>
C>    @details ERIC [dd|ps] backtransfer step
C>
C>    @author  Graham Fletcher, 2004, modified Jose Sierra, 2013.
C>
      SUBROUTINE DDPS_BCTE(WK1,WK2,LENW,JR)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    LENW,I,J,JR
      DIMENSION  WK1(*),WK2(LENW,*)
C
      J=  1
      DO I=1,3
         J=J+1
         WK2(JR,I)= WK1(J)
      END DO
C
      RETURN
      END
C*MODULE INT2D   *DECK DDWRK1
C>
C>    @brief   ERIC dd utility
C>
C>    @details common expressions for dd products in ERIC
C>
C>    @author  Jose Sierra, 2013
C>
      SUBROUTINE DDWRK1(I,WK2,LENW,CNF)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
      INTEGER    I,LENW
      DIMENSION  WK2(LENW,*),CNF(*)
C
         CALL DPWRKT(I,WK2,LENW,CNF)
C
         WK2( 67,I)= WK2( 67,I)+WK2( 57,I)*CNF( 1)+WK2( 51,I)*CNF( 6)
         WK2( 68,I)= WK2( 68,I)+WK2( 58,I)*CNF( 1)+WK2( 52,I)*CNF( 5)
         WK2( 69,I)= WK2( 69,I)+WK2( 59,I)*CNF( 1)+WK2( 53,I)*CNF( 4)
         WK2( 70,I)= WK2( 70,I)+WK2( 60,I)*CNF( 1)
         WK2( 71,I)= WK2( 71,I)+WK2( 60,I)*CNF( 2)+WK2( 53,I)*CNF( 6)
         WK2( 72,I)= WK2( 72,I)+WK2( 61,I)*CNF( 1)+WK2( 54,I)*CNF( 5)
         WK2( 73,I)= WK2( 73,I)+WK2( 62,I)*CNF( 1)+WK2( 55,I)*CNF( 4)
         WK2( 74,I)= WK2( 74,I)+WK2( 63,I)*CNF( 1)
         WK2( 75,I)= WK2( 75,I)+WK2( 63,I)*CNF( 2)+WK2( 55,I)*CNF( 5)
         WK2( 76,I)= WK2( 76,I)+WK2( 64,I)*CNF( 1)+WK2( 56,I)*CNF( 4)
         WK2( 77,I)= WK2( 77,I)+WK2( 65,I)*CNF( 1)
         WK2( 78,I)= WK2( 78,I)+WK2( 65,I)*CNF( 2)+WK2( 56,I)*CNF( 4)
         WK2( 79,I)= WK2( 79,I)+WK2( 66,I)*CNF( 1)
         WK2( 80,I)= WK2( 80,I)+WK2( 66,I)*CNF( 2)
         WK2( 81,I)= WK2( 81,I)+WK2( 66,I)*CNF( 3)+WK2( 56,I)*CNF( 6)
C
         WK2( 57,I)= WK2( 57,I)+WK2( 45,I)*CNF( 1)+WK2( 42,I)*CNF( 5)
         WK2( 58,I)= WK2( 58,I)+WK2( 46,I)*CNF( 1)+WK2( 43,I)*CNF( 4)
         WK2( 59,I)= WK2( 59,I)+WK2( 47,I)*CNF( 1)
         WK2( 60,I)= WK2( 60,I)+WK2( 47,I)*CNF( 2)+WK2( 43,I)*CNF( 5)
         WK2( 61,I)= WK2( 61,I)+WK2( 48,I)*CNF( 1)+WK2( 44,I)*CNF( 4)
         WK2( 62,I)= WK2( 62,I)+WK2( 49,I)*CNF( 1)
         WK2( 63,I)= WK2( 63,I)+WK2( 49,I)*CNF( 2)+WK2( 44,I)*CNF( 4)
         WK2( 64,I)= WK2( 64,I)+WK2( 50,I)*CNF( 1)
         WK2( 65,I)= WK2( 65,I)+WK2( 50,I)*CNF( 2)
         WK2( 66,I)= WK2( 66,I)+WK2( 50,I)*CNF( 3)+WK2( 44,I)*CNF( 5)
C
         WK2( 45,I)= WK2( 45,I)+WK2( 39,I)*CNF( 1)+WK2( 37,I)*CNF( 4)
         WK2( 46,I)= WK2( 46,I)+WK2( 40,I)*CNF( 1)
         WK2( 47,I)= WK2( 47,I)+WK2( 40,I)*CNF( 2)+WK2( 37,I)*CNF( 4)
         WK2( 48,I)= WK2( 48,I)+WK2( 41,I)*CNF( 1)
         WK2( 49,I)= WK2( 49,I)+WK2( 41,I)*CNF( 2)
         WK2( 50,I)= WK2( 50,I)+WK2( 41,I)*CNF( 3)+WK2( 37,I)*CNF( 4)
         WK2( 51,I)= WK2( 51,I)+WK2( 42,I)*CNF( 1)+WK2( 38,I)*CNF( 4)
         WK2( 52,I)= WK2( 52,I)+WK2( 43,I)*CNF( 1)
         WK2( 53,I)= WK2( 53,I)+WK2( 43,I)*CNF( 2)+WK2( 38,I)*CNF( 4)
         WK2( 54,I)= WK2( 54,I)+WK2( 44,I)*CNF( 1)
         WK2( 55,I)= WK2( 55,I)+WK2( 44,I)*CNF( 2)
         WK2( 56,I)= WK2( 56,I)+WK2( 44,I)*CNF( 3)+WK2( 38,I)*CNF( 4)
C
         WK2( 39,I)= WK2( 39,I)+WK2( 36,I)*CNF( 1)
         WK2( 40,I)= WK2( 40,I)+WK2( 36,I)*CNF( 2)
         WK2( 41,I)= WK2( 41,I)+WK2( 36,I)*CNF( 3)
         WK2( 42,I)= WK2( 42,I)+WK2( 37,I)*CNF( 1)
         WK2( 43,I)= WK2( 43,I)+WK2( 37,I)*CNF( 2)
         WK2( 44,I)= WK2( 44,I)+WK2( 37,I)*CNF( 3)
C
         CALL DPWRKM(I,WK2,LENW,CNF)
C
         WK2( 67,I)= WK2( 67,I)+WK2( 57,I)*CNF( 1)+WK2( 51,I)*CNF( 5)
         WK2( 68,I)= WK2( 68,I)+WK2( 58,I)*CNF( 1)+WK2( 52,I)*CNF( 4)
         WK2( 69,I)= WK2( 69,I)+WK2( 59,I)*CNF( 1)
         WK2( 70,I)= WK2( 70,I)+WK2( 59,I)*CNF( 2)+WK2( 52,I)*CNF( 5)
         WK2( 71,I)= WK2( 71,I)+WK2( 60,I)*CNF( 2)+WK2( 53,I)*CNF( 5)
         WK2( 72,I)= WK2( 72,I)+WK2( 61,I)*CNF( 1)+WK2( 54,I)*CNF( 4)
         WK2( 73,I)= WK2( 73,I)+WK2( 62,I)*CNF( 1)
         WK2( 74,I)= WK2( 74,I)+WK2( 62,I)*CNF( 2)+WK2( 54,I)*CNF( 4)
         WK2( 75,I)= WK2( 75,I)+WK2( 63,I)*CNF( 2)+WK2( 55,I)*CNF( 4)
         WK2( 76,I)= WK2( 76,I)+WK2( 64,I)*CNF( 1)
         WK2( 77,I)= WK2( 77,I)+WK2( 64,I)*CNF( 2)
         WK2( 78,I)= WK2( 78,I)+WK2( 65,I)*CNF( 2)
         WK2( 79,I)= WK2( 79,I)+WK2( 64,I)*CNF( 3)+WK2( 54,I)*CNF( 5)
         WK2( 80,I)= WK2( 80,I)+WK2( 65,I)*CNF( 3)+WK2( 55,I)*CNF( 5)
         WK2( 81,I)= WK2( 81,I)+WK2( 66,I)*CNF( 3)+WK2( 56,I)*CNF( 5)
C
         WK2( 57,I)= WK2( 57,I)+WK2( 45,I)*CNF( 1)+WK2( 42,I)*CNF( 4)
         WK2( 58,I)= WK2( 58,I)+WK2( 46,I)*CNF( 1)
         WK2( 59,I)= WK2( 59,I)+WK2( 46,I)*CNF( 2)+WK2( 42,I)*CNF( 4)
         WK2( 60,I)= WK2( 60,I)+WK2( 47,I)*CNF( 2)+WK2( 43,I)*CNF( 4)
         WK2( 61,I)= WK2( 61,I)+WK2( 48,I)*CNF( 1)
         WK2( 62,I)= WK2( 62,I)+WK2( 48,I)*CNF( 2)
         WK2( 63,I)= WK2( 63,I)+WK2( 49,I)*CNF( 2)
         WK2( 64,I)= WK2( 64,I)+WK2( 48,I)*CNF( 3)+WK2( 42,I)*CNF( 4)
         WK2( 65,I)= WK2( 65,I)+WK2( 49,I)*CNF( 3)+WK2( 43,I)*CNF( 4)
         WK2( 66,I)= WK2( 66,I)+WK2( 50,I)*CNF( 3)+WK2( 44,I)*CNF( 4)
C
         WK2( 45,I)= WK2( 45,I)+WK2( 39,I)*CNF( 1)
         WK2( 46,I)= WK2( 46,I)+WK2( 39,I)*CNF( 2)
         WK2( 47,I)= WK2( 47,I)+WK2( 40,I)*CNF( 2)
         WK2( 48,I)= WK2( 48,I)+WK2( 39,I)*CNF( 3)
         WK2( 49,I)= WK2( 49,I)+WK2( 40,I)*CNF( 3)
         WK2( 50,I)= WK2( 50,I)+WK2( 41,I)*CNF( 3)
         WK2( 51,I)= WK2( 51,I)+WK2( 42,I)*CNF( 1)
         WK2( 52,I)= WK2( 52,I)+WK2( 42,I)*CNF( 2)
         WK2( 53,I)= WK2( 53,I)+WK2( 43,I)*CNF( 2)
         WK2( 54,I)= WK2( 54,I)+WK2( 42,I)*CNF( 3)
         WK2( 55,I)= WK2( 55,I)+WK2( 43,I)*CNF( 3)
         WK2( 56,I)= WK2( 56,I)+WK2( 44,I)*CNF( 3)
C
         WK2( 67,I)= WK2( 67,I)+WK2( 57,I)*CNF( 1)+WK2( 51,I)*CNF( 4)
         WK2( 68,I)= WK2( 68,I)+WK2( 58,I)*CNF( 1)
         WK2( 69,I)= WK2( 69,I)+WK2( 58,I)*CNF( 2)+WK2( 51,I)*CNF( 4)
         WK2( 70,I)= WK2( 70,I)+WK2( 59,I)*CNF( 2)+WK2( 52,I)*CNF( 4)
         WK2( 71,I)= WK2( 71,I)+WK2( 60,I)*CNF( 2)+WK2( 53,I)*CNF( 4)
         WK2( 72,I)= WK2( 72,I)+WK2( 61,I)*CNF( 1)
         WK2( 73,I)= WK2( 73,I)+WK2( 61,I)*CNF( 2)
         WK2( 74,I)= WK2( 74,I)+WK2( 62,I)*CNF( 2)
         WK2( 75,I)= WK2( 75,I)+WK2( 63,I)*CNF( 2)
         WK2( 76,I)= WK2( 76,I)+WK2( 61,I)*CNF( 3)+WK2( 51,I)*CNF( 4)
         WK2( 77,I)= WK2( 77,I)+WK2( 62,I)*CNF( 3)+WK2( 52,I)*CNF( 4)
         WK2( 78,I)= WK2( 78,I)+WK2( 63,I)*CNF( 3)+WK2( 53,I)*CNF( 4)
         WK2( 79,I)= WK2( 79,I)+WK2( 64,I)*CNF( 3)+WK2( 54,I)*CNF( 4)
         WK2( 80,I)= WK2( 80,I)+WK2( 65,I)*CNF( 3)+WK2( 55,I)*CNF( 4)
         WK2( 81,I)= WK2( 81,I)+WK2( 66,I)*CNF( 3)+WK2( 56,I)*CNF( 4)
C
         WK2( 57,I)= WK2( 57,I)+WK2( 45,I)*CNF( 1)
         WK2( 58,I)= WK2( 58,I)+WK2( 45,I)*CNF( 2)
         WK2( 59,I)= WK2( 59,I)+WK2( 46,I)*CNF( 2)
         WK2( 60,I)= WK2( 60,I)+WK2( 47,I)*CNF( 2)
         WK2( 61,I)= WK2( 61,I)+WK2( 45,I)*CNF( 3)
         WK2( 62,I)= WK2( 62,I)+WK2( 46,I)*CNF( 3)
         WK2( 63,I)= WK2( 63,I)+WK2( 47,I)*CNF( 3)
         WK2( 64,I)= WK2( 64,I)+WK2( 48,I)*CNF( 3)
         WK2( 65,I)= WK2( 65,I)+WK2( 49,I)*CNF( 3)
         WK2( 66,I)= WK2( 66,I)+WK2( 50,I)*CNF( 3)
C
         WK2( 67,I)= WK2( 67,I)+WK2( 57,I)*CNF( 1)
         WK2( 68,I)= WK2( 68,I)+WK2( 57,I)*CNF( 2)
         WK2( 69,I)= WK2( 69,I)+WK2( 58,I)*CNF( 2)
         WK2( 70,I)= WK2( 70,I)+WK2( 59,I)*CNF( 2)
         WK2( 71,I)= WK2( 71,I)+WK2( 60,I)*CNF( 2)
         WK2( 72,I)= WK2( 72,I)+WK2( 57,I)*CNF( 3)
         WK2( 73,I)= WK2( 73,I)+WK2( 58,I)*CNF( 3)
         WK2( 74,I)= WK2( 74,I)+WK2( 59,I)*CNF( 3)
         WK2( 75,I)= WK2( 75,I)+WK2( 60,I)*CNF( 3)
         WK2( 76,I)= WK2( 76,I)+WK2( 61,I)*CNF( 3)
         WK2( 77,I)= WK2( 77,I)+WK2( 62,I)*CNF( 3)
         WK2( 78,I)= WK2( 78,I)+WK2( 63,I)*CNF( 3)
         WK2( 79,I)= WK2( 79,I)+WK2( 64,I)*CNF( 3)
         WK2( 80,I)= WK2( 80,I)+WK2( 65,I)*CNF( 3)
         WK2( 81,I)= WK2( 81,I)+WK2( 66,I)*CNF( 3)
C
         WK2( 82,I)= WK2( 26,I)-WK2(  6,I)*CNF( 1)
         WK2( 83,I)= WK2( 27,I)-WK2(  7,I)*CNF( 1)
         WK2( 84,I)= WK2( 28,I)-WK2(  8,I)*CNF( 1)
         WK2( 85,I)= WK2( 30,I)-WK2(  9,I)*CNF( 1)
         WK2( 86,I)= WK2( 31,I)-WK2( 10,I)*CNF( 1)
         WK2( 87,I)= WK2( 33,I)-WK2( 11,I)*CNF( 1)
C
         WK2( 88,I)= WK2( 67,I)-WK2( 26,I)*CNF( 1)
         WK2( 89,I)= WK2( 68,I)-WK2( 27,I)*CNF( 1)
         WK2( 90,I)= WK2( 69,I)-WK2( 28,I)*CNF( 1)
         WK2( 91,I)= WK2( 70,I)-WK2( 29,I)*CNF( 1)
         WK2( 92,I)= WK2( 72,I)-WK2( 30,I)*CNF( 1)
         WK2( 93,I)= WK2( 73,I)-WK2( 31,I)*CNF( 1)
         WK2( 94,I)= WK2( 74,I)-WK2( 32,I)*CNF( 1)
         WK2( 95,I)= WK2( 76,I)-WK2( 33,I)*CNF( 1)
         WK2( 96,I)= WK2( 77,I)-WK2( 34,I)*CNF( 1)
         WK2( 97,I)= WK2( 79,I)-WK2( 35,I)*CNF( 1)
C
         WK2( 98,I)= WK2( 27,I)-WK2(  6,I)*CNF( 2)
         WK2( 99,I)= WK2( 28,I)-WK2(  7,I)*CNF( 2)
         WK2(100,I)= WK2( 29,I)-WK2(  8,I)*CNF( 2)
         WK2(101,I)= WK2( 31,I)-WK2(  9,I)*CNF( 2)
         WK2(102,I)= WK2( 32,I)-WK2( 10,I)*CNF( 2)
         WK2(103,I)= WK2( 34,I)-WK2( 11,I)*CNF( 2)
C
         WK2(104,I)= WK2( 68,I)-WK2( 26,I)*CNF( 2)
         WK2(105,I)= WK2( 69,I)-WK2( 27,I)*CNF( 2)
         WK2(106,I)= WK2( 70,I)-WK2( 28,I)*CNF( 2)
         WK2(107,I)= WK2( 71,I)-WK2( 29,I)*CNF( 2)
         WK2(108,I)= WK2( 73,I)-WK2( 30,I)*CNF( 2)
         WK2(109,I)= WK2( 74,I)-WK2( 31,I)*CNF( 2)
         WK2(110,I)= WK2( 75,I)-WK2( 32,I)*CNF( 2)
         WK2(111,I)= WK2( 77,I)-WK2( 33,I)*CNF( 2)
         WK2(112,I)= WK2( 78,I)-WK2( 34,I)*CNF( 2)
         WK2(113,I)= WK2( 80,I)-WK2( 35,I)*CNF( 2)
C
         WK2(114,I)= WK2( 30,I)-WK2(  6,I)*CNF( 3)
         WK2(115,I)= WK2( 31,I)-WK2(  7,I)*CNF( 3)
         WK2(116,I)= WK2( 32,I)-WK2(  8,I)*CNF( 3)
         WK2(117,I)= WK2( 33,I)-WK2(  9,I)*CNF( 3)
         WK2(118,I)= WK2( 34,I)-WK2( 10,I)*CNF( 3)
         WK2(119,I)= WK2( 35,I)-WK2( 11,I)*CNF( 3)
C
         WK2(120,I)= WK2( 72,I)-WK2( 26,I)*CNF( 3)
         WK2(121,I)= WK2( 73,I)-WK2( 27,I)*CNF( 3)
         WK2(122,I)= WK2( 74,I)-WK2( 28,I)*CNF( 3)
         WK2(123,I)= WK2( 75,I)-WK2( 29,I)*CNF( 3)
         WK2(124,I)= WK2( 76,I)-WK2( 30,I)*CNF( 3)
         WK2(125,I)= WK2( 77,I)-WK2( 31,I)*CNF( 3)
         WK2(126,I)= WK2( 78,I)-WK2( 32,I)*CNF( 3)
         WK2(127,I)= WK2( 79,I)-WK2( 33,I)*CNF( 3)
         WK2(128,I)= WK2( 80,I)-WK2( 34,I)*CNF( 3)
         WK2(129,I)= WK2( 81,I)-WK2( 35,I)*CNF( 3)
C
         WK2(130,I)= WK2( 88,I)-WK2( 82,I)*CNF( 1)
         WK2(131,I)= WK2( 89,I)-WK2( 83,I)*CNF( 1)
         WK2(132,I)= WK2( 90,I)-WK2( 84,I)*CNF( 1)
         WK2(133,I)= WK2( 92,I)-WK2( 85,I)*CNF( 1)
         WK2(134,I)= WK2( 93,I)-WK2( 86,I)*CNF( 1)
         WK2(135,I)= WK2( 95,I)-WK2( 87,I)*CNF( 1)
C
         WK2(136,I)= WK2(104,I)-WK2( 98,I)*CNF( 1)
         WK2(137,I)= WK2(105,I)-WK2( 99,I)*CNF( 1)
         WK2(138,I)= WK2(106,I)-WK2(100,I)*CNF( 1)
         WK2(139,I)= WK2(108,I)-WK2(101,I)*CNF( 1)
         WK2(140,I)= WK2(109,I)-WK2(102,I)*CNF( 1)
         WK2(141,I)= WK2(111,I)-WK2(103,I)*CNF( 1)
C
         WK2(142,I)= WK2(105,I)-WK2( 98,I)*CNF( 2)
         WK2(143,I)= WK2(106,I)-WK2( 99,I)*CNF( 2)
         WK2(144,I)= WK2(107,I)-WK2(100,I)*CNF( 2)
         WK2(145,I)= WK2(109,I)-WK2(101,I)*CNF( 2)
         WK2(146,I)= WK2(110,I)-WK2(102,I)*CNF( 2)
         WK2(147,I)= WK2(112,I)-WK2(103,I)*CNF( 2)
C
         WK2(148,I)= WK2(120,I)-WK2(114,I)*CNF( 1)
         WK2(149,I)= WK2(121,I)-WK2(115,I)*CNF( 1)
         WK2(150,I)= WK2(122,I)-WK2(116,I)*CNF( 1)
         WK2(151,I)= WK2(124,I)-WK2(117,I)*CNF( 1)
         WK2(152,I)= WK2(125,I)-WK2(118,I)*CNF( 1)
         WK2(153,I)= WK2(127,I)-WK2(119,I)*CNF( 1)
C
         WK2(154,I)= WK2(121,I)-WK2(114,I)*CNF( 2)
         WK2(155,I)= WK2(122,I)-WK2(115,I)*CNF( 2)
         WK2(156,I)= WK2(123,I)-WK2(116,I)*CNF( 2)
         WK2(157,I)= WK2(125,I)-WK2(117,I)*CNF( 2)
         WK2(158,I)= WK2(126,I)-WK2(118,I)*CNF( 2)
         WK2(159,I)= WK2(128,I)-WK2(119,I)*CNF( 2)
C
         WK2(160,I)= WK2(124,I)-WK2(114,I)*CNF( 3)
         WK2(161,I)= WK2(125,I)-WK2(115,I)*CNF( 3)
         WK2(162,I)= WK2(126,I)-WK2(116,I)*CNF( 3)
         WK2(163,I)= WK2(127,I)-WK2(117,I)*CNF( 3)
         WK2(164,I)= WK2(128,I)-WK2(118,I)*CNF( 3)
         WK2(165,I)= WK2(129,I)-WK2(119,I)*CNF( 3)
C
      RETURN
      END
